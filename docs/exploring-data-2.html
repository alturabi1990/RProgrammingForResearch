<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 7 Exploring data #2 | R Programming for Research</title>
  <meta name="description" content="This is a bookdown version of the course notes for R Programming for Research, Colorado State University, Fall 2016." />
  <meta name="generator" content="bookdown 0.14 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 7 Exploring data #2 | R Programming for Research" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is a bookdown version of the course notes for R Programming for Research, Colorado State University, Fall 2016." />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 7 Exploring data #2 | R Programming for Research" />
  
  <meta name="twitter:description" content="This is a bookdown version of the course notes for R Programming for Research, Colorado State University, Fall 2016." />
  

<meta name="author" content="Brooke Anderson, Rachel Severson, and Nicholas Good" />


<meta name="date" content="2019-11-13" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="entering-and-cleaning-data-2.html"/>
<link rel="next" href="reporting-results-2.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">R Programming for Research</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Online course book, ERHS 535</a></li>
<li class="chapter" data-level="" data-path="course-information.html"><a href="course-information.html"><i class="fa fa-check"></i>Course information</a><ul>
<li class="chapter" data-level="0.1" data-path="course-information.html"><a href="course-information.html#course-overview"><i class="fa fa-check"></i><b>0.1</b> Course overview</a></li>
<li class="chapter" data-level="0.2" data-path="course-information.html"><a href="course-information.html#time-and-place"><i class="fa fa-check"></i><b>0.2</b> Time and place</a></li>
<li class="chapter" data-level="0.3" data-path="course-information.html"><a href="course-information.html#detailed-schedule"><i class="fa fa-check"></i><b>0.3</b> Detailed schedule</a></li>
<li class="chapter" data-level="0.4" data-path="course-information.html"><a href="course-information.html#grading"><i class="fa fa-check"></i><b>0.4</b> Grading</a><ul>
<li class="chapter" data-level="0.4.1" data-path="course-information.html"><a href="course-information.html#grading-for-erhs-535"><i class="fa fa-check"></i><b>0.4.1</b> Grading for ERHS 535</a></li>
<li class="chapter" data-level="0.4.2" data-path="course-information.html"><a href="course-information.html#grading-for-erhs-581a3"><i class="fa fa-check"></i><b>0.4.2</b> Grading for ERHS 581A3</a></li>
<li class="chapter" data-level="0.4.3" data-path="course-information.html"><a href="course-information.html#grading-for-erhs-581a4"><i class="fa fa-check"></i><b>0.4.3</b> Grading for ERHS 581A4</a></li>
<li class="chapter" data-level="0.4.4" data-path="course-information.html"><a href="course-information.html#attendance-and-class-participation"><i class="fa fa-check"></i><b>0.4.4</b> Attendance and class participation</a></li>
<li class="chapter" data-level="0.4.5" data-path="course-information.html"><a href="course-information.html#weekly-in-course-group-exercises"><i class="fa fa-check"></i><b>0.4.5</b> Weekly in-course group exercises</a></li>
<li class="chapter" data-level="0.4.6" data-path="course-information.html"><a href="course-information.html#in-class-quizzes"><i class="fa fa-check"></i><b>0.4.6</b> In-class quizzes</a></li>
<li class="chapter" data-level="0.4.7" data-path="course-information.html"><a href="course-information.html#homework"><i class="fa fa-check"></i><b>0.4.7</b> Homework</a></li>
<li class="chapter" data-level="0.4.8" data-path="course-information.html"><a href="course-information.html#final-group-project"><i class="fa fa-check"></i><b>0.4.8</b> Final group project</a></li>
</ul></li>
<li class="chapter" data-level="0.5" data-path="course-information.html"><a href="course-information.html#course-set-up"><i class="fa fa-check"></i><b>0.5</b> Course set-up</a></li>
<li class="chapter" data-level="0.6" data-path="course-information.html"><a href="course-information.html#coursebook"><i class="fa fa-check"></i><b>0.6</b> Coursebook</a><ul>
<li class="chapter" data-level="0.6.1" data-path="course-information.html"><a href="course-information.html#other-helpful-books-not-required"><i class="fa fa-check"></i><b>0.6.1</b> Other helpful books (not required)</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>I Part I: Preliminaries</b></span></li>
<li class="chapter" data-level="1" data-path="r-preliminaries.html"><a href="r-preliminaries.html"><i class="fa fa-check"></i><b>1</b> R Preliminaries</a><ul>
<li class="chapter" data-level="1.1" data-path="r-preliminaries.html"><a href="r-preliminaries.html#objectives"><i class="fa fa-check"></i><b>1.1</b> Objectives</a></li>
<li class="chapter" data-level="1.2" data-path="r-preliminaries.html"><a href="r-preliminaries.html#r-and-r-studio"><i class="fa fa-check"></i><b>1.2</b> R and R Studio</a><ul>
<li class="chapter" data-level="1.2.1" data-path="r-preliminaries.html"><a href="r-preliminaries.html#what-is-r"><i class="fa fa-check"></i><b>1.2.1</b> What is R?</a></li>
<li class="chapter" data-level="1.2.2" data-path="r-preliminaries.html"><a href="r-preliminaries.html#free-and-open-source-software"><i class="fa fa-check"></i><b>1.2.2</b> Free and open-source software</a></li>
<li class="chapter" data-level="1.2.3" data-path="r-preliminaries.html"><a href="r-preliminaries.html#what-is-rstudio"><i class="fa fa-check"></i><b>1.2.3</b> What is RStudio?</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="r-preliminaries.html"><a href="r-preliminaries.html#communicating-with-r"><i class="fa fa-check"></i><b>1.3</b> Communicating with R</a><ul>
<li class="chapter" data-level="1.3.1" data-path="r-preliminaries.html"><a href="r-preliminaries.html#r-sessions-the-console-and-the-command-prompt"><i class="fa fa-check"></i><b>1.3.1</b> R sessions, the console, and the command prompt</a></li>
<li class="chapter" data-level="1.3.2" data-path="r-preliminaries.html"><a href="r-preliminaries.html#r-expressions-function-calls-and-objects"><i class="fa fa-check"></i><b>1.3.2</b> R expressions, function calls, and objects</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="r-preliminaries.html"><a href="r-preliminaries.html#r-scripts"><i class="fa fa-check"></i><b>1.4</b> R scripts</a><ul>
<li class="chapter" data-level="1.4.1" data-path="r-preliminaries.html"><a href="r-preliminaries.html#commenting-code"><i class="fa fa-check"></i><b>1.4.1</b> Commenting code</a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="r-preliminaries.html"><a href="r-preliminaries.html#the-package-system"><i class="fa fa-check"></i><b>1.5</b> The “package” system</a><ul>
<li class="chapter" data-level="1.5.1" data-path="r-preliminaries.html"><a href="r-preliminaries.html#r-packages"><i class="fa fa-check"></i><b>1.5.1</b> R packages</a></li>
<li class="chapter" data-level="1.5.2" data-path="r-preliminaries.html"><a href="r-preliminaries.html#installing-from-cran"><i class="fa fa-check"></i><b>1.5.2</b> Installing from CRAN</a></li>
<li class="chapter" data-level="1.5.3" data-path="r-preliminaries.html"><a href="r-preliminaries.html#loading-an-installed-package"><i class="fa fa-check"></i><b>1.5.3</b> Loading an installed package</a></li>
</ul></li>
<li class="chapter" data-level="1.6" data-path="r-preliminaries.html"><a href="r-preliminaries.html#rs-most-basic-object-types"><i class="fa fa-check"></i><b>1.6</b> R’s most basic object types</a><ul>
<li class="chapter" data-level="1.6.1" data-path="r-preliminaries.html"><a href="r-preliminaries.html#vectors"><i class="fa fa-check"></i><b>1.6.1</b> Vectors</a></li>
<li class="chapter" data-level="1.6.2" data-path="r-preliminaries.html"><a href="r-preliminaries.html#dataframes"><i class="fa fa-check"></i><b>1.6.2</b> Dataframes</a></li>
</ul></li>
<li class="chapter" data-level="1.7" data-path="r-preliminaries.html"><a href="r-preliminaries.html#in-course-exercise"><i class="fa fa-check"></i><b>1.7</b> In-course Exercise</a><ul>
<li class="chapter" data-level="1.7.1" data-path="r-preliminaries.html"><a href="r-preliminaries.html#trying-out-the-code-in-slides-so-far"><i class="fa fa-check"></i><b>1.7.1</b> Trying out the code in slides so far</a></li>
<li class="chapter" data-level="1.7.2" data-path="r-preliminaries.html"><a href="r-preliminaries.html#writing-your-code-as-an-r-script"><i class="fa fa-check"></i><b>1.7.2</b> Writing your code as an R script</a></li>
<li class="chapter" data-level="1.7.3" data-path="r-preliminaries.html"><a href="r-preliminaries.html#about-the-dataset"><i class="fa fa-check"></i><b>1.7.3</b> About the dataset</a></li>
<li class="chapter" data-level="1.7.4" data-path="r-preliminaries.html"><a href="r-preliminaries.html#manually-creating-vectors"><i class="fa fa-check"></i><b>1.7.4</b> Manually creating vectors</a></li>
<li class="chapter" data-level="1.7.5" data-path="r-preliminaries.html"><a href="r-preliminaries.html#installing-and-using-a-package"><i class="fa fa-check"></i><b>1.7.5</b> Installing and using a package</a></li>
<li class="chapter" data-level="1.7.6" data-path="r-preliminaries.html"><a href="r-preliminaries.html#manually-creating-a-dataframe"><i class="fa fa-check"></i><b>1.7.6</b> Manually creating a dataframe</a></li>
<li class="chapter" data-level="1.7.7" data-path="r-preliminaries.html"><a href="r-preliminaries.html#getting-the-data-onto-your-computer"><i class="fa fa-check"></i><b>1.7.7</b> Getting the data onto your computer</a></li>
<li class="chapter" data-level="1.7.8" data-path="r-preliminaries.html"><a href="r-preliminaries.html#getting-the-data-into-r"><i class="fa fa-check"></i><b>1.7.8</b> Getting the data into R</a></li>
<li class="chapter" data-level="1.7.9" data-path="r-preliminaries.html"><a href="r-preliminaries.html#checking-out-the-data"><i class="fa fa-check"></i><b>1.7.9</b> Checking out the data</a></li>
<li class="chapter" data-level="1.7.10" data-path="r-preliminaries.html"><a href="r-preliminaries.html#using-the-data-to-answer-questions"><i class="fa fa-check"></i><b>1.7.10</b> Using the data to answer questions</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>II Part II: Basics</b></span></li>
<li class="chapter" data-level="2" data-path="entering-and-cleaning-data-1.html"><a href="entering-and-cleaning-data-1.html"><i class="fa fa-check"></i><b>2</b> Entering and cleaning data #1</a><ul>
<li class="chapter" data-level="2.1" data-path="entering-and-cleaning-data-1.html"><a href="entering-and-cleaning-data-1.html#objectives-1"><i class="fa fa-check"></i><b>2.1</b> Objectives</a></li>
<li class="chapter" data-level="2.2" data-path="entering-and-cleaning-data-1.html"><a href="entering-and-cleaning-data-1.html#overview"><i class="fa fa-check"></i><b>2.2</b> Overview</a></li>
<li class="chapter" data-level="2.3" data-path="entering-and-cleaning-data-1.html"><a href="entering-and-cleaning-data-1.html#reading-data-into-r"><i class="fa fa-check"></i><b>2.3</b> Reading data into R</a><ul>
<li class="chapter" data-level="2.3.1" data-path="entering-and-cleaning-data-1.html"><a href="entering-and-cleaning-data-1.html#reading-local-flat-files"><i class="fa fa-check"></i><b>2.3.1</b> Reading local flat files</a></li>
<li class="chapter" data-level="2.3.2" data-path="entering-and-cleaning-data-1.html"><a href="entering-and-cleaning-data-1.html#reading-in-other-file-types"><i class="fa fa-check"></i><b>2.3.2</b> Reading in other file types</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="entering-and-cleaning-data-1.html"><a href="entering-and-cleaning-data-1.html#directories-and-pathnames"><i class="fa fa-check"></i><b>2.4</b> Directories and pathnames</a><ul>
<li class="chapter" data-level="2.4.1" data-path="entering-and-cleaning-data-1.html"><a href="entering-and-cleaning-data-1.html#directory-structure"><i class="fa fa-check"></i><b>2.4.1</b> Directory structure</a></li>
<li class="chapter" data-level="2.4.2" data-path="entering-and-cleaning-data-1.html"><a href="entering-and-cleaning-data-1.html#working-directory"><i class="fa fa-check"></i><b>2.4.2</b> Working directory</a></li>
<li class="chapter" data-level="2.4.3" data-path="entering-and-cleaning-data-1.html"><a href="entering-and-cleaning-data-1.html#file-and-directory-pathnames"><i class="fa fa-check"></i><b>2.4.3</b> File and directory pathnames</a></li>
<li class="chapter" data-level="2.4.4" data-path="entering-and-cleaning-data-1.html"><a href="entering-and-cleaning-data-1.html#diversion-paste"><i class="fa fa-check"></i><b>2.4.4</b> Diversion: <code>paste</code></a></li>
<li class="chapter" data-level="2.4.5" data-path="entering-and-cleaning-data-1.html"><a href="entering-and-cleaning-data-1.html#reading-online-flat-files"><i class="fa fa-check"></i><b>2.4.5</b> Reading online flat files</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="entering-and-cleaning-data-1.html"><a href="entering-and-cleaning-data-1.html#data-cleaning"><i class="fa fa-check"></i><b>2.5</b> Data cleaning</a><ul>
<li class="chapter" data-level="2.5.1" data-path="entering-and-cleaning-data-1.html"><a href="entering-and-cleaning-data-1.html#renaming-columns"><i class="fa fa-check"></i><b>2.5.1</b> Renaming columns</a></li>
<li class="chapter" data-level="2.5.2" data-path="entering-and-cleaning-data-1.html"><a href="entering-and-cleaning-data-1.html#selecting-columns"><i class="fa fa-check"></i><b>2.5.2</b> Selecting columns</a></li>
<li class="chapter" data-level="2.5.3" data-path="entering-and-cleaning-data-1.html"><a href="entering-and-cleaning-data-1.html#add-or-change-columns"><i class="fa fa-check"></i><b>2.5.3</b> Add or change columns</a></li>
<li class="chapter" data-level="2.5.4" data-path="entering-and-cleaning-data-1.html"><a href="entering-and-cleaning-data-1.html#base-r-equivalents-to-dplyr-functions"><i class="fa fa-check"></i><b>2.5.4</b> Base R equivalents to <code>dplyr</code> functions</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="entering-and-cleaning-data-1.html"><a href="entering-and-cleaning-data-1.html#dates-and-filtering"><i class="fa fa-check"></i><b>2.6</b> Dates and filtering</a><ul>
<li class="chapter" data-level="2.6.1" data-path="entering-and-cleaning-data-1.html"><a href="entering-and-cleaning-data-1.html#dates-in-r"><i class="fa fa-check"></i><b>2.6.1</b> Dates in R</a></li>
<li class="chapter" data-level="2.6.2" data-path="entering-and-cleaning-data-1.html"><a href="entering-and-cleaning-data-1.html#filtering-to-certain-rows"><i class="fa fa-check"></i><b>2.6.2</b> Filtering to certain rows</a></li>
</ul></li>
<li class="chapter" data-level="2.7" data-path="entering-and-cleaning-data-1.html"><a href="entering-and-cleaning-data-1.html#piping"><i class="fa fa-check"></i><b>2.7</b> Piping</a></li>
<li class="chapter" data-level="2.8" data-path="entering-and-cleaning-data-1.html"><a href="entering-and-cleaning-data-1.html#in-course-exercise-1"><i class="fa fa-check"></i><b>2.8</b> In-course Exercise</a><ul>
<li class="chapter" data-level="2.8.1" data-path="entering-and-cleaning-data-1.html"><a href="entering-and-cleaning-data-1.html#downloading-and-checking-out-the-example-data"><i class="fa fa-check"></i><b>2.8.1</b> Downloading and checking out the example data</a></li>
<li class="chapter" data-level="2.8.2" data-path="entering-and-cleaning-data-1.html"><a href="entering-and-cleaning-data-1.html#reading-in-different-types-of-files"><i class="fa fa-check"></i><b>2.8.2</b> Reading in different types of files</a></li>
<li class="chapter" data-level="2.8.3" data-path="entering-and-cleaning-data-1.html"><a href="entering-and-cleaning-data-1.html#directory-structure-1"><i class="fa fa-check"></i><b>2.8.3</b> Directory structure</a></li>
<li class="chapter" data-level="2.8.4" data-path="entering-and-cleaning-data-1.html"><a href="entering-and-cleaning-data-1.html#cleaning-up-data-1"><i class="fa fa-check"></i><b>2.8.4</b> Cleaning up data #1</a></li>
<li class="chapter" data-level="2.8.5" data-path="entering-and-cleaning-data-1.html"><a href="entering-and-cleaning-data-1.html#cleaning-up-data-2"><i class="fa fa-check"></i><b>2.8.5</b> Cleaning up data #2</a></li>
<li class="chapter" data-level="2.8.6" data-path="entering-and-cleaning-data-1.html"><a href="entering-and-cleaning-data-1.html#piping-1"><i class="fa fa-check"></i><b>2.8.6</b> Piping</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="exploring-data-1.html"><a href="exploring-data-1.html"><i class="fa fa-check"></i><b>3</b> Exploring data #1</a><ul>
<li class="chapter" data-level="3.1" data-path="exploring-data-1.html"><a href="exploring-data-1.html#objectives-2"><i class="fa fa-check"></i><b>3.1</b> Objectives</a></li>
<li class="chapter" data-level="3.2" data-path="exploring-data-1.html"><a href="exploring-data-1.html#data-from-a-package"><i class="fa fa-check"></i><b>3.2</b> Data from a package</a></li>
<li class="chapter" data-level="3.3" data-path="exploring-data-1.html"><a href="exploring-data-1.html#logical-vectors"><i class="fa fa-check"></i><b>3.3</b> Logical vectors</a></li>
<li class="chapter" data-level="3.4" data-path="exploring-data-1.html"><a href="exploring-data-1.html#simple-statistics-functions"><i class="fa fa-check"></i><b>3.4</b> Simple statistics functions</a><ul>
<li class="chapter" data-level="3.4.1" data-path="exploring-data-1.html"><a href="exploring-data-1.html#summary-statistics"><i class="fa fa-check"></i><b>3.4.1</b> Summary statistics</a></li>
<li class="chapter" data-level="3.4.2" data-path="exploring-data-1.html"><a href="exploring-data-1.html#summarize-function"><i class="fa fa-check"></i><b>3.4.2</b> <code>summarize</code> function</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="exploring-data-1.html"><a href="exploring-data-1.html#plots-to-explore-data"><i class="fa fa-check"></i><b>3.5</b> Plots to explore data</a><ul>
<li class="chapter" data-level="3.5.1" data-path="exploring-data-1.html"><a href="exploring-data-1.html#initializing-a-ggplot-object"><i class="fa fa-check"></i><b>3.5.1</b> Initializing a ggplot object</a></li>
<li class="chapter" data-level="3.5.2" data-path="exploring-data-1.html"><a href="exploring-data-1.html#plot-aesthetics"><i class="fa fa-check"></i><b>3.5.2</b> Plot aesthetics</a></li>
<li class="chapter" data-level="3.5.3" data-path="exploring-data-1.html"><a href="exploring-data-1.html#adding-geoms"><i class="fa fa-check"></i><b>3.5.3</b> Adding geoms</a></li>
<li class="chapter" data-level="3.5.4" data-path="exploring-data-1.html"><a href="exploring-data-1.html#constant-aesthetics"><i class="fa fa-check"></i><b>3.5.4</b> Constant aesthetics</a></li>
<li class="chapter" data-level="3.5.5" data-path="exploring-data-1.html"><a href="exploring-data-1.html#useful-plot-additions"><i class="fa fa-check"></i><b>3.5.5</b> Useful plot additions</a></li>
<li class="chapter" data-level="3.5.6" data-path="exploring-data-1.html"><a href="exploring-data-1.html#example-dataset"><i class="fa fa-check"></i><b>3.5.6</b> Example dataset</a></li>
<li class="chapter" data-level="3.5.7" data-path="exploring-data-1.html"><a href="exploring-data-1.html#histograms"><i class="fa fa-check"></i><b>3.5.7</b> Histograms</a></li>
<li class="chapter" data-level="3.5.8" data-path="exploring-data-1.html"><a href="exploring-data-1.html#scatterplots"><i class="fa fa-check"></i><b>3.5.8</b> Scatterplots</a></li>
<li class="chapter" data-level="3.5.9" data-path="exploring-data-1.html"><a href="exploring-data-1.html#boxplots"><i class="fa fa-check"></i><b>3.5.9</b> Boxplots</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="exploring-data-1.html"><a href="exploring-data-1.html#in-course-exercise-2"><i class="fa fa-check"></i><b>3.6</b> In-course exercise</a><ul>
<li class="chapter" data-level="3.6.1" data-path="exploring-data-1.html"><a href="exploring-data-1.html#loading-data-from-an-r-package"><i class="fa fa-check"></i><b>3.6.1</b> Loading data from an R package</a></li>
<li class="chapter" data-level="3.6.2" data-path="exploring-data-1.html"><a href="exploring-data-1.html#exploring-the-data-using-simple-statistics-and-summarize"><i class="fa fa-check"></i><b>3.6.2</b> Exploring the data using simple statistics and <code>summarize</code></a></li>
<li class="chapter" data-level="3.6.3" data-path="exploring-data-1.html"><a href="exploring-data-1.html#exploring-the-data-using-logical-statements"><i class="fa fa-check"></i><b>3.6.3</b> Exploring the data using logical statements</a></li>
<li class="chapter" data-level="3.6.4" data-path="exploring-data-1.html"><a href="exploring-data-1.html#exploring-the-data-using-basic-plots-1"><i class="fa fa-check"></i><b>3.6.4</b> Exploring the data using basic plots #1</a></li>
<li class="chapter" data-level="3.6.5" data-path="exploring-data-1.html"><a href="exploring-data-1.html#exploring-the-data-using-basic-plots-2"><i class="fa fa-check"></i><b>3.6.5</b> Exploring the data using basic plots #2</a></li>
<li class="chapter" data-level="3.6.6" data-path="exploring-data-1.html"><a href="exploring-data-1.html#exploring-the-data-using-basic-plots-3"><i class="fa fa-check"></i><b>3.6.6</b> Exploring the data using basic plots #3</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="reporting-data-results-1.html"><a href="reporting-data-results-1.html"><i class="fa fa-check"></i><b>4</b> Reporting data results #1</a><ul>
<li class="chapter" data-level="4.1" data-path="reporting-data-results-1.html"><a href="reporting-data-results-1.html#guidelines-for-good-plots"><i class="fa fa-check"></i><b>4.1</b> Guidelines for good plots</a></li>
<li class="chapter" data-level="4.2" data-path="reporting-data-results-1.html"><a href="reporting-data-results-1.html#high-data-density"><i class="fa fa-check"></i><b>4.2</b> High data density</a></li>
<li class="chapter" data-level="4.3" data-path="reporting-data-results-1.html"><a href="reporting-data-results-1.html#meaningful-labels"><i class="fa fa-check"></i><b>4.3</b> Meaningful labels</a></li>
<li class="chapter" data-level="4.4" data-path="reporting-data-results-1.html"><a href="reporting-data-results-1.html#references"><i class="fa fa-check"></i><b>4.4</b> References</a></li>
<li class="chapter" data-level="4.5" data-path="reporting-data-results-1.html"><a href="reporting-data-results-1.html#highlighting"><i class="fa fa-check"></i><b>4.5</b> Highlighting</a></li>
<li class="chapter" data-level="4.6" data-path="reporting-data-results-1.html"><a href="reporting-data-results-1.html#order"><i class="fa fa-check"></i><b>4.6</b> Order</a></li>
<li class="chapter" data-level="4.7" data-path="reporting-data-results-1.html"><a href="reporting-data-results-1.html#small-multiples"><i class="fa fa-check"></i><b>4.7</b> Small multiples</a></li>
<li class="chapter" data-level="4.8" data-path="reporting-data-results-1.html"><a href="reporting-data-results-1.html#advanced-customization"><i class="fa fa-check"></i><b>4.8</b> Advanced customization</a><ul>
<li class="chapter" data-level="4.8.1" data-path="reporting-data-results-1.html"><a href="reporting-data-results-1.html#scales"><i class="fa fa-check"></i><b>4.8.1</b> Scales</a></li>
</ul></li>
<li class="chapter" data-level="4.9" data-path="reporting-data-results-1.html"><a href="reporting-data-results-1.html#to-find-out-more"><i class="fa fa-check"></i><b>4.9</b> To find out more</a></li>
<li class="chapter" data-level="4.10" data-path="reporting-data-results-1.html"><a href="reporting-data-results-1.html#in-course-exercise-3"><i class="fa fa-check"></i><b>4.10</b> In-course exercise</a><ul>
<li class="chapter" data-level="4.10.1" data-path="reporting-data-results-1.html"><a href="reporting-data-results-1.html#designing-a-plot"><i class="fa fa-check"></i><b>4.10.1</b> Designing a plot</a></li>
<li class="chapter" data-level="4.10.2" data-path="reporting-data-results-1.html"><a href="reporting-data-results-1.html#implementing-plot-guidelines-1"><i class="fa fa-check"></i><b>4.10.2</b> Implementing plot guidelines #1</a></li>
<li class="chapter" data-level="4.10.3" data-path="reporting-data-results-1.html"><a href="reporting-data-results-1.html#implementing-plot-guidelines-2"><i class="fa fa-check"></i><b>4.10.3</b> Implementing plot guidelines #2</a></li>
<li class="chapter" data-level="4.10.4" data-path="reporting-data-results-1.html"><a href="reporting-data-results-1.html#data-visualization-cheatsheet"><i class="fa fa-check"></i><b>4.10.4</b> Data visualization cheatsheet</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="reproducible-research-1.html"><a href="reproducible-research-1.html"><i class="fa fa-check"></i><b>5</b> Reproducible research #1</a><ul>
<li class="chapter" data-level="5.1" data-path="reproducible-research-1.html"><a href="reproducible-research-1.html#what-is-reproducible-research"><i class="fa fa-check"></i><b>5.1</b> What is reproducible research?</a></li>
<li class="chapter" data-level="5.2" data-path="reproducible-research-1.html"><a href="reproducible-research-1.html#markdown"><i class="fa fa-check"></i><b>5.2</b> Markdown</a></li>
<li class="chapter" data-level="5.3" data-path="reproducible-research-1.html"><a href="reproducible-research-1.html#literate-programming-in-r"><i class="fa fa-check"></i><b>5.3</b> Literate programming in R</a></li>
<li class="chapter" data-level="5.4" data-path="reproducible-research-1.html"><a href="reproducible-research-1.html#style-guidelines"><i class="fa fa-check"></i><b>5.4</b> Style guidelines</a><ul>
<li class="chapter" data-level="5.4.1" data-path="reproducible-research-1.html"><a href="reproducible-research-1.html#line-length"><i class="fa fa-check"></i><b>5.4.1</b> Line length</a></li>
<li class="chapter" data-level="5.4.2" data-path="reproducible-research-1.html"><a href="reproducible-research-1.html#spacing"><i class="fa fa-check"></i><b>5.4.2</b> Spacing</a></li>
<li class="chapter" data-level="5.4.3" data-path="reproducible-research-1.html"><a href="reproducible-research-1.html#semicolons"><i class="fa fa-check"></i><b>5.4.3</b> Semicolons</a></li>
<li class="chapter" data-level="5.4.4" data-path="reproducible-research-1.html"><a href="reproducible-research-1.html#commenting"><i class="fa fa-check"></i><b>5.4.4</b> Commenting</a></li>
<li class="chapter" data-level="5.4.5" data-path="reproducible-research-1.html"><a href="reproducible-research-1.html#indentation"><i class="fa fa-check"></i><b>5.4.5</b> Indentation</a></li>
<li class="chapter" data-level="5.4.6" data-path="reproducible-research-1.html"><a href="reproducible-research-1.html#code-grouping"><i class="fa fa-check"></i><b>5.4.6</b> Code grouping</a></li>
<li class="chapter" data-level="5.4.7" data-path="reproducible-research-1.html"><a href="reproducible-research-1.html#broader-guidelines"><i class="fa fa-check"></i><b>5.4.7</b> Broader guidelines</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="reproducible-research-1.html"><a href="reproducible-research-1.html#more-with-knitr"><i class="fa fa-check"></i><b>5.5</b> More with knitr</a><ul>
<li class="chapter" data-level="5.5.1" data-path="reproducible-research-1.html"><a href="reproducible-research-1.html#equations-in-knitr"><i class="fa fa-check"></i><b>5.5.1</b> Equations in <code>knitr</code></a></li>
<li class="chapter" data-level="5.5.2" data-path="reproducible-research-1.html"><a href="reproducible-research-1.html#figures-from-file"><i class="fa fa-check"></i><b>5.5.2</b> Figures from file</a></li>
<li class="chapter" data-level="5.5.3" data-path="reproducible-research-1.html"><a href="reproducible-research-1.html#saving-graphics-files"><i class="fa fa-check"></i><b>5.5.3</b> Saving graphics files</a></li>
<li class="chapter" data-level="5.5.4" data-path="reproducible-research-1.html"><a href="reproducible-research-1.html#tables-in-r-markdown"><i class="fa fa-check"></i><b>5.5.4</b> Tables in R Markdown</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="reproducible-research-1.html"><a href="reproducible-research-1.html#in-course-exercise-4"><i class="fa fa-check"></i><b>5.6</b> In-course exercise</a><ul>
<li class="chapter" data-level="5.6.1" data-path="reproducible-research-1.html"><a href="reproducible-research-1.html#creating-a-markdown-document"><i class="fa fa-check"></i><b>5.6.1</b> Creating a Markdown document</a></li>
<li class="chapter" data-level="5.6.2" data-path="reproducible-research-1.html"><a href="reproducible-research-1.html#adding-in-r-code"><i class="fa fa-check"></i><b>5.6.2</b> Adding in R code</a></li>
<li class="chapter" data-level="5.6.3" data-path="reproducible-research-1.html"><a href="reproducible-research-1.html#working-with-r-markdown-documents"><i class="fa fa-check"></i><b>5.6.3</b> Working with R Markdown documents</a></li>
<li class="chapter" data-level="5.6.4" data-path="reproducible-research-1.html"><a href="reproducible-research-1.html#r-style-guidelines"><i class="fa fa-check"></i><b>5.6.4</b> R style guidelines</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>III Part III: Intermediate</b></span></li>
<li class="chapter" data-level="6" data-path="entering-and-cleaning-data-2.html"><a href="entering-and-cleaning-data-2.html"><i class="fa fa-check"></i><b>6</b> Entering and cleaning data #2</a><ul>
<li class="chapter" data-level="6.1" data-path="entering-and-cleaning-data-2.html"><a href="entering-and-cleaning-data-2.html#joining-datasets"><i class="fa fa-check"></i><b>6.1</b> Joining datasets</a></li>
<li class="chapter" data-level="6.2" data-path="entering-and-cleaning-data-2.html"><a href="entering-and-cleaning-data-2.html#tidy-data"><i class="fa fa-check"></i><b>6.2</b> Tidy data</a></li>
<li class="chapter" data-level="6.3" data-path="entering-and-cleaning-data-2.html"><a href="entering-and-cleaning-data-2.html#longer-data"><i class="fa fa-check"></i><b>6.3</b> Longer data</a></li>
<li class="chapter" data-level="6.4" data-path="entering-and-cleaning-data-2.html"><a href="entering-and-cleaning-data-2.html#working-with-factors"><i class="fa fa-check"></i><b>6.4</b> Working with factors</a></li>
<li class="chapter" data-level="6.5" data-path="entering-and-cleaning-data-2.html"><a href="entering-and-cleaning-data-2.html#string-operations-and-regular-expressions"><i class="fa fa-check"></i><b>6.5</b> String operations and regular expressions</a></li>
<li class="chapter" data-level="6.6" data-path="entering-and-cleaning-data-2.html"><a href="entering-and-cleaning-data-2.html#tidy-select"><i class="fa fa-check"></i><b>6.6</b> Tidy select</a></li>
<li class="chapter" data-level="6.7" data-path="entering-and-cleaning-data-2.html"><a href="entering-and-cleaning-data-2.html#in-course-exercise-5"><i class="fa fa-check"></i><b>6.7</b> In-course exercise</a><ul>
<li class="chapter" data-level="6.7.1" data-path="entering-and-cleaning-data-2.html"><a href="entering-and-cleaning-data-2.html#designing-tidy-data"><i class="fa fa-check"></i><b>6.7.1</b> Designing tidy data</a></li>
<li class="chapter" data-level="6.7.2" data-path="entering-and-cleaning-data-2.html"><a href="entering-and-cleaning-data-2.html#easier-data-wrangling"><i class="fa fa-check"></i><b>6.7.2</b> Easier data wrangling</a></li>
<li class="chapter" data-level="6.7.3" data-path="entering-and-cleaning-data-2.html"><a href="entering-and-cleaning-data-2.html#more-extensive-data-wrangling"><i class="fa fa-check"></i><b>6.7.3</b> More extensive data wrangling</a></li>
<li class="chapter" data-level="6.7.4" data-path="entering-and-cleaning-data-2.html"><a href="entering-and-cleaning-data-2.html#tidying-vadeaths-data"><i class="fa fa-check"></i><b>6.7.4</b> Tidying <code>VADeaths</code> data</a></li>
<li class="chapter" data-level="6.7.5" data-path="entering-and-cleaning-data-2.html"><a href="entering-and-cleaning-data-2.html#baby-names"><i class="fa fa-check"></i><b>6.7.5</b> Baby names</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="exploring-data-2.html"><a href="exploring-data-2.html"><i class="fa fa-check"></i><b>7</b> Exploring data #2</a><ul>
<li class="chapter" data-level="7.1" data-path="exploring-data-2.html"><a href="exploring-data-2.html#simple-statistical-tests-in-r"><i class="fa fa-check"></i><b>7.1</b> Simple statistical tests in R</a></li>
<li class="chapter" data-level="7.2" data-path="exploring-data-2.html"><a href="exploring-data-2.html#matrices"><i class="fa fa-check"></i><b>7.2</b> Matrices</a></li>
<li class="chapter" data-level="7.3" data-path="exploring-data-2.html"><a href="exploring-data-2.html#lists"><i class="fa fa-check"></i><b>7.3</b> Lists</a></li>
<li class="chapter" data-level="7.4" data-path="exploring-data-2.html"><a href="exploring-data-2.html#apply-a-test-multiple-times"><i class="fa fa-check"></i><b>7.4</b> Apply a test multiple times</a></li>
<li class="chapter" data-level="7.5" data-path="exploring-data-2.html"><a href="exploring-data-2.html#regression-models"><i class="fa fa-check"></i><b>7.5</b> Regression models</a><ul>
<li class="chapter" data-level="7.5.1" data-path="exploring-data-2.html"><a href="exploring-data-2.html#formula-structure"><i class="fa fa-check"></i><b>7.5.1</b> Formula structure</a></li>
<li class="chapter" data-level="7.5.2" data-path="exploring-data-2.html"><a href="exploring-data-2.html#linear-models"><i class="fa fa-check"></i><b>7.5.2</b> Linear models</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="exploring-data-2.html"><a href="exploring-data-2.html#handling-model-objects"><i class="fa fa-check"></i><b>7.6</b> Handling model objects</a><ul>
<li class="chapter" data-level="7.6.1" data-path="exploring-data-2.html"><a href="exploring-data-2.html#broomtidy"><i class="fa fa-check"></i><b>7.6.1</b> broom::tidy</a></li>
<li class="chapter" data-level="7.6.2" data-path="exploring-data-2.html"><a href="exploring-data-2.html#broomaugment"><i class="fa fa-check"></i><b>7.6.2</b> broom::augment</a></li>
<li class="chapter" data-level="7.6.3" data-path="exploring-data-2.html"><a href="exploring-data-2.html#broomglance"><i class="fa fa-check"></i><b>7.6.3</b> broom::glance</a></li>
<li class="chapter" data-level="7.6.4" data-path="exploring-data-2.html"><a href="exploring-data-2.html#references-statistics-in-r"><i class="fa fa-check"></i><b>7.6.4</b> References– statistics in R</a></li>
</ul></li>
<li class="chapter" data-level="7.7" data-path="exploring-data-2.html"><a href="exploring-data-2.html#functions"><i class="fa fa-check"></i><b>7.7</b> Functions</a><ul>
<li class="chapter" data-level="7.7.1" data-path="exploring-data-2.html"><a href="exploring-data-2.html#if-else-statements"><i class="fa fa-check"></i><b>7.7.1</b> if / else statements</a></li>
<li class="chapter" data-level="7.7.2" data-path="exploring-data-2.html"><a href="exploring-data-2.html#some-other-control-structures"><i class="fa fa-check"></i><b>7.7.2</b> Some other control structures</a></li>
</ul></li>
<li class="chapter" data-level="7.8" data-path="exploring-data-2.html"><a href="exploring-data-2.html#in-course-exercise-6"><i class="fa fa-check"></i><b>7.8</b> In-course exercise</a><ul>
<li class="chapter" data-level="7.8.1" data-path="exploring-data-2.html"><a href="exploring-data-2.html#exploring-taxonomic-profiling-data"><i class="fa fa-check"></i><b>7.8.1</b> Exploring taxonomic profiling data</a></li>
<li class="chapter" data-level="7.8.2" data-path="exploring-data-2.html"><a href="exploring-data-2.html#more-with-baby-names"><i class="fa fa-check"></i><b>7.8.2</b> More with baby names</a></li>
<li class="chapter" data-level="7.8.3" data-path="exploring-data-2.html"><a href="exploring-data-2.html#running-a-simple-statistical-test"><i class="fa fa-check"></i><b>7.8.3</b> Running a simple statistical test</a></li>
<li class="chapter" data-level="7.8.4" data-path="exploring-data-2.html"><a href="exploring-data-2.html#using-regression-models-to-explore-data-1"><i class="fa fa-check"></i><b>7.8.4</b> Using regression models to explore data #1</a></li>
<li class="chapter" data-level="7.8.5" data-path="exploring-data-2.html"><a href="exploring-data-2.html#using-regression-models-to-explore-data-2"><i class="fa fa-check"></i><b>7.8.5</b> Using regression models to explore data #2</a></li>
<li class="chapter" data-level="7.8.6" data-path="exploring-data-2.html"><a href="exploring-data-2.html#trying-out-nesting-and-mapping"><i class="fa fa-check"></i><b>7.8.6</b> Trying out nesting and mapping</a></li>
<li class="chapter" data-level="7.8.7" data-path="exploring-data-2.html"><a href="exploring-data-2.html#writing-functions"><i class="fa fa-check"></i><b>7.8.7</b> Writing functions</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="reporting-results-2.html"><a href="reporting-results-2.html"><i class="fa fa-check"></i><b>8</b> Reporting results #2</a><ul>
<li class="chapter" data-level="8.1" data-path="reporting-results-2.html"><a href="reporting-results-2.html#course-lectures"><i class="fa fa-check"></i><b>8.1</b> Course lectures</a></li>
<li class="chapter" data-level="8.2" data-path="reporting-results-2.html"><a href="reporting-results-2.html#example-data"><i class="fa fa-check"></i><b>8.2</b> Example data</a></li>
<li class="chapter" data-level="8.3" data-path="reporting-results-2.html"><a href="reporting-results-2.html#ggplot2-extras-and-extensions"><i class="fa fa-check"></i><b>8.3</b> <code>ggplot2</code> extras and extensions</a><ul>
<li class="chapter" data-level="8.3.1" data-path="reporting-results-2.html"><a href="reporting-results-2.html#scales-package"><i class="fa fa-check"></i><b>8.3.1</b> <code>scales</code> package</a></li>
<li class="chapter" data-level="8.3.2" data-path="reporting-results-2.html"><a href="reporting-results-2.html#ggplot2-extensions"><i class="fa fa-check"></i><b>8.3.2</b> <code>ggplot2</code> extensions</a></li>
<li class="chapter" data-level="8.3.3" data-path="reporting-results-2.html"><a href="reporting-results-2.html#more-ggplot2-themes"><i class="fa fa-check"></i><b>8.3.3</b> More <code>ggplot2</code> themes</a></li>
<li class="chapter" data-level="8.3.4" data-path="reporting-results-2.html"><a href="reporting-results-2.html#other-useful-ggplot2-extensions"><i class="fa fa-check"></i><b>8.3.4</b> Other useful <code>ggplot2</code> extensions</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="reporting-results-2.html"><a href="reporting-results-2.html#simple-features"><i class="fa fa-check"></i><b>8.4</b> Simple features</a><ul>
<li class="chapter" data-level="8.4.1" data-path="reporting-results-2.html"><a href="reporting-results-2.html#introduction-to-simple-features"><i class="fa fa-check"></i><b>8.4.1</b> Introduction to simple features</a></li>
<li class="chapter" data-level="8.4.2" data-path="reporting-results-2.html"><a href="reporting-results-2.html#state-boundaries"><i class="fa fa-check"></i><b>8.4.2</b> State boundaries</a></li>
<li class="chapter" data-level="8.4.3" data-path="reporting-results-2.html"><a href="reporting-results-2.html#creating-an-sf-object"><i class="fa fa-check"></i><b>8.4.3</b> Creating an <code>sf</code> object</a></li>
<li class="chapter" data-level="8.4.4" data-path="reporting-results-2.html"><a href="reporting-results-2.html#reading-in-from-gis-files"><i class="fa fa-check"></i><b>8.4.4</b> Reading in from GIS files</a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="reporting-results-2.html"><a href="reporting-results-2.html#in-course-exercise-7"><i class="fa fa-check"></i><b>8.5</b> In-course exercise</a><ul>
<li class="chapter" data-level="8.5.1" data-path="reporting-results-2.html"><a href="reporting-results-2.html#getting-and-cleaning-the-example-data"><i class="fa fa-check"></i><b>8.5.1</b> Getting and cleaning the example data</a></li>
<li class="chapter" data-level="8.5.2" data-path="reporting-results-2.html"><a href="reporting-results-2.html#trying-out-ggplot2-extensions"><i class="fa fa-check"></i><b>8.5.2</b> Trying out <code>ggplot2</code> extensions</a></li>
<li class="chapter" data-level="8.5.3" data-path="reporting-results-2.html"><a href="reporting-results-2.html#using-simple-features-to-map"><i class="fa fa-check"></i><b>8.5.3</b> Using simple features to map</a></li>
<li class="chapter" data-level="8.5.4" data-path="reporting-results-2.html"><a href="reporting-results-2.html#more-on-mapping"><i class="fa fa-check"></i><b>8.5.4</b> More on mapping</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="reproducible-research-2.html"><a href="reproducible-research-2.html"><i class="fa fa-check"></i><b>9</b> Reproducible research #2</a><ul>
<li class="chapter" data-level="9.1" data-path="reproducible-research-2.html"><a href="reproducible-research-2.html#templates"><i class="fa fa-check"></i><b>9.1</b> Templates</a></li>
<li class="chapter" data-level="9.2" data-path="reproducible-research-2.html"><a href="reproducible-research-2.html#r-projects"><i class="fa fa-check"></i><b>9.2</b> R Projects</a><ul>
<li class="chapter" data-level="9.2.1" data-path="reproducible-research-2.html"><a href="reproducible-research-2.html#organization"><i class="fa fa-check"></i><b>9.2.1</b> Organization</a></li>
<li class="chapter" data-level="9.2.2" data-path="reproducible-research-2.html"><a href="reproducible-research-2.html#creating-r-projects"><i class="fa fa-check"></i><b>9.2.2</b> Creating R Projects</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="reproducible-research-2.html"><a href="reproducible-research-2.html#git"><i class="fa fa-check"></i><b>9.3</b> git</a><ul>
<li class="chapter" data-level="9.3.1" data-path="reproducible-research-2.html"><a href="reproducible-research-2.html#initializing-a-git-repository"><i class="fa fa-check"></i><b>9.3.1</b> Initializing a git repository</a></li>
<li class="chapter" data-level="9.3.2" data-path="reproducible-research-2.html"><a href="reproducible-research-2.html#committing"><i class="fa fa-check"></i><b>9.3.2</b> Committing</a></li>
<li class="chapter" data-level="9.3.3" data-path="reproducible-research-2.html"><a href="reproducible-research-2.html#browsing-history"><i class="fa fa-check"></i><b>9.3.3</b> Browsing history</a></li>
<li class="chapter" data-level="9.3.4" data-path="reproducible-research-2.html"><a href="reproducible-research-2.html#linking-local-repo-to-github-repo"><i class="fa fa-check"></i><b>9.3.4</b> Linking local repo to GitHub repo</a></li>
<li class="chapter" data-level="9.3.5" data-path="reproducible-research-2.html"><a href="reproducible-research-2.html#syncing-rstudio-and-github"><i class="fa fa-check"></i><b>9.3.5</b> Syncing RStudio and GitHub</a></li>
<li class="chapter" data-level="9.3.6" data-path="reproducible-research-2.html"><a href="reproducible-research-2.html#issues"><i class="fa fa-check"></i><b>9.3.6</b> Issues</a></li>
<li class="chapter" data-level="9.3.7" data-path="reproducible-research-2.html"><a href="reproducible-research-2.html#pull-request"><i class="fa fa-check"></i><b>9.3.7</b> Pull request</a></li>
<li class="chapter" data-level="9.3.8" data-path="reproducible-research-2.html"><a href="reproducible-research-2.html#merge-conflicts"><i class="fa fa-check"></i><b>9.3.8</b> Merge conflicts</a></li>
<li class="chapter" data-level="9.3.9" data-path="reproducible-research-2.html"><a href="reproducible-research-2.html#find-out-more"><i class="fa fa-check"></i><b>9.3.9</b> Find out more</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="reproducible-research-2.html"><a href="reproducible-research-2.html#in-course-exercise-8"><i class="fa fa-check"></i><b>9.4</b> In-course exercise</a><ul>
<li class="chapter" data-level="9.4.1" data-path="reproducible-research-2.html"><a href="reproducible-research-2.html#organizing-a-project"><i class="fa fa-check"></i><b>9.4.1</b> Organizing a project</a></li>
<li class="chapter" data-level="9.4.2" data-path="reproducible-research-2.html"><a href="reproducible-research-2.html#initializing-git-for-an-r-project"><i class="fa fa-check"></i><b>9.4.2</b> Initializing git for an R Project</a></li>
<li class="chapter" data-level="9.4.3" data-path="reproducible-research-2.html"><a href="reproducible-research-2.html#linking-your-project-with-a-github-repository"><i class="fa fa-check"></i><b>9.4.3</b> Linking your project with a GitHub repository</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>IV Part IV: Advanced</b></span></li>
<li class="chapter" data-level="10" data-path="entering-and-cleaning-data-3.html"><a href="entering-and-cleaning-data-3.html"><i class="fa fa-check"></i><b>10</b> Entering and cleaning data #3</a><ul>
<li class="chapter" data-level="10.1" data-path="entering-and-cleaning-data-3.html"><a href="entering-and-cleaning-data-3.html#pulling-online-data"><i class="fa fa-check"></i><b>10.1</b> Pulling online data</a><ul>
<li class="chapter" data-level="10.1.1" data-path="entering-and-cleaning-data-3.html"><a href="entering-and-cleaning-data-3.html#apis"><i class="fa fa-check"></i><b>10.1.1</b> APIs</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="entering-and-cleaning-data-3.html"><a href="entering-and-cleaning-data-3.html#example-r-api-wrapper-packages"><i class="fa fa-check"></i><b>10.2</b> Example R API wrapper packages</a></li>
<li class="chapter" data-level="10.3" data-path="entering-and-cleaning-data-3.html"><a href="entering-and-cleaning-data-3.html#tigris-package"><i class="fa fa-check"></i><b>10.3</b> <code>tigris</code> package</a></li>
<li class="chapter" data-level="10.4" data-path="entering-and-cleaning-data-3.html"><a href="entering-and-cleaning-data-3.html#countyweather"><i class="fa fa-check"></i><b>10.4</b> <code>countyweather</code></a></li>
<li class="chapter" data-level="10.5" data-path="entering-and-cleaning-data-3.html"><a href="entering-and-cleaning-data-3.html#cleaning-very-messy-data"><i class="fa fa-check"></i><b>10.5</b> Cleaning very messy data</a></li>
<li class="chapter" data-level="10.6" data-path="entering-and-cleaning-data-3.html"><a href="entering-and-cleaning-data-3.html#in-course-exercise-9"><i class="fa fa-check"></i><b>10.6</b> In-course exercise</a><ul>
<li class="chapter" data-level="10.6.1" data-path="entering-and-cleaning-data-3.html"><a href="entering-and-cleaning-data-3.html#working-with-an-api-wrapper-package"><i class="fa fa-check"></i><b>10.6.1</b> Working with an API wrapper package</a></li>
<li class="chapter" data-level="10.6.2" data-path="entering-and-cleaning-data-3.html"><a href="entering-and-cleaning-data-3.html#cleaning-very-messy-data-1"><i class="fa fa-check"></i><b>10.6.2</b> Cleaning very messy data</a></li>
</ul></li>
</ul></li>
<li class="appendix"><span><b>Appendices</b></span></li>
<li class="chapter" data-level="A" data-path="appendix-a-vocabulary.html"><a href="appendix-a-vocabulary.html"><i class="fa fa-check"></i><b>A</b> Appendix A: Vocabulary</a><ul>
<li class="chapter" data-level="A.1" data-path="appendix-a-vocabulary.html"><a href="appendix-a-vocabulary.html#quiz-1r-preliminaries"><i class="fa fa-check"></i><b>A.1</b> Quiz 1—R Preliminaries</a></li>
<li class="chapter" data-level="A.2" data-path="appendix-a-vocabulary.html"><a href="appendix-a-vocabulary.html#quiz-2entering-cleaning-data-1"><i class="fa fa-check"></i><b>A.2</b> Quiz 2—Entering / cleaning data #1</a></li>
<li class="chapter" data-level="A.3" data-path="appendix-a-vocabulary.html"><a href="appendix-a-vocabulary.html#quiz-3"><i class="fa fa-check"></i><b>A.3</b> Quiz 3</a></li>
<li class="chapter" data-level="A.4" data-path="appendix-a-vocabulary.html"><a href="appendix-a-vocabulary.html#quiz-4"><i class="fa fa-check"></i><b>A.4</b> Quiz 4</a></li>
<li class="chapter" data-level="A.5" data-path="appendix-a-vocabulary.html"><a href="appendix-a-vocabulary.html#quiz-5"><i class="fa fa-check"></i><b>A.5</b> Quiz 5</a></li>
<li class="chapter" data-level="A.6" data-path="appendix-a-vocabulary.html"><a href="appendix-a-vocabulary.html#quiz-6"><i class="fa fa-check"></i><b>A.6</b> Quiz 6</a></li>
<li class="chapter" data-level="A.7" data-path="appendix-a-vocabulary.html"><a href="appendix-a-vocabulary.html#quiz-7"><i class="fa fa-check"></i><b>A.7</b> Quiz 7</a></li>
<li class="chapter" data-level="A.8" data-path="appendix-a-vocabulary.html"><a href="appendix-a-vocabulary.html#quiz-8"><i class="fa fa-check"></i><b>A.8</b> Quiz 8</a></li>
<li class="chapter" data-level="A.9" data-path="appendix-a-vocabulary.html"><a href="appendix-a-vocabulary.html#quiz-9"><i class="fa fa-check"></i><b>A.9</b> Quiz 9</a></li>
</ul></li>
<li class="chapter" data-level="B" data-path="appendix-b-homework.html"><a href="appendix-b-homework.html"><i class="fa fa-check"></i><b>B</b> Appendix B: Homework</a><ul>
<li class="chapter" data-level="B.1" data-path="appendix-b-homework.html"><a href="appendix-b-homework.html#homework-1"><i class="fa fa-check"></i><b>B.1</b> Homework #1</a><ul>
<li class="chapter" data-level="B.1.1" data-path="appendix-b-homework.html"><a href="appendix-b-homework.html#option-1"><i class="fa fa-check"></i><b>B.1.1</b> Option 1</a></li>
<li class="chapter" data-level="B.1.2" data-path="appendix-b-homework.html"><a href="appendix-b-homework.html#option-2"><i class="fa fa-check"></i><b>B.1.2</b> Option 2</a></li>
<li class="chapter" data-level="B.1.3" data-path="appendix-b-homework.html"><a href="appendix-b-homework.html#special-swirl-commands"><i class="fa fa-check"></i><b>B.1.3</b> Special swirl commands</a></li>
</ul></li>
<li class="chapter" data-level="B.2" data-path="appendix-b-homework.html"><a href="appendix-b-homework.html#homework-2"><i class="fa fa-check"></i><b>B.2</b> Homework #2</a></li>
<li class="chapter" data-level="B.3" data-path="appendix-b-homework.html"><a href="appendix-b-homework.html#homework-3"><i class="fa fa-check"></i><b>B.3</b> Homework #3</a></li>
<li class="chapter" data-level="B.4" data-path="appendix-b-homework.html"><a href="appendix-b-homework.html#homework-4"><i class="fa fa-check"></i><b>B.4</b> Homework #4</a></li>
<li class="chapter" data-level="B.5" data-path="appendix-b-homework.html"><a href="appendix-b-homework.html#homework-5"><i class="fa fa-check"></i><b>B.5</b> Homework #5</a><ul>
<li class="chapter" data-level="B.5.1" data-path="appendix-b-homework.html"><a href="appendix-b-homework.html#setting-up-a-github-repository-for-this-project"><i class="fa fa-check"></i><b>B.5.1</b> Setting up a GitHub repository for this project</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">R Programming for Research</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="exploring-data-2" class="section level1">
<h1><span class="header-section-number">Chapter 7</span> Exploring data #2</h1>
<p><a href="https://github.com/geanders/RProgrammingForResearch/raw/master/slides/CourseNotes_Week7.pdf">Download</a> a pdf of the lecture slides covering this topic.</p>
<hr />
<div id="simple-statistical-tests-in-r" class="section level2">
<h2><span class="header-section-number">7.1</span> Simple statistical tests in R</h2>
<p>Let’s pull the fatal accident data just for the county that includes Las Vegas, NV.
Each US county has a unique identifier (FIPS code), composed of a two-digit state FIPS and a three-digit county FIPS code. The state FIPS for Nevada is 32; the county FIPS for Clark County is 003. Therefore, we can filter down to Clark County data in the FARS data we collected with the following code:</p>
<div class="sourceCode" id="cb654"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb654-1" title="1"><span class="kw">library</span>(readr)</a>
<a class="sourceLine" id="cb654-2" title="2"><span class="kw">library</span>(dplyr)</a>
<a class="sourceLine" id="cb654-3" title="3">clark_co_accidents &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;data/accident.csv&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb654-4" title="4"><span class="st">  </span><span class="kw">filter</span>(STATE <span class="op">==</span><span class="st"> </span><span class="dv">32</span> <span class="op">&amp;</span><span class="st"> </span>COUNTY <span class="op">==</span><span class="st"> </span><span class="dv">3</span>)</a></code></pre></div>
<p>We can also check the number of accidents:</p>
<div class="sourceCode" id="cb655"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb655-1" title="1">clark_co_accidents <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb655-2" title="2"><span class="st">  </span><span class="kw">count</span>()</a></code></pre></div>
<pre><code>## # A tibble: 1 x 1
##       n
##   &lt;int&gt;
## 1   201</code></pre>
<p>We want to test if the probability, on a Friday or Saturday, of a fatal accident occurring is higher than on other days of the week. Let’s clean the data up a bit as a start:</p>
<div class="sourceCode" id="cb657"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb657-1" title="1"><span class="kw">library</span>(tidyr)</a>
<a class="sourceLine" id="cb657-2" title="2"><span class="kw">library</span>(lubridate)</a>
<a class="sourceLine" id="cb657-3" title="3">clark_co_accidents &lt;-<span class="st"> </span>clark_co_accidents <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb657-4" title="4"><span class="st">  </span><span class="kw">select</span>(DAY, MONTH, YEAR) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb657-5" title="5"><span class="st">  </span><span class="kw">unite</span>(date, DAY, MONTH, YEAR, <span class="dt">sep =</span> <span class="st">&quot;-&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb657-6" title="6"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">date =</span> <span class="kw">dmy</span>(date))</a></code></pre></div>
<p>Here’s what the data looks like now:</p>
<div class="sourceCode" id="cb658"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb658-1" title="1">clark_co_accidents <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb658-2" title="2"><span class="st">  </span><span class="kw">slice</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>)</a></code></pre></div>
<pre><code>## # A tibble: 5 x 1
##   date      
##   &lt;date&gt;    
## 1 2016-01-10
## 2 2016-02-21
## 3 2016-01-06
## 4 2016-01-13
## 5 2016-02-18</code></pre>
<p>Next, let’s get the count of accidents by date:</p>
<div class="sourceCode" id="cb660"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb660-1" title="1">clark_co_accidents &lt;-<span class="st"> </span>clark_co_accidents <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb660-2" title="2"><span class="st">  </span><span class="kw">group_by</span>(date) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb660-3" title="3"><span class="st">  </span><span class="kw">count</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb660-4" title="4"><span class="st">  </span><span class="kw">ungroup</span>()</a>
<a class="sourceLine" id="cb660-5" title="5">clark_co_accidents <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb660-6" title="6"><span class="st">  </span><span class="kw">slice</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>)</a></code></pre></div>
<pre><code>## # A tibble: 3 x 2
##   date           n
##   &lt;date&gt;     &lt;int&gt;
## 1 2016-01-03     1
## 2 2016-01-06     1
## 3 2016-01-09     3</code></pre>
<p>We’re missing the dates without a fatal crash, so let’s add those. First, create a dataframe
with all dates in 2016:</p>
<div class="sourceCode" id="cb662"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb662-1" title="1">all_dates &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">date =</span> <span class="kw">seq</span>(<span class="kw">ymd</span>(<span class="st">&quot;2016-01-01&quot;</span>), </a>
<a class="sourceLine" id="cb662-2" title="2">                                   <span class="kw">ymd</span>(<span class="st">&quot;2016-12-31&quot;</span>), <span class="dt">by =</span> <span class="dv">1</span>))</a>
<a class="sourceLine" id="cb662-3" title="3">all_dates <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb662-4" title="4"><span class="st">  </span><span class="kw">slice</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>)</a></code></pre></div>
<pre><code>## # A tibble: 5 x 1
##   date      
##   &lt;date&gt;    
## 1 2016-01-01
## 2 2016-01-02
## 3 2016-01-03
## 4 2016-01-04
## 5 2016-01-05</code></pre>
<p>Then merge this with the original dataset on Las Vegas fatal crashes and make any day missing from the fatal crashes dataset have a “0” for number of fatal accidents (<code>n</code>):</p>
<div class="sourceCode" id="cb664"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb664-1" title="1">clark_co_accidents &lt;-<span class="st"> </span>clark_co_accidents <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb664-2" title="2"><span class="st">  </span><span class="kw">right_join</span>(all_dates, <span class="dt">by =</span> <span class="st">&quot;date&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb664-3" title="3"><span class="st">  </span><span class="co"># If `n` is missing, set to 0. Otherwise keep value.</span></a>
<a class="sourceLine" id="cb664-4" title="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">n =</span> <span class="kw">ifelse</span>(<span class="kw">is.na</span>(n), <span class="dv">0</span>, n))</a>
<a class="sourceLine" id="cb664-5" title="5">clark_co_accidents <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb664-6" title="6"><span class="st">  </span><span class="kw">slice</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>)</a></code></pre></div>
<pre><code>## # A tibble: 3 x 2
##   date           n
##   &lt;date&gt;     &lt;dbl&gt;
## 1 2016-01-01     0
## 2 2016-01-02     0
## 3 2016-01-03     1</code></pre>
<p>Next, let’s add some information about day of week and weekend:</p>
<div class="sourceCode" id="cb666"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb666-1" title="1">clark_co_accidents &lt;-<span class="st"> </span>clark_co_accidents <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb666-2" title="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">weekday =</span> <span class="kw">wday</span>(date, <span class="dt">label =</span> <span class="ot">TRUE</span>), </a>
<a class="sourceLine" id="cb666-3" title="3">         <span class="dt">weekend =</span> weekday <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Fri&quot;</span>, <span class="st">&quot;Sat&quot;</span>))</a>
<a class="sourceLine" id="cb666-4" title="4">clark_co_accidents <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb666-5" title="5"><span class="st">  </span><span class="kw">slice</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>)</a></code></pre></div>
<pre><code>## # A tibble: 3 x 4
##   date           n weekday weekend
##   &lt;date&gt;     &lt;dbl&gt; &lt;ord&gt;   &lt;lgl&gt;  
## 1 2016-01-01     0 Fri     TRUE   
## 2 2016-01-02     0 Sat     TRUE   
## 3 2016-01-03     1 Sun     FALSE</code></pre>
<p>Now let’s calculate the probability that a day has at least one fatal crash, separately for weekends and weekdays:</p>
<div class="sourceCode" id="cb668"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb668-1" title="1">clark_co_accidents &lt;-<span class="st"> </span>clark_co_accidents <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb668-2" title="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">any_crash =</span> n <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>)</a>
<a class="sourceLine" id="cb668-3" title="3">crash_prob &lt;-<span class="st"> </span>clark_co_accidents <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb668-4" title="4"><span class="st">  </span><span class="kw">group_by</span>(weekend) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb668-5" title="5"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">n_days =</span> <span class="kw">n</span>(),</a>
<a class="sourceLine" id="cb668-6" title="6">            <span class="dt">crash_days =</span> <span class="kw">sum</span>(any_crash)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb668-7" title="7"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">prob_crash_day =</span> crash_days <span class="op">/</span><span class="st"> </span>n_days)</a>
<a class="sourceLine" id="cb668-8" title="8">crash_prob</a></code></pre></div>
<pre><code>## # A tibble: 2 x 4
##   weekend n_days crash_days prob_crash_day
##   &lt;lgl&gt;    &lt;int&gt;      &lt;int&gt;          &lt;dbl&gt;
## 1 FALSE      260        107          0.412
## 2 TRUE       106         43          0.406</code></pre>
<p>In R, you can use <code>prop.test</code> to test if two proportions are equal. Inputs include the total number of trials in each group (<code>n =</code>) and the number of “successes”" (<code>x =</code>):</p>
<div class="sourceCode" id="cb670"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb670-1" title="1"><span class="kw">prop.test</span>(<span class="dt">x =</span> crash_prob<span class="op">$</span>crash_days, </a>
<a class="sourceLine" id="cb670-2" title="2">          <span class="dt">n =</span> crash_prob<span class="op">$</span>n_days)</a></code></pre></div>
<pre><code>## 
##  2-sample test for equality of proportions with continuity
##  correction
## 
## data:  crash_prob$crash_days out of crash_prob$n_days
## X-squared = 1.5978e-30, df = 1, p-value = 1
## alternative hypothesis: two.sided
## 95 percent confidence interval:
##  -0.1109757  0.1227318
## sample estimates:
##    prop 1    prop 2 
## 0.4115385 0.4056604</code></pre>
<p>I won’t be teaching in this course how to find the correct statistical test. That’s
something you’ll hopefully learn in a statistics course. There are also a variety of books that can help you with this, including some that you can access free online through CSU’s library. One servicable introduction is “Statistical Analysis with R for Dummies”.</p>
<p>You can create an object from the output of any statistical test in R. Typically, this will be (at least at some level) in an object class called a “list”:</p>
<div class="sourceCode" id="cb672"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb672-1" title="1">vegas_test &lt;-<span class="st"> </span><span class="kw">prop.test</span>(<span class="dt">x =</span> crash_prob<span class="op">$</span>crash_days, </a>
<a class="sourceLine" id="cb672-2" title="2">                        <span class="dt">n =</span> crash_prob<span class="op">$</span>n_days)</a>
<a class="sourceLine" id="cb672-3" title="3"><span class="kw">is.list</span>(vegas_test)</a></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>So far, we’ve mostly worked with two object types in R, <strong>dataframes</strong> and <strong>vectors</strong>. In the next subsection we’ll look more at two object classes we haven’t looked at much,
<strong>matrices</strong> and <strong>lists</strong>. Both have important roles once you start applying more
advanced methods to analyze your data.</p>
</div>
<div id="matrices" class="section level2">
<h2><span class="header-section-number">7.2</span> Matrices</h2>
<p>A matrix is like a data frame, but all the values in all columns must be of the same class (e.g., numeric, character). R uses matrices a lot for its underlying math (e.g., for the linear algebra operations required for fitting regression models). R can do matrix operations quite quickly.</p>
<p>You can create a matrix with the <code>matrix</code> function. Input a vector with the values to fill the matrix and <code>ncol</code> to set the number of columns:</p>
<div class="sourceCode" id="cb674"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb674-1" title="1">foo &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dt">ncol =</span> <span class="dv">5</span>)</a>
<a class="sourceLine" id="cb674-2" title="2">foo</a></code></pre></div>
<pre><code>##      [,1] [,2] [,3] [,4] [,5]
## [1,]    1    3    5    7    9
## [2,]    2    4    6    8   10</code></pre>
<p>By default, the matrix will fill up by column. You can fill it by row with the <code>byrow</code> function:</p>
<div class="sourceCode" id="cb676"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb676-1" title="1">foo &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dt">ncol =</span> <span class="dv">5</span>, <span class="dt">byrow =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb676-2" title="2">foo</a></code></pre></div>
<pre><code>##      [,1] [,2] [,3] [,4] [,5]
## [1,]    1    2    3    4    5
## [2,]    6    7    8    9   10</code></pre>
<p>In certain situations, you might want to work with a matrix instead of a data frame (for example, in cases where you were concerned about speed – a matrix is more memory efficient than the corresponding data frame). If you want to convert a data frame to a matrix, you can use the <code>as.matrix</code> function:</p>
<div class="sourceCode" id="cb678"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb678-1" title="1">foo &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">col_1 =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">2</span>, <span class="dt">col_2 =</span> <span class="dv">3</span><span class="op">:</span><span class="dv">4</span>,</a>
<a class="sourceLine" id="cb678-2" title="2">                  <span class="dt">col_3 =</span> <span class="dv">5</span><span class="op">:</span><span class="dv">6</span>, <span class="dt">col_4 =</span> <span class="dv">7</span><span class="op">:</span><span class="dv">8</span>,</a>
<a class="sourceLine" id="cb678-3" title="3">                  <span class="dt">col_5 =</span> <span class="dv">9</span><span class="op">:</span><span class="dv">10</span>)</a>
<a class="sourceLine" id="cb678-4" title="4">(foo &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(foo))</a></code></pre></div>
<pre><code>##      col_1 col_2 col_3 col_4 col_5
## [1,]     1     3     5     7     9
## [2,]     2     4     6     8    10</code></pre>
<p>You can index matrices with square brackets, just like data frames:</p>
<div class="sourceCode" id="cb680"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb680-1" title="1">foo[<span class="dv">1</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">2</span>]</a></code></pre></div>
<pre><code>## col_1 col_2 
##     1     3</code></pre>
<p>You cannot, however, use <code>dplyr</code> functions with matrices:</p>
<div class="sourceCode" id="cb682"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb682-1" title="1">foo <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(col_<span class="dv">1</span> <span class="op">==</span><span class="st"> </span><span class="dv">1</span>)</a></code></pre></div>
<p>All elements in a matrix must have the same class.</p>
<p>The matrix will default to make all values the most general class of any of the values, in any column. For example, if we replaced one numeric value with the character “a”, everything would turn into a character:</p>
<div class="sourceCode" id="cb683"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb683-1" title="1">foo[<span class="dv">1</span>, <span class="dv">1</span>] &lt;-<span class="st"> &quot;a&quot;</span></a>
<a class="sourceLine" id="cb683-2" title="2">foo</a></code></pre></div>
<pre><code>##      col_1 col_2 col_3 col_4 col_5
## [1,] &quot;a&quot;   &quot;3&quot;   &quot;5&quot;   &quot;7&quot;   &quot;9&quot;  
## [2,] &quot;2&quot;   &quot;4&quot;   &quot;6&quot;   &quot;8&quot;   &quot;10&quot;</code></pre>
<hr />
</div>
<div id="lists" class="section level2">
<h2><span class="header-section-number">7.3</span> Lists</h2>
<p>A list has different elements, just like a data frame has different columns. However, the different elements of a list can have different lengths (unlike the columns of a data frame). The different elements can also have different classes.</p>
<div class="sourceCode" id="cb685"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb685-1" title="1">bar &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">some_letters =</span> letters[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>],</a>
<a class="sourceLine" id="cb685-2" title="2">            <span class="dt">some_numbers =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>, </a>
<a class="sourceLine" id="cb685-3" title="3">            <span class="dt">some_logical_values =</span> <span class="kw">c</span>(<span class="ot">TRUE</span>, <span class="ot">FALSE</span>))</a>
<a class="sourceLine" id="cb685-4" title="4">bar</a></code></pre></div>
<pre><code>## $some_letters
## [1] &quot;a&quot; &quot;b&quot; &quot;c&quot;
## 
## $some_numbers
## [1] 1 2 3 4 5
## 
## $some_logical_values
## [1]  TRUE FALSE</code></pre>
<p>To index an element from a list, use double square brackets. You can use bracket indexing either with numbers (which element in the list?) or with names:</p>
<div class="sourceCode" id="cb687"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb687-1" title="1">bar[[<span class="dv">1</span>]]</a></code></pre></div>
<pre><code>## [1] &quot;a&quot; &quot;b&quot; &quot;c&quot;</code></pre>
<div class="sourceCode" id="cb689"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb689-1" title="1">bar[[<span class="st">&quot;some_numbers&quot;</span>]]</a></code></pre></div>
<pre><code>## [1] 1 2 3 4 5</code></pre>
<p>You can also index lists with the <code>$</code> operator:</p>
<div class="sourceCode" id="cb691"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb691-1" title="1">bar<span class="op">$</span>some_logical_values</a></code></pre></div>
<pre><code>## [1]  TRUE FALSE</code></pre>
<p>To access a specific value within a list element we can index the element e.g.:</p>
<div class="sourceCode" id="cb693"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb693-1" title="1">bar[[<span class="dv">1</span>]][[<span class="dv">2</span>]]</a></code></pre></div>
<pre><code>## [1] &quot;b&quot;</code></pre>
<p>Lists can be used to contain data with an unusual structure and / or lots of different components. For example, the information from fitting a regression is often stored as a list:</p>
<div class="sourceCode" id="cb695"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb695-1" title="1">my_mod &lt;-<span class="st"> </span><span class="kw">glm</span>(<span class="kw">rnorm</span>(<span class="dv">10</span>) <span class="op">~</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>))</a>
<a class="sourceLine" id="cb695-2" title="2"><span class="kw">is.list</span>(my_mod)</a></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>The <code>names</code> function returns the name of each element in the list:</p>
<div class="sourceCode" id="cb697"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb697-1" title="1"><span class="kw">head</span>(<span class="kw">names</span>(my_mod), <span class="dv">3</span>)</a></code></pre></div>
<pre><code>## [1] &quot;coefficients&quot;  &quot;residuals&quot;     &quot;fitted.values&quot;</code></pre>
<div class="sourceCode" id="cb699"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb699-1" title="1">my_mod[[<span class="st">&quot;coefficients&quot;</span>]]</a></code></pre></div>
<pre><code>## (Intercept)     c(1:10) 
##  0.09018544  0.11325662</code></pre>
<p>A list can even contain other lists. We can use the <code>str</code> function to see the structure of a list:</p>
<div class="sourceCode" id="cb701"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb701-1" title="1">a_list &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="kw">list</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>), <span class="kw">list</span>(<span class="dv">1</span>, <span class="dv">2</span>))</a>
<a class="sourceLine" id="cb701-2" title="2"></a>
<a class="sourceLine" id="cb701-3" title="3"><span class="kw">str</span>(a_list)</a></code></pre></div>
<pre><code>## List of 2
##  $ :List of 2
##   ..$ : chr &quot;a&quot;
##   ..$ : chr &quot;b&quot;
##  $ :List of 2
##   ..$ : num 1
##   ..$ : num 2</code></pre>
<p>Sometimes you’ll see unnecessary lists-of-lists, perhaps when importing data into R created. Or a list with multiple elements that you would like to combine. You can remove a level of hierarchy from a list using the <code>flatten</code> function from the <code>purrr</code> package:</p>
<div class="sourceCode" id="cb703"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb703-1" title="1"><span class="kw">library</span>(purrr)</a>
<a class="sourceLine" id="cb703-2" title="2">a_list</a></code></pre></div>
<pre><code>## [[1]]
## [[1]][[1]]
## [1] &quot;a&quot;
## 
## [[1]][[2]]
## [1] &quot;b&quot;
## 
## 
## [[2]]
## [[2]][[1]]
## [1] 1
## 
## [[2]][[2]]
## [1] 2</code></pre>
<div class="sourceCode" id="cb705"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb705-1" title="1"><span class="kw">flatten</span>(a_list)</a></code></pre></div>
<pre><code>## [[1]]
## [1] &quot;a&quot;
## 
## [[2]]
## [1] &quot;b&quot;
## 
## [[3]]
## [1] 1
## 
## [[4]]
## [1] 2</code></pre>
<p>Let’s look at the list object from the statistical test we ran for Las Vegas:</p>
<div class="sourceCode" id="cb707"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb707-1" title="1"><span class="kw">str</span>(vegas_test)</a></code></pre></div>
<pre><code>## List of 9
##  $ statistic  : Named num 1.6e-30
##   ..- attr(*, &quot;names&quot;)= chr &quot;X-squared&quot;
##  $ parameter  : Named num 1
##   ..- attr(*, &quot;names&quot;)= chr &quot;df&quot;
##  $ p.value    : num 1
##  $ estimate   : Named num [1:2] 0.412 0.406
##   ..- attr(*, &quot;names&quot;)= chr [1:2] &quot;prop 1&quot; &quot;prop 2&quot;
##  $ null.value : NULL
##  $ conf.int   : num [1:2] -0.111 0.123
##   ..- attr(*, &quot;conf.level&quot;)= num 0.95
##  $ alternative: chr &quot;two.sided&quot;
##  $ method     : chr &quot;2-sample test for equality of proportions with continuity correction&quot;
##  $ data.name  : chr &quot;crash_prob$crash_days out of crash_prob$n_days&quot;
##  - attr(*, &quot;class&quot;)= chr &quot;htest&quot;</code></pre>
<p>Using <code>str</code> to print out the list’s structure doesn’t produce the easiest to digest output. We can use the <code>jsonedit</code> function from the <code>listviewer</code> package to create a widget in the <code>viewer</code> pane to more esily explore our list.</p>
<div class="sourceCode" id="cb709"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb709-1" title="1"><span class="kw">library</span>(listviewer)</a>
<a class="sourceLine" id="cb709-2" title="2"><span class="kw">jsonedit</span>(vegas_test)</a></code></pre></div>
<p>We can pull out an element using the <code>$</code> notation:</p>
<div class="sourceCode" id="cb710"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb710-1" title="1">vegas_test<span class="op">$</span>p.value</a></code></pre></div>
<pre><code>## [1] 1</code></pre>
<p>Or using the <code>[[</code> notation:</p>
<div class="sourceCode" id="cb712"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb712-1" title="1">vegas_test[[<span class="dv">4</span>]]</a></code></pre></div>
<pre><code>##    prop 1    prop 2 
## 0.4115385 0.4056604</code></pre>
<p>You may have noticed, though, that this output is not a tidy dataframe.
Ack! That means we can’t use all the tidyverse tricks we’ve learned so far in the course!
Fortunately, David Robinson noticed this problem and came up with a package called <code>broom</code> that can “tidy up” a lot of these kinds of objects.</p>
<p>The <code>broom</code> package has three main functions:</p>
<ul>
<li><code>glance</code>: Return a one-row, tidy dataframe from a model or other R object</li>
<li><code>tidy</code>: Return a tidy dataframe from a model or other R object</li>
<li><code>augment</code>: “Augment” the dataframe you input to the statistical function</li>
</ul>
<p>Here is the output for <code>tidy</code> for the <code>vegas_test</code> object (<code>augment</code>
won’t work for this type of object, and <code>glance</code> gives the same thing as <code>tidy</code>):</p>
<div class="sourceCode" id="cb714"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb714-1" title="1"><span class="kw">library</span>(broom)</a>
<a class="sourceLine" id="cb714-2" title="2"><span class="kw">tidy</span>(vegas_test)</a></code></pre></div>
<pre><code>## # A tibble: 1 x 9
##   estimate1 estimate2 statistic p.value parameter conf.low conf.high method
##       &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt; 
## 1     0.412     0.406  1.60e-30   1.000         1   -0.111     0.123 2-sam…
## # … with 1 more variable: alternative &lt;chr&gt;</code></pre>
<hr />
</div>
<div id="apply-a-test-multiple-times" class="section level2">
<h2><span class="header-section-number">7.4</span> Apply a test multiple times</h2>
<p>Often, we don’t want to just apply a statistical test to our entire data set.</p>
<p>Let’s look at an example from the <code>microbiome package</code>.</p>
<div class="sourceCode" id="cb716"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb716-1" title="1"><span class="kw">library</span>(microbiome)</a>
<a class="sourceLine" id="cb716-2" title="2"><span class="kw">data</span>(peerj32)</a>
<a class="sourceLine" id="cb716-3" title="3"><span class="kw">print</span>(<span class="kw">names</span>(peerj32))</a></code></pre></div>
<pre><code>## [1] &quot;lipids&quot;   &quot;microbes&quot; &quot;meta&quot;     &quot;phyloseq&quot;</code></pre>
<p>Like we saw before, the list-like <code>phyloseq</code> objects require a little tidying before we can use them easiliy.</p>
<div class="sourceCode" id="cb718"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb718-1" title="1"><span class="kw">library</span>(dplyr)</a>
<a class="sourceLine" id="cb718-2" title="2">peerj32_tibble &lt;-<span class="st"> </span>(<span class="kw">psmelt</span>(peerj32<span class="op">$</span>phyloseq)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb718-3" title="3"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(<span class="op">-</span>Sample) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb718-4" title="4"><span class="st">  </span><span class="kw">rename_all</span>(tolower) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb718-5" title="5"><span class="st">  </span><span class="kw">as_tibble</span>()</a></code></pre></div>
<pre><code>## # A tibble: 3 x 10
##   otu     abundance  time sex    subject sample  group phylum family genus 
##   &lt;chr&gt;       &lt;dbl&gt; &lt;int&gt; &lt;fct&gt;  &lt;fct&gt;   &lt;chr&gt;   &lt;fct&gt; &lt;fct&gt;  &lt;fct&gt;  &lt;fct&gt; 
## 1 Bacter…      9734     1 male   S19     sample… LGG   Bacte… Bacte… Bacte…
## 2 Bacter…      5883     1 female S14     sample… Plac… Bacte… Bacte… Bacte…
## 3 Bacter…      5134     2 female S8      sample… LGG   Bacte… Bacte… Bacte…</code></pre>
<p>We can make a plot from the resulting tibble to help us explore the data.</p>
<div class="sourceCode" id="cb720"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb720-1" title="1"><span class="kw">library</span>(ggplot2)</a>
<a class="sourceLine" id="cb720-2" title="2"><span class="kw">ggplot</span>(peerj32_tibble, <span class="kw">aes</span>(<span class="dt">x =</span> subject, <span class="dt">y =</span> abundance, <span class="dt">color =</span> sex)) <span class="op">+</span></a>
<a class="sourceLine" id="cb720-3" title="3"><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb720-4" title="4"><span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb720-5" title="5"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>phylum, <span class="dt">ncol =</span> <span class="dv">4</span>, <span class="dt">scales =</span> <span class="st">&quot;free&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb720-6" title="6"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb720-7" title="7">        <span class="dt">legend.position =</span> <span class="st">&quot;top&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb720-8" title="8"><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Subject ID&quot;</span>)</a></code></pre></div>
<p><img src="RProgrammingForResearch_files/figure-html/unnamed-chunk-404-1.png" width="960" /></p>
<p>We can group the data by <code>phylum</code> and <code>group</code> and then use the <code>nest</code> function from the <code>tidyr</code> package to create a new dataframe containing the nested data:</p>
<div class="sourceCode" id="cb721"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb721-1" title="1"><span class="kw">library</span>(tidyr)</a>
<a class="sourceLine" id="cb721-2" title="2">nested_data &lt;-<span class="st"> </span>peerj32_tibble <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb721-3" title="3"><span class="st">  </span><span class="kw">group_by</span>(phylum, group) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb721-4" title="4"><span class="st">  </span><span class="kw">nest</span>()</a></code></pre></div>
<div class="sourceCode" id="cb722"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb722-1" title="1"><span class="kw">slice</span>(nested_data, <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>)</a></code></pre></div>
<pre><code>## # A tibble: 16 x 3
## # Groups:   group, phylum [16]
##    group   phylum                    data
##    &lt;fct&gt;   &lt;fct&gt;           &lt;list&lt;df[,8]&gt;&gt;
##  1 LGG     Actinobacteria       [128 × 8]
##  2 LGG     Bacteroidetes        [256 × 8]
##  3 LGG     Cyanobacteria         [16 × 8]
##  4 LGG     Firmicutes         [1,216 × 8]
##  5 LGG     Fusobacteria          [16 × 8]
##  6 LGG     Proteobacteria       [416 × 8]
##  7 LGG     Spirochaetes          [16 × 8]
##  8 LGG     Verrucomicrobia       [16 × 8]
##  9 Placebo Actinobacteria       [224 × 8]
## 10 Placebo Bacteroidetes        [448 × 8]
## 11 Placebo Cyanobacteria         [28 × 8]
## 12 Placebo Firmicutes         [2,128 × 8]
## 13 Placebo Fusobacteria          [28 × 8]
## 14 Placebo Proteobacteria       [728 × 8]
## 15 Placebo Spirochaetes          [28 × 8]
## 16 Placebo Verrucomicrobia       [28 × 8]</code></pre>
<p>We can then use the <code>map</code> function from the <code>purrr</code> package to apply functions to each nested dataframe. Let’s start by counting the rows in each nested dataframe and filtering out dataframes with less than 25 rows.</p>
<div class="sourceCode" id="cb724"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb724-1" title="1"><span class="kw">library</span>(purrr)</a>
<a class="sourceLine" id="cb724-2" title="2"></a>
<a class="sourceLine" id="cb724-3" title="3">filtered_data &lt;-<span class="st"> </span>nested_data <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb724-4" title="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">n_rows =</span> purrr<span class="op">::</span><span class="kw">map</span>(data, <span class="op">~</span><span class="st"> </span><span class="kw">nrow</span>(.x))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb724-5" title="5"><span class="st">  </span><span class="kw">filter</span>(n_rows <span class="op">&gt;</span><span class="st"> </span><span class="dv">25</span>)</a></code></pre></div>
<p>Now let’s perform a t-test on each out the nested dataframes. Remember, each nested dataframe is one unique combination of phylum and group.</p>
<div class="sourceCode" id="cb725"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb725-1" title="1">t_tests &lt;-<span class="st"> </span>filtered_data <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb725-2" title="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">t_test =</span> purrr<span class="op">::</span><span class="kw">map</span>(data, <span class="op">~</span><span class="kw">t.test</span>(abundance <span class="op">~</span><span class="st"> </span>sex, <span class="dt">data =</span> .x)))</a></code></pre></div>
<div class="sourceCode" id="cb726"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb726-1" title="1">t_tests</a></code></pre></div>
<pre><code>## # A tibble: 12 x 5
## # Groups:   group, phylum [12]
##    group   phylum                    data n_rows    t_test 
##    &lt;fct&gt;   &lt;fct&gt;           &lt;list&lt;df[,8]&gt;&gt; &lt;list&gt;    &lt;list&gt; 
##  1 LGG     Bacteroidetes        [256 × 8] &lt;int [1]&gt; &lt;htest&gt;
##  2 Placebo Bacteroidetes        [448 × 8] &lt;int [1]&gt; &lt;htest&gt;
##  3 Placebo Firmicutes         [2,128 × 8] &lt;int [1]&gt; &lt;htest&gt;
##  4 LGG     Firmicutes         [1,216 × 8] &lt;int [1]&gt; &lt;htest&gt;
##  5 Placebo Verrucomicrobia       [28 × 8] &lt;int [1]&gt; &lt;htest&gt;
##  6 LGG     Actinobacteria       [128 × 8] &lt;int [1]&gt; &lt;htest&gt;
##  7 Placebo Actinobacteria       [224 × 8] &lt;int [1]&gt; &lt;htest&gt;
##  8 Placebo Proteobacteria       [728 × 8] &lt;int [1]&gt; &lt;htest&gt;
##  9 LGG     Proteobacteria       [416 × 8] &lt;int [1]&gt; &lt;htest&gt;
## 10 Placebo Cyanobacteria         [28 × 8] &lt;int [1]&gt; &lt;htest&gt;
## 11 Placebo Fusobacteria          [28 × 8] &lt;int [1]&gt; &lt;htest&gt;
## 12 Placebo Spirochaetes          [28 × 8] &lt;int [1]&gt; &lt;htest&gt;</code></pre>
<p>The resulting dataframe contains a new column, which contains the model objects. Just as we mapped the <code>t.test</code> function, we can map the <em>tidying</em> functions from the <code>broom</code> package to extract the information we want from the nested model objects.</p>
<div class="sourceCode" id="cb728"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb728-1" title="1">summary &lt;-<span class="st"> </span>t_tests <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb728-2" title="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">summary =</span> purrr<span class="op">::</span><span class="kw">map</span>(t_test, broom<span class="op">::</span>glance))</a></code></pre></div>
<div class="sourceCode" id="cb729"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb729-1" title="1">summary</a></code></pre></div>
<pre><code>## # A tibble: 12 x 6
## # Groups:   group, phylum [12]
##    group   phylum                    data n_rows    t_test summary         
##    &lt;fct&gt;   &lt;fct&gt;           &lt;list&lt;df[,8]&gt;&gt; &lt;list&gt;    &lt;list&gt; &lt;list&gt;          
##  1 LGG     Bacteroidetes        [256 × 8] &lt;int [1]&gt; &lt;htes… &lt;tibble [1 × 10…
##  2 Placebo Bacteroidetes        [448 × 8] &lt;int [1]&gt; &lt;htes… &lt;tibble [1 × 10…
##  3 Placebo Firmicutes         [2,128 × 8] &lt;int [1]&gt; &lt;htes… &lt;tibble [1 × 10…
##  4 LGG     Firmicutes         [1,216 × 8] &lt;int [1]&gt; &lt;htes… &lt;tibble [1 × 10…
##  5 Placebo Verrucomicrobia       [28 × 8] &lt;int [1]&gt; &lt;htes… &lt;tibble [1 × 10…
##  6 LGG     Actinobacteria       [128 × 8] &lt;int [1]&gt; &lt;htes… &lt;tibble [1 × 10…
##  7 Placebo Actinobacteria       [224 × 8] &lt;int [1]&gt; &lt;htes… &lt;tibble [1 × 10…
##  8 Placebo Proteobacteria       [728 × 8] &lt;int [1]&gt; &lt;htes… &lt;tibble [1 × 10…
##  9 LGG     Proteobacteria       [416 × 8] &lt;int [1]&gt; &lt;htes… &lt;tibble [1 × 10…
## 10 Placebo Cyanobacteria         [28 × 8] &lt;int [1]&gt; &lt;htes… &lt;tibble [1 × 10…
## 11 Placebo Fusobacteria          [28 × 8] &lt;int [1]&gt; &lt;htes… &lt;tibble [1 × 10…
## 12 Placebo Spirochaetes          [28 × 8] &lt;int [1]&gt; &lt;htes… &lt;tibble [1 × 10…</code></pre>
<p>The final step is to return a tidy dataframe, we can do this using the <code>unnest</code> function from the <code>tidyr</code> package. Note: it is also wise to <code>ungroup</code> after you are done operating on your grouped variables - you may run into problems if you forget your dataframe is grouped later on!</p>
<div class="sourceCode" id="cb731"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb731-1" title="1">unnested &lt;-<span class="st"> </span>summary <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb731-2" title="2"><span class="st">  </span><span class="kw">unnest</span>(summary) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb731-3" title="3"><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb731-4" title="4"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(group, phylum, p.value)</a></code></pre></div>
<div class="sourceCode" id="cb732"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb732-1" title="1">unnested</a></code></pre></div>
<pre><code>## # A tibble: 12 x 3
##    group   phylum          p.value
##    &lt;fct&gt;   &lt;fct&gt;             &lt;dbl&gt;
##  1 LGG     Bacteroidetes    0.930 
##  2 Placebo Bacteroidetes    0.828 
##  3 Placebo Firmicutes       0.344 
##  4 LGG     Firmicutes       0.131 
##  5 Placebo Verrucomicrobia  0.106 
##  6 LGG     Actinobacteria   0.600 
##  7 Placebo Actinobacteria   0.997 
##  8 Placebo Proteobacteria   0.856 
##  9 LGG     Proteobacteria   0.0111
## 10 Placebo Cyanobacteria    0.193 
## 11 Placebo Fusobacteria     0.265 
## 12 Placebo Spirochaetes     0.728</code></pre>
<p>We can then plot the results. Let’s do this for the “LGG” (non-placebo) group, using our principles for good graphics.</p>
<div class="sourceCode" id="cb734"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb734-1" title="1">p_data &lt;-<span class="st"> </span>unnested <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb734-2" title="2"><span class="st">  </span><span class="kw">filter</span>(group <span class="op">==</span><span class="st"> &quot;LGG&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb734-3" title="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">phylum =</span> <span class="kw">fct_reorder</span>(phylum, p.value))</a>
<a class="sourceLine" id="cb734-4" title="4">  </a>
<a class="sourceLine" id="cb734-5" title="5"><span class="kw">ggplot</span>(p_data, <span class="kw">aes</span>(<span class="dt">y =</span> p.value, <span class="dt">x =</span> phylum)) <span class="op">+</span></a>
<a class="sourceLine" id="cb734-6" title="6"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>group) <span class="op">+</span></a>
<a class="sourceLine" id="cb734-7" title="7"><span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">stat=</span><span class="st">&quot;identity&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;grey90&quot;</span>, <span class="dt">color =</span> <span class="st">&quot;grey20&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb734-8" title="8"><span class="st">  </span><span class="kw">coord_flip</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb734-9" title="9"><span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb734-10" title="10"><span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;Difference in abundance by gender&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb734-11" title="11"><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;p-value from t-test&quot;</span>)</a></code></pre></div>
<p><img src="RProgrammingForResearch_files/figure-html/unnamed-chunk-414-1.png" width="672" /></p>
</div>
<div id="regression-models" class="section level2">
<h2><span class="header-section-number">7.5</span> Regression models</h2>
<div id="formula-structure" class="section level3">
<h3><span class="header-section-number">7.5.1</span> Formula structure</h3>
<p><em>Regression models</em> can be used to estimate how the expected value of a <em>dependent variable</em> changes as <em>independent variables</em> change. </p>
<p>In R, regression formulas take this structure:</p>
<div class="sourceCode" id="cb735"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb735-1" title="1"><span class="co">## Generic code</span></a>
<a class="sourceLine" id="cb735-2" title="2">[response variable] <span class="op">~</span><span class="st"> </span>[indep. var. <span class="dv">1</span>] <span class="op">+</span><span class="st">  </span>[indep. var. <span class="dv">2</span>] <span class="op">+</span><span class="st"> </span>...</a></code></pre></div>
<p>Notice that a tilde, <code>~</code>, is used to separate the independent and dependent variables and that a plus sign, <code>+</code>, is used to join independent variables. This format mimics the statistical notation:</p>
<p><span class="math display">\[
Y_i \sim X_1 + X_2 + X_3
\]</span></p>
<p>You will use this type of structure in R fo a lot of different function calls, including those for linear models (fit with the <code>lm</code> function) and generalized linear models (fit with the <code>glm</code> function).</p>
<p>There are some conventions that can be used in R formulas. Common ones include:</p>
<table>
<colgroup>
<col width="17%" />
<col width="82%" />
</colgroup>
<thead>
<tr class="header">
<th align="center">Convention</th>
<th align="left">Meaning</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center"><code>I()</code></td>
<td align="left">evaluate the formula inside <code>I()</code> before fitting (e.g.,
<code>I(x1 + x2)</code>)</td>
</tr>
<tr class="even">
<td align="center"><code>:</code></td>
<td align="left">fit the interaction between <code>x1</code> and <code>x2</code> variables</td>
</tr>
<tr class="odd">
<td align="center"><code>*</code></td>
<td align="left">fit the main effects and interaction for both variables
(e.g., <code>x1*x2</code> equals <code>x1 + x2 + x1:x2</code>)</td>
</tr>
<tr class="even">
<td align="center"><code>.</code></td>
<td align="left">include as independent variables all variables other than
the response (e.g., <code>y ~ .</code>)</td>
</tr>
<tr class="odd">
<td align="center"><code>1</code></td>
<td align="left">intercept (e.g., <code>y ~ 1</code> for an intercept-only model)</td>
</tr>
<tr class="even">
<td align="center"><code>-</code></td>
<td align="left">do not include a variable in the data frame as an
independent variables (e.g., <code>y ~ . - x1</code>); usually used
in conjunction with <code>.</code> or <code>1</code></td>
</tr>
</tbody>
</table>
</div>
<div id="linear-models" class="section level3">
<h3><span class="header-section-number">7.5.2</span> Linear models</h3>
<p>To fit a linear model, you can use the function <code>lm()</code>. This function is part of the <code>stats</code> package, which comes installed with base R. In this function, you can use the <code>data</code> option to specify the data frame from which to get the vectors.</p>
<pre><code>## Warning: Unknown levels in `f`: 1, 2</code></pre>
<div class="sourceCode" id="cb737"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb737-1" title="1">mod_a &lt;-<span class="st"> </span><span class="kw">lm</span>(wt <span class="op">~</span><span class="st"> </span>ht, <span class="dt">data =</span> nepali)</a></code></pre></div>
<p>This previous call fits the model:</p>
<p><span class="math display">\[ Y_{i} = \beta_{0} + \beta_{1}X_{1,i} + \epsilon_{i} \]</span></p>
<p>where:</p>
<ul>
<li><span class="math inline">\(Y_{i}\)</span> : weight of child <span class="math inline">\(i\)</span></li>
<li><span class="math inline">\(X_{1,i}\)</span> : height of child <span class="math inline">\(i\)</span></li>
</ul>
<p>If you run the <code>lm</code> function without saving it as an object, R will fit the regression and print out the function call and the estimated model coefficients:</p>
<div class="sourceCode" id="cb738"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb738-1" title="1"><span class="kw">lm</span>(wt <span class="op">~</span><span class="st"> </span>ht, <span class="dt">data =</span> nepali)</a></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = wt ~ ht, data = nepali)
## 
## Coefficients:
## (Intercept)           ht  
##     -8.7581       0.2342</code></pre>
<p>However, to be able to use the model later for things like predictions and model assessments, you should save the output of the function as an R object:</p>
<div class="sourceCode" id="cb740"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb740-1" title="1">mod_a &lt;-<span class="st"> </span><span class="kw">lm</span>(wt <span class="op">~</span><span class="st"> </span>ht, <span class="dt">data =</span> nepali)</a></code></pre></div>
<p>This object has a special class, <code>lm</code>:</p>
<div class="sourceCode" id="cb741"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb741-1" title="1"><span class="kw">class</span>(mod_a)</a></code></pre></div>
<pre><code>## [1] &quot;lm&quot;</code></pre>
<p>This class is a special type of list object. If you use <code>is.list</code> to check, you can confirm that this object is a list:</p>
<div class="sourceCode" id="cb743"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb743-1" title="1"><span class="kw">is.list</span>(mod_a)</a></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>There are a number of functions that you can apply to an <code>lm</code> object. These include:</p>
<table>
<colgroup>
<col width="21%" />
<col width="78%" />
</colgroup>
<thead>
<tr class="header">
<th align="center">Function</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center"><code>summary</code></td>
<td align="left">Get a variety of information on the model, including
coefficients and p-values for the coefficients</td>
</tr>
<tr class="even">
<td align="center"><code>coefficients</code></td>
<td align="left">Pull out just the coefficients for a model</td>
</tr>
<tr class="odd">
<td align="center"><code>fitted</code></td>
<td align="left">Get the fitted values from the model (for the data used to
fit the model)</td>
</tr>
<tr class="even">
<td align="center"><code>plot</code></td>
<td align="left">Create plots to help assess model assumptions</td>
</tr>
<tr class="odd">
<td align="center"><code>residuals</code></td>
<td align="left">Get the model residuals</td>
</tr>
</tbody>
</table>
<p>For example, you can get the coefficients from the model by running:</p>
<div class="sourceCode" id="cb745"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb745-1" title="1"><span class="kw">coefficients</span>(mod_a)</a></code></pre></div>
<pre><code>## (Intercept)          ht 
##  -8.7581466   0.2341969</code></pre>
<p>The estimated coefficient for the intercept is always given under the name “(Intercept)”. Estimated coefficients for independent variables are given based on their column names in the original data (“ht” here, for <span class="math inline">\(\beta_1\)</span>, or the estimated increase in expected weight for a one unit increase in height).</p>
<p>You can use the output from a <code>coefficients</code> call to plot a regression line based on the model fit on top of points showing the original data (Figure <a href="exploring-data-2.html#fig:modelcoefplot">7.1</a>).</p>
<div class="sourceCode" id="cb747"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb747-1" title="1">mod_coef &lt;-<span class="st"> </span><span class="kw">coefficients</span>(mod_a)</a>
<a class="sourceLine" id="cb747-2" title="2"><span class="kw">ggplot</span>(nepali, <span class="kw">aes</span>(<span class="dt">x =</span> ht, <span class="dt">y =</span> wt)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb747-3" title="3"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="fl">0.2</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb747-4" title="4"><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Height (cm)&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Weight (kg)&quot;</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb747-5" title="5"><span class="st">  </span><span class="kw">geom_abline</span>(<span class="kw">aes</span>(<span class="dt">intercept =</span> mod_coef[<span class="dv">1</span>],</a>
<a class="sourceLine" id="cb747-6" title="6">                  <span class="dt">slope =</span> mod_coef[<span class="dv">2</span>]), <span class="dt">col =</span> <span class="st">&quot;blue&quot;</span>)</a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:modelcoefplot"></span>
<img src="RProgrammingForResearch_files/figure-html/modelcoefplot-1.png" alt="Example of using the output from a coefficients call to add a regression line to a scatterplot." width="480" />
<p class="caption">
Figure 7.1: Example of using the output from a coefficients call to add a regression line to a scatterplot.
</p>
</div>
<div class="rmdnote">
<p>
You can also add a linear regression line to a scatterplot by adding the geom <code>geom_smooth</code> using the argument <code>method = “lm”</code>.
</p>
</div>
<p>You can use the function <code>residuals</code> on an <code>lm</code> object to pull out the residuals from the model fit:</p>
<div class="sourceCode" id="cb748"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb748-1" title="1"><span class="kw">head</span>(<span class="kw">residuals</span>(mod_a))</a></code></pre></div>
<pre><code>##          1          2          3          4          6          7 
##  0.1993922 -0.4329393 -0.4373953 -0.1355300 -0.6749080 -1.0838199</code></pre>
<p>The result of a <code>residuals</code> call is a vector with one element for each of the non-missing observations (rows) in the data frame you used to fit the model. Each value gives the different between the model fitted value and the observed value for each of these observations, in the same order the observations show up in the data frame. The residuals are in the same order as the observations in the original data frame.</p>
<div class="rmdtip">
<p>
You can also use the shorter function <code>coef</code> as an alternative to <code>coefficients</code> and the shorter function <code>resid</code> as an alternative to <code>residuals</code>.
</p>
</div>
<p>As noted in the subsection on simple statistics functions, the <code>summary</code> function returns different output depending on the type of object that is input to the function. If you input a regression model object to <code>summary</code>, the function gives you a lot of information about the model. For example, here is the output returned by running <code>summary</code> for the linear regression model object we just created:</p>
<div class="sourceCode" id="cb750"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb750-1" title="1"><span class="kw">summary</span>(mod_a)</a></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = wt ~ ht, data = nepali)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -3.0077 -0.5479 -0.0293  0.4972  3.3514 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) -8.758147   0.211529  -41.40   &lt;2e-16 ***
## ht           0.234197   0.002459   95.23   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.8733 on 875 degrees of freedom
##   (123 observations deleted due to missingness)
## Multiple R-squared:  0.912,  Adjusted R-squared:  0.9119 
## F-statistic:  9068 on 1 and 875 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>This output includes a lot of useful elements, including (1) basic summary statistics for the residuals (to meet model assumptions, the median should be around zero and the absolute values fairly similar for the first and third quantiles), (2) coefficient estimates, standard errors, and p-values, and (3) some model summary statistics, including residual standard error, degrees of freedom, number of missing observations, and F-statistic.</p>
<p>The object returned by the <code>summary()</code> function when it is applied to an <code>lm</code> object is a list, which you can confirm using the <code>is.list</code> function:</p>
<div class="sourceCode" id="cb752"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb752-1" title="1"><span class="kw">is.list</span>(<span class="kw">summary</span>(mod_a))</a></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>With any list, you can use the <code>names</code> function to get the names of all of the different elements of the object:</p>
<div class="sourceCode" id="cb754"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb754-1" title="1"><span class="kw">names</span>(<span class="kw">summary</span>(mod_a))</a></code></pre></div>
<pre><code>##  [1] &quot;call&quot;          &quot;terms&quot;         &quot;residuals&quot;     &quot;coefficients&quot; 
##  [5] &quot;aliased&quot;       &quot;sigma&quot;         &quot;df&quot;            &quot;r.squared&quot;    
##  [9] &quot;adj.r.squared&quot; &quot;fstatistic&quot;    &quot;cov.unscaled&quot;  &quot;na.action&quot;</code></pre>
<p>You can use the <code>$</code> operator to pull out any element of the list. For example, to pull out the table with information on the estimated model coefficients, you can run:</p>
<div class="sourceCode" id="cb756"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb756-1" title="1"><span class="kw">summary</span>(mod_a)<span class="op">$</span>coefficients</a></code></pre></div>
<pre><code>##               Estimate  Std. Error   t value      Pr(&gt;|t|)
## (Intercept) -8.7581466 0.211529182 -41.40396 2.411051e-208
## ht           0.2341969 0.002459347  95.22726  0.000000e+00</code></pre>
<p>The <code>plot</code> function, like the <code>summary</code> function, will give different output depending on the class of the object that you input. For an <code>lm</code> object, you can use the <code>plot</code> function to get a number of useful diagnostic plots that will help you check regression assumptions (Figure <a href="exploring-data-2.html#fig:plotlmexample">7.2</a>):</p>
<div class="sourceCode" id="cb758"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb758-1" title="1"><span class="kw">plot</span>(mod_a)</a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:plotlmexample"></span>
<img src="RProgrammingForResearch_files/figure-html/plotlmexample-1.png" alt="Example output from running the plot function with an lm object as the input." width="\textwidth" />
<p class="caption">
Figure 7.2: Example output from running the plot function with an lm object as the input.
</p>
</div>
<p>You can also use binary variables or factors as independent variables in regression models. For example, in the <code>nepali</code> dataset, <code>sex</code> is a factor variable with the levels “Male” and “Female”. You can fit a linear model of weight regressed on sex for this data with the call:</p>
<div class="sourceCode" id="cb759"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb759-1" title="1">mod_b &lt;-<span class="st"> </span><span class="kw">lm</span>(wt <span class="op">~</span><span class="st"> </span>sex, <span class="dt">data =</span> nepali)</a></code></pre></div>
<p>This call fits the model:</p>
<p><span class="math display">\[ Y_{i} = \beta_{0} + \beta_{1}X_{1,i} + \epsilon_{i} \]</span></p>
<p>where <span class="math inline">\(X_{1,i}\)</span> : sex of child <span class="math inline">\(i\)</span>, where 0 = male and 1 = female.</p>
<p>Here are the estimated coefficients from fitting this model:</p>
<div class="sourceCode" id="cb760"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb760-1" title="1"><span class="kw">summary</span>(mod_b)<span class="op">$</span>coefficients</a></code></pre></div>
<pre><code>##               Estimate Std. Error   t value   Pr(&gt;|t|)
## (Intercept) 11.4226374  0.1375427 83.047920 0.00000000
## sexFemale   -0.4866184  0.1982810 -2.454185 0.01431429</code></pre>
<p>You’ll notice that, in addition to an estimated intercept (<code>(Intercept)</code>), the other estimated coefficient is <code>sexFemale</code> rather than just <code>sex</code>, although the column name in the data frame input to <code>lm</code> for this variable is <code>sex</code>.</p>
<p>This is because, when a factor or binary variable is input as an independent variable in a linear regression model, R will fit an estimated coefficient for all levels of factors <em>except</em> the first factor level. By default, this first factor level is used as the baseline level, and so its estimated mean is given by the estimated intercept, while the other model coefficients give the estimated <em>difference</em> from this baseline.</p>
<p>For example, the model fit above tells us that the estimated mean weight of males is 11.4, while the estimated mean weight of females is 11.4 + -0.5 = 10.9.</p>
<!-- If you would prefer that a different level of the factor be the baseline (for example, "Female" rather than "Male" for the previous regression), you can do that by using the `levels` argument in the `factor` function to reset factor levels. For example: -->
<!-- ```{r} -->
<!-- nepali_reset <- nepali %>% -->
<!--   mutate(sex = factor(sex, levels = c("2", "1"))) -->
<!-- mod_b_reset <- lm(wt ~ sex, data = nepali_reset) -->
<!-- summary(mod_b_reset)$coef -->
<!-- ``` -->
<!-- Now, `(Intercept)` gives the estimated mean weight for females, while the second estimated coefficient gives the estimated mean difference for males compared to the expected value for females. -->
<hr />
</div>
</div>
<div id="handling-model-objects" class="section level2">
<h2><span class="header-section-number">7.6</span> Handling model objects</h2>
<p>The <code>broom</code> package contains tools for converting statistical objects into nice tidy data frames. The tools in the <code>broom</code> package make it easy to process statistical results in R using the tools of the <code>tidyverse</code>.</p>
<div id="broomtidy" class="section level3">
<h3><span class="header-section-number">7.6.1</span> broom::tidy</h3>
<p>The <code>tidy()</code> function returns a data frame with information on the fitted model terms. For example, when applied to one of our linear models we get:</p>
<div class="sourceCode" id="cb762"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb762-1" title="1">  <span class="kw">library</span>(broom)</a>
<a class="sourceLine" id="cb762-2" title="2">  <span class="kw">kable</span>(<span class="kw">tidy</span>(mod_a), <span class="dt">digits =</span> <span class="dv">3</span>)</a></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">term</th>
<th align="right">estimate</th>
<th align="right">std.error</th>
<th align="right">statistic</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">-8.758</td>
<td align="right">0.212</td>
<td align="right">-41.404</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">ht</td>
<td align="right">0.234</td>
<td align="right">0.002</td>
<td align="right">95.227</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb763"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb763-1" title="1">  <span class="kw">class</span>(<span class="kw">tidy</span>(mod_a))</a></code></pre></div>
<pre><code>## [1] &quot;tbl_df&quot;     &quot;tbl&quot;        &quot;data.frame&quot;</code></pre>
<p>You can pass arguments to the <code>tidy()</code> function. For example, include confidence intervals:</p>
<div class="sourceCode" id="cb765"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb765-1" title="1">  <span class="kw">kable</span>(<span class="kw">tidy</span>(mod_a, <span class="dt">conf.int =</span> <span class="ot">TRUE</span>), <span class="dt">digits =</span> <span class="dv">3</span>)</a></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">term</th>
<th align="right">estimate</th>
<th align="right">std.error</th>
<th align="right">statistic</th>
<th align="right">p.value</th>
<th align="right">conf.low</th>
<th align="right">conf.high</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">-8.758</td>
<td align="right">0.212</td>
<td align="right">-41.404</td>
<td align="right">0</td>
<td align="right">-9.173</td>
<td align="right">-8.343</td>
</tr>
<tr class="even">
<td align="left">ht</td>
<td align="right">0.234</td>
<td align="right">0.002</td>
<td align="right">95.227</td>
<td align="right">0</td>
<td align="right">0.229</td>
<td align="right">0.239</td>
</tr>
</tbody>
</table>
<hr />
</div>
<div id="broomaugment" class="section level3">
<h3><span class="header-section-number">7.6.2</span> broom::augment</h3>
<p>The <code>augment()</code> function adds information about a fitted model to the dataset used to fit the model. For example, when applied to one of our linear models we get information on the fitted values and residuals included in the output:</p>
<div class="sourceCode" id="cb766"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb766-1" title="1">  <span class="kw">kable</span>(<span class="kw">head</span>(broom<span class="op">::</span><span class="kw">augment</span>(mod_a), <span class="dv">3</span>), <span class="dt">digits =</span> <span class="dv">3</span>)</a></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">.rownames</th>
<th align="right">wt</th>
<th align="right">ht</th>
<th align="right">.fitted</th>
<th align="right">.se.fit</th>
<th align="right">.resid</th>
<th align="right">.hat</th>
<th align="right">.sigma</th>
<th align="right">.cooksd</th>
<th align="right">.std.resid</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">1</td>
<td align="right">12.8</td>
<td align="right">91.2</td>
<td align="right">12.601</td>
<td align="right">0.033</td>
<td align="right">0.199</td>
<td align="right">0.001</td>
<td align="right">0.874</td>
<td align="right">0</td>
<td align="right">0.228</td>
</tr>
<tr class="even">
<td align="left">2</td>
<td align="right">12.8</td>
<td align="right">93.9</td>
<td align="right">13.233</td>
<td align="right">0.036</td>
<td align="right">-0.433</td>
<td align="right">0.002</td>
<td align="right">0.874</td>
<td align="right">0</td>
<td align="right">-0.496</td>
</tr>
<tr class="odd">
<td align="left">3</td>
<td align="right">13.1</td>
<td align="right">95.2</td>
<td align="right">13.537</td>
<td align="right">0.038</td>
<td align="right">-0.437</td>
<td align="right">0.002</td>
<td align="right">0.874</td>
<td align="right">0</td>
<td align="right">-0.501</td>
</tr>
</tbody>
</table>
<hr />
</div>
<div id="broomglance" class="section level3">
<h3><span class="header-section-number">7.6.3</span> broom::glance</h3>
<p>The <code>glance()</code> functions returns a one row summary of a fitted model object: For example:</p>
<div class="sourceCode" id="cb767"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb767-1" title="1">  <span class="kw">kable</span>(<span class="kw">glance</span>(mod_a, <span class="dt">conf.int =</span> <span class="ot">TRUE</span>), <span class="dt">digits =</span> <span class="dv">3</span>)</a></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">r.squared</th>
<th align="right">adj.r.squared</th>
<th align="right">sigma</th>
<th align="right">statistic</th>
<th align="right">p.value</th>
<th align="right">df</th>
<th align="right">logLik</th>
<th align="right">AIC</th>
<th align="right">BIC</th>
<th align="right">deviance</th>
<th align="right">df.residual</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0.912</td>
<td align="right">0.912</td>
<td align="right">0.873</td>
<td align="right">9068.23</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">-1124.615</td>
<td align="right">2255.23</td>
<td align="right">2269.56</td>
<td align="right">667.351</td>
<td align="right">875</td>
</tr>
</tbody>
</table>
<hr />
</div>
<div id="references-statistics-in-r" class="section level3">
<h3><span class="header-section-number">7.6.4</span> References– statistics in R</h3>
<p>One great (and free online for CSU students through our library) book to find out more about using R for basic statistics is:</p>
<ul>
<li><a href="http://discovery.library.colostate.edu/Record/.b44705323">Introductory Statistics with R</a></li>
</ul>
<p>If you want all the details about fitting linear models and GLMs in R, Julian Faraway’s books are fantastic. He has one on linear models and one on extensions including logistic and Poisson models:</p>
<ul>
<li><a href="http://discovery.library.colostate.edu/Record/.b41119691">Linear Models with R</a> (also free online through the CSU library)</li>
<li><a href="http://www.amazon.com/Extending-Linear-Model-Generalized-Nonparametric/dp/158488424X/ref=sr_1_1?ie=UTF8&amp;qid=1442252668&amp;sr=8-1&amp;keywords=extending+linear+model+r">Extending the Linear Model with R</a></li>
</ul>
<hr />
</div>
</div>
<div id="functions" class="section level2">
<h2><span class="header-section-number">7.7</span> Functions</h2>
<p>As you move to larger projects, you will find yourself using the same code a lot. </p>
<p>Examples include:</p>
<ul>
<li>Reading in data from a specific type of equipment (air pollution monitor, accelerometer)</li>
<li>Running a specific type of analysis</li>
<li>Creating a specific type of plot or map</li>
</ul>

<p>If you find yourself cutting and pasting a lot, convert the code to a function.</p>
<p>Advantages of writing functions include:</p>
<ul>
<li>Coding is more efficient</li>
<li>Easier to change your code (if you’ve cut and paste code and you want to change something, you have to change it everywhere - this is an easy way to accidentally create bugs in your code)</li>
<li>Easier to share code with others</li>
</ul>
<p>You can name a function anything you want (although try to avoid names of preexisting-existing functions). You then define any inputs (arguments; separate multiple arguments with commas) and put the code to run in braces:</p>
<div class="sourceCode" id="cb768"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb768-1" title="1"><span class="co">## Note: this code will not run</span></a>
<a class="sourceLine" id="cb768-2" title="2">[<span class="cf">function</span> name] &lt;-<span class="st"> </span><span class="cf">function</span>([any arguments]){</a>
<a class="sourceLine" id="cb768-3" title="3">        [code to run]</a>
<a class="sourceLine" id="cb768-4" title="4">}</a></code></pre></div>
<p>Here is an example of a very basic function. This function takes a number as input and adds 1 to that number.</p>
<div class="sourceCode" id="cb769"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb769-1" title="1">add_one &lt;-<span class="st"> </span><span class="cf">function</span>(number){</a>
<a class="sourceLine" id="cb769-2" title="2">  out &lt;-<span class="st"> </span>number <span class="op">+</span><span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb769-3" title="3">  <span class="kw">return</span>(out)</a>
<a class="sourceLine" id="cb769-4" title="4">}</a>
<a class="sourceLine" id="cb769-5" title="5"></a>
<a class="sourceLine" id="cb769-6" title="6"><span class="kw">add_one</span>(<span class="dt">number =</span> <span class="dv">3</span>)</a></code></pre></div>
<pre><code>## [1] 4</code></pre>
<div class="sourceCode" id="cb771"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb771-1" title="1"><span class="kw">add_one</span>(<span class="dt">number =</span> <span class="dv">-1</span>)</a></code></pre></div>
<pre><code>## [1] 0</code></pre>
<ul>
<li>Functions can input any type of R object (for example, vectors, data frames, even other functions and ggplot objects)</li>
<li>Similarly, functions can output any type of R object</li>
<li>When defining a function, you can set default values for some of the parameters</li>
<li>You can explicitly specify the value to return from the function</li>
</ul>
<p>For example, the following function inputs a data frame (<code>datafr</code>) and a one-element vector (<code>child_id</code>) and returns only rows in the data frame where it’s <code>id</code> column matches <code>child_id</code>. It includes a default value for <code>datafr</code>, but not for <code>child_id</code>.</p>
<div class="sourceCode" id="cb773"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb773-1" title="1">subset_nepali &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">datafr =</span> nepali, child_id){</a>
<a class="sourceLine" id="cb773-2" title="2">  datafr &lt;-<span class="st"> </span>datafr <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb773-3" title="3"><span class="st">            </span><span class="kw">filter</span>(id <span class="op">==</span><span class="st"> </span>child_id)</a>
<a class="sourceLine" id="cb773-4" title="4">  <span class="kw">return</span>(datafr)</a>
<a class="sourceLine" id="cb773-5" title="5">}</a></code></pre></div>
<p>If an argument is not given for a parameter with a default, the function will run using the default value for that parameter. For example:</p>
<div class="sourceCode" id="cb774"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb774-1" title="1"><span class="kw">subset_nepali</span>(<span class="dt">child_id =</span> <span class="st">&quot;120011&quot;</span>)</a></code></pre></div>
<pre><code>##       id  sex   wt   ht mage lit died alive age
## 1 120011 Male 12.8 91.2   35   0    2     5  41
## 2 120011 Male 12.8 93.9   35   0    2     5  45
## 3 120011 Male 13.1 95.2   35   0    2     5  49
## 4 120011 Male 13.8 96.9   35   0    2     5  53
## 5 120011 Male   NA   NA   35   0    2     5  57</code></pre>
<p>If an argument is not given for a parameter without a default, the function call will result in an error. For example:</p>
<div class="sourceCode" id="cb776"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb776-1" title="1"><span class="kw">subset_nepali</span>(<span class="dt">datafr =</span> nepali)</a></code></pre></div>
<pre><code>## Error: argument &quot;child_id&quot; is missing, with no default</code></pre>
<p>By default, the function will return the last defined object, although the choice of using <code>return</code> can affect printing behavior when you run the function. For example, I could have written the <code>subset_nepali</code> function like this:</p>
<div class="sourceCode" id="cb778"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb778-1" title="1">subset_nepali &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">datafr =</span> nepali, child_id){</a>
<a class="sourceLine" id="cb778-2" title="2">  datafr &lt;-<span class="st"> </span>datafr <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb778-3" title="3"><span class="st">            </span><span class="kw">filter</span>(id <span class="op">==</span><span class="st"> </span>child_id)</a>
<a class="sourceLine" id="cb778-4" title="4">}</a></code></pre></div>
<p>In this case, the output will not automatically print out when you call the function without assigning it to an R object:</p>
<div class="sourceCode" id="cb779"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb779-1" title="1"><span class="kw">subset_nepali</span>(<span class="dt">child_id =</span> <span class="st">&quot;120011&quot;</span>)</a></code></pre></div>
<p>However, the output can be assigned to an R object in the same way as when the function was defined without <code>return</code>:</p>
<div class="sourceCode" id="cb780"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb780-1" title="1">first_childs_data &lt;-<span class="st"> </span><span class="kw">subset_nepali</span>(<span class="dt">child_id =</span> <span class="st">&quot;120011&quot;</span>)</a>
<a class="sourceLine" id="cb780-2" title="2">first_childs_data</a></code></pre></div>
<pre><code>##       id  sex   wt   ht mage lit died alive age
## 1 120011 Male 12.8 91.2   35   0    2     5  41
## 2 120011 Male 12.8 93.9   35   0    2     5  45
## 3 120011 Male 13.1 95.2   35   0    2     5  49
## 4 120011 Male 13.8 96.9   35   0    2     5  53
## 5 120011 Male   NA   NA   35   0    2     5  57</code></pre>
<div class="rmdwarning">
<p>
R is very “good” at running functions! It will look for (scope) the variables in your function in various places (environments). So your functions may run even when you don’t expect them to, potentially, with unexpected results!
</p>
</div>
<p>The <code>return</code> function can also be used to return an object other than the last defined object (although this doesn’t tend to be something you need to do very often). If you did not use <code>return</code> in the following code, it will output “Test output”:</p>
<div class="sourceCode" id="cb782"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb782-1" title="1">subset_nepali &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">datafr =</span> nepali, child_id){</a>
<a class="sourceLine" id="cb782-2" title="2">  datafr &lt;-<span class="st"> </span>datafr <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb782-3" title="3"><span class="st">            </span><span class="kw">filter</span>(id <span class="op">==</span><span class="st"> </span>child_id)</a>
<a class="sourceLine" id="cb782-4" title="4">  a &lt;-<span class="st"> &quot;Test output&quot;</span></a>
<a class="sourceLine" id="cb782-5" title="5">}</a>
<a class="sourceLine" id="cb782-6" title="6">(<span class="kw">subset_nepali</span>(<span class="dt">child_id =</span> <span class="st">&quot;120011&quot;</span>))</a></code></pre></div>
<pre><code>## [1] &quot;Test output&quot;</code></pre>
<p>Conversely, you can use <code>return</code> to output <code>datafr</code>, even though it’s not the last object defined:</p>
<div class="sourceCode" id="cb784"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb784-1" title="1">subset_nepali &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">datafr =</span> nepali, child_id){</a>
<a class="sourceLine" id="cb784-2" title="2">  datafr &lt;-<span class="st"> </span>datafr <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb784-3" title="3"><span class="st">            </span><span class="kw">filter</span>(id <span class="op">==</span><span class="st"> </span>child_id)</a>
<a class="sourceLine" id="cb784-4" title="4">  a &lt;-<span class="st"> &quot;Test output&quot;</span></a>
<a class="sourceLine" id="cb784-5" title="5">  <span class="kw">return</span>(datafr)</a>
<a class="sourceLine" id="cb784-6" title="6">}</a>
<a class="sourceLine" id="cb784-7" title="7"><span class="kw">subset_nepali</span>(<span class="dt">child_id =</span> <span class="st">&quot;120011&quot;</span>)</a></code></pre></div>
<pre><code>##       id  sex   wt   ht mage lit died alive age
## 1 120011 Male 12.8 91.2   35   0    2     5  41
## 2 120011 Male 12.8 93.9   35   0    2     5  45
## 3 120011 Male 13.1 95.2   35   0    2     5  49
## 4 120011 Male 13.8 96.9   35   0    2     5  53
## 5 120011 Male   NA   NA   35   0    2     5  57</code></pre>
<hr />
<div id="if-else-statements" class="section level3">
<h3><span class="header-section-number">7.7.1</span> if / else statements</h3>
<p>There are other control structures you can use in your R code. Two that you will commonly use within R functions are <code>if</code> and <code>ifelse</code> statements. </p>
<p>An <code>if</code> statement tells R that, <strong>if</strong> a certain condition is true, <strong>do</strong> run some code. For example, if you wanted to print out only odd numbers between 1 and 5, one way to do that is with an <code>if</code> statement: (Note: the <code>%%</code> operator in R returns the remainder of the first value (i) divided by the second value (2).)</p>
<div class="sourceCode" id="cb786"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb786-1" title="1"><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>){</a>
<a class="sourceLine" id="cb786-2" title="2">  <span class="cf">if</span>(i <span class="op">%%</span><span class="st"> </span><span class="dv">2</span> <span class="op">==</span><span class="st"> </span><span class="dv">1</span>){</a>
<a class="sourceLine" id="cb786-3" title="3">    <span class="kw">print</span>(i)</a>
<a class="sourceLine" id="cb786-4" title="4">  }</a>
<a class="sourceLine" id="cb786-5" title="5">}</a></code></pre></div>
<pre><code>## [1] 1
## [1] 3
## [1] 5</code></pre>
<p>The <code>if</code> statement runs some code if a condition is true, but does nothing if it is false. If you’d like different code to run depending on whether the condition is true or false, you can us an if / else or an if / else if / else statement.</p>
<div class="sourceCode" id="cb788"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb788-1" title="1"><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>){</a>
<a class="sourceLine" id="cb788-2" title="2">  <span class="cf">if</span>(i <span class="op">%%</span><span class="st"> </span><span class="dv">2</span> <span class="op">==</span><span class="st"> </span><span class="dv">1</span>){</a>
<a class="sourceLine" id="cb788-3" title="3">    <span class="kw">print</span>(i)</a>
<a class="sourceLine" id="cb788-4" title="4">  } <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb788-5" title="5">    <span class="kw">print</span>(<span class="kw">paste</span>(i, <span class="st">&quot;is even&quot;</span>))</a>
<a class="sourceLine" id="cb788-6" title="6">  }</a>
<a class="sourceLine" id="cb788-7" title="7">}</a></code></pre></div>
<pre><code>## [1] 1
## [1] &quot;2 is even&quot;
## [1] 3
## [1] &quot;4 is even&quot;
## [1] 5</code></pre>
<p>What would this code do? </p>
<div class="sourceCode" id="cb790"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb790-1" title="1"><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">100</span>){</a>
<a class="sourceLine" id="cb790-2" title="2">  <span class="cf">if</span>(i <span class="op">%%</span><span class="st"> </span><span class="dv">3</span> <span class="op">==</span><span class="st"> </span><span class="dv">0</span> <span class="op">&amp;</span><span class="st"> </span>i <span class="op">%%</span><span class="st"> </span><span class="dv">5</span> <span class="op">==</span><span class="st"> </span><span class="dv">0</span>){</a>
<a class="sourceLine" id="cb790-3" title="3">    <span class="kw">print</span>(<span class="st">&quot;FizzBuzz&quot;</span>)</a>
<a class="sourceLine" id="cb790-4" title="4">  } <span class="cf">else</span> <span class="cf">if</span>(i <span class="op">%%</span><span class="st"> </span><span class="dv">3</span> <span class="op">==</span><span class="st"> </span><span class="dv">0</span>){</a>
<a class="sourceLine" id="cb790-5" title="5">    <span class="kw">print</span>(<span class="st">&quot;Fizz&quot;</span>)</a>
<a class="sourceLine" id="cb790-6" title="6">  } <span class="cf">else</span> <span class="cf">if</span>(i <span class="op">%%</span><span class="st"> </span><span class="dv">5</span> <span class="op">==</span><span class="st"> </span><span class="dv">0</span>){</a>
<a class="sourceLine" id="cb790-7" title="7">    <span class="kw">print</span>(<span class="st">&quot;Buzz&quot;</span>)</a>
<a class="sourceLine" id="cb790-8" title="8">  } <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb790-9" title="9">    <span class="kw">print</span>(i)</a>
<a class="sourceLine" id="cb790-10" title="10">  }</a>
<a class="sourceLine" id="cb790-11" title="11">}</a></code></pre></div>
<p>If / else statements are extremely useful in functions. </p>
<p>In R, the <code>if</code> statement evaluates everything in the parentheses and, if that evaluates to <code>TRUE</code>, runs everything in the braces. This means that you can trigger code in an <code>if</code> statement with a single-value logical vector:</p>
<div class="sourceCode" id="cb791"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb791-1" title="1">weekend &lt;-<span class="st"> </span><span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb791-2" title="2"><span class="cf">if</span>(weekend){</a>
<a class="sourceLine" id="cb791-3" title="3">  <span class="kw">print</span>(<span class="st">&quot;It&#39;s the weekend!&quot;</span>)</a>
<a class="sourceLine" id="cb791-4" title="4">}</a></code></pre></div>
<pre><code>## [1] &quot;It&#39;s the weekend!&quot;</code></pre>
<p>This functionality can be useful with parameters you choose to include when writing your own functions (e.g., <code>print = TRUE</code>).</p>
</div>
<div id="some-other-control-structures" class="section level3">
<h3><span class="header-section-number">7.7.2</span> Some other control structures</h3>
<p>The control structure you are most likely to use in data analysis with R is the “if / else” statement. However, there are a few other control structures you may occasionally find useful:</p>
<ul>
<li><code>next</code></li>
<li><code>break</code></li>
<li><code>while</code></li>
</ul>
<p>You can use the <code>next</code> structure to skip to the next round of a loop when a certain condition is met. For example, we could have used this code to print out odd numbers between 1 and 5:</p>
<div class="sourceCode" id="cb793"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb793-1" title="1">i &lt;-<span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb793-2" title="2"><span class="cf">while</span>(i <span class="op">&lt;</span><span class="st"> </span><span class="dv">5</span>){</a>
<a class="sourceLine" id="cb793-3" title="3">  i &lt;-<span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>i</a>
<a class="sourceLine" id="cb793-4" title="4">  <span class="cf">if</span>(i <span class="op">%%</span><span class="st"> </span><span class="dv">2</span> <span class="op">==</span><span class="st"> </span><span class="dv">0</span>){</a>
<a class="sourceLine" id="cb793-5" title="5">    <span class="cf">next</span></a>
<a class="sourceLine" id="cb793-6" title="6">  }</a>
<a class="sourceLine" id="cb793-7" title="7">  <span class="kw">print</span>(i)</a>
<a class="sourceLine" id="cb793-8" title="8">}</a></code></pre></div>
<pre><code>## [1] 1
## [1] 3
## [1] 5</code></pre>
<p>You can use <code>break</code> to break out of a loop if a certain condition is met. For example, the final code will break out of the loop once <code>i</code> is over 2, so it will only print the numbers 1 through 3:</p>
<div class="sourceCode" id="cb795"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb795-1" title="1">i &lt;-<span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb795-2" title="2"><span class="cf">while</span>(i <span class="op">&lt;=</span><span class="st"> </span><span class="dv">5</span>){</a>
<a class="sourceLine" id="cb795-3" title="3">  <span class="cf">if</span>(i <span class="op">&gt;</span><span class="st"> </span><span class="dv">2</span>){</a>
<a class="sourceLine" id="cb795-4" title="4">    <span class="cf">break</span></a>
<a class="sourceLine" id="cb795-5" title="5">  }</a>
<a class="sourceLine" id="cb795-6" title="6">  i &lt;-<span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>i</a>
<a class="sourceLine" id="cb795-7" title="7">  <span class="kw">print</span>(i)</a>
<a class="sourceLine" id="cb795-8" title="8">}</a></code></pre></div>
<pre><code>## [1] 1
## [1] 2
## [1] 3</code></pre>
</div>
</div>
<div id="in-course-exercise-6" class="section level2">
<h2><span class="header-section-number">7.8</span> In-course exercise</h2>
<div id="exploring-taxonomic-profiling-data" class="section level3">
<h3><span class="header-section-number">7.8.1</span> Exploring taxonomic profiling data</h3>
<ul>
<li>We’ll be using a package on Bioconductor called <code>microbiome</code>. You’ll need to install that package from Bioconductor. This uses code that’s different from the default you use to download a package from CRAN. Go to <a href="https://bioconductor.org/packages/release/bioc/html/microbiome.html">the Bioconductor page for the microbiome package</a> and figure out how to install this package based on instructions on that page.</li>
<li>The <code>microbiome</code> that includes tools for exploring and analysing microbiome profiling data. This package has a website with tutorial information <a href="https://bioconductor.org/packages/devel/bioc/vignettes/microbiome/inst/doc/vignette.html#installation">here</a>. We want to explore a dataset on genus-level microbiota profiling (<code>atlas1006</code>). Navigate to the tutorial webpage to figure out how you can get this example raw data loaded in your R session. Use the <code>class</code> and <code>str</code> functions to start exploring this data. Is it in a dataframe (tibble)? Is it in a tidy format? How is the data structured?</li>
<li>On the <a href="https://bioconductor.org/packages/devel/bioc/vignettes/microbiome/inst/doc/vignette.html">microbiome page</a>, find the documentation describing the <code>atlas1006</code> data. Look through this documentation to figure out what information is included in the data. Also, check the helpfile for this dataset and look up the original article describing the data (you can find the article information in the help resources).</li>
<li>The <code>atlas1006</code> data is stored in a special object class called a “phyloseq” object (you should have seen this when you used <code>class</code> with the object). You can pull certain parts of this data using special functions called “accessors”. One is <code>get_variable</code>. Try running <code>get_variable</code> with the <code>atlas1006</code> data. What do you think this data is showing?</li>
<li>Which different nationalities are represented by the study subjects, based on the dataframe you extracted in the last step? How many samples have each nationality? Which different BMI groups are included? Does it look like the study was balanced among these groups?</li>
<li>Based on the data you extracted, does it look like diversity varies much between males and females? Across BMI groups?</li>
<li>Discuss what steps you would need to take to create the following plot. To start, don’t write any code, just develop a plan. Talk about what the dataset should look like right before you create the plot and what functions you could use to get the data from its current format to that format.</li>
<li>Try to write the code to create this plot. This will include some code for cleaning the data and some code for plotting. I will add one example answer after class, but I’d like you to try to figure it out yourselves first.</li>
</ul>
<p><img src="RProgrammingForResearch_files/figure-html/unnamed-chunk-452-1.png" width="768" /></p>
<div id="example-r-code-13" class="section level4">
<h4><span class="header-section-number">7.8.1.1</span> Example R code</h4>
<p>Install the <code>microbiome</code> package from Bioconductor:</p>
<div class="sourceCode" id="cb797"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb797-1" title="1"><span class="cf">if</span> (<span class="op">!</span><span class="kw">requireNamespace</span>(<span class="st">&quot;BiocManager&quot;</span>, <span class="dt">quietly =</span> <span class="ot">TRUE</span>))</a>
<a class="sourceLine" id="cb797-2" title="2">    <span class="kw">install.packages</span>(<span class="st">&quot;BiocManager&quot;</span>)</a>
<a class="sourceLine" id="cb797-3" title="3"></a>
<a class="sourceLine" id="cb797-4" title="4">BiocManager<span class="op">::</span><span class="kw">install</span>(<span class="st">&quot;microbiome&quot;</span>)</a></code></pre></div>
<p>Load the <code>atlas1006</code> example data in the <code>microbiome</code> package and explore it with <code>str</code> and <code>class</code>:</p>
<div class="sourceCode" id="cb798"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb798-1" title="1"><span class="kw">library</span>(microbiome)</a>
<a class="sourceLine" id="cb798-2" title="2"><span class="kw">data</span>(atlas1006)</a>
<a class="sourceLine" id="cb798-3" title="3"></a>
<a class="sourceLine" id="cb798-4" title="4"><span class="kw">class</span>(atlas1006)</a></code></pre></div>
<pre><code>## [1] &quot;phyloseq&quot;
## attr(,&quot;package&quot;)
## [1] &quot;phyloseq&quot;</code></pre>
<div class="sourceCode" id="cb800"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb800-1" title="1"><span class="kw">str</span>(atlas1006)</a></code></pre></div>
<pre><code>## Formal class &#39;phyloseq&#39; [package &quot;phyloseq&quot;] with 5 slots
##   ..@ otu_table:Formal class &#39;otu_table&#39; [package &quot;phyloseq&quot;] with 2 slots
##   .. .. ..@ .Data        : num [1:130, 1:1151] 0 0 0 21 1 72 0 0 176 10 ...
##   .. .. .. ..- attr(*, &quot;dimnames&quot;)=List of 2
##   .. .. .. .. ..$ : chr [1:130] &quot;Actinomycetaceae&quot; &quot;Aerococcus&quot; &quot;Aeromonas&quot; &quot;Akkermansia&quot; ...
##   .. .. .. .. ..$ : chr [1:1151] &quot;Sample-1&quot; &quot;Sample-2&quot; &quot;Sample-3&quot; &quot;Sample-4&quot; ...
##   .. .. ..@ taxa_are_rows: logi TRUE
##   ..@ tax_table:Formal class &#39;taxonomyTable&#39; [package &quot;phyloseq&quot;] with 1 slot
##   .. .. ..@ .Data: chr [1:130, 1:3] &quot;Actinobacteria&quot; &quot;Firmicutes&quot; &quot;Proteobacteria&quot; &quot;Verrucomicrobia&quot; ...
##   .. .. .. ..- attr(*, &quot;dimnames&quot;)=List of 2
##   .. .. .. .. ..$ : chr [1:130] &quot;Actinomycetaceae&quot; &quot;Aerococcus&quot; &quot;Aeromonas&quot; &quot;Akkermansia&quot; ...
##   .. .. .. .. ..$ : chr [1:3] &quot;Phylum&quot; &quot;Family&quot; &quot;Genus&quot;
##   ..@ sam_data :&#39;data.frame&#39;:    1151 obs. of  10 variables:
## Formal class &#39;sample_data&#39; [package &quot;phyloseq&quot;] with 4 slots
##   .. .. ..@ .Data    :List of 10
##   .. .. .. ..$ : int [1:1151] 28 24 52 22 25 42 25 27 21 25 ...
##   .. .. .. ..$ : Factor w/ 2 levels &quot;female&quot;,&quot;male&quot;: 2 1 2 1 1 2 1 1 1 1 ...
##   .. .. .. ..$ : Factor w/ 6 levels &quot;CentralEurope&quot;,..: 6 6 6 6 6 6 6 6 6 6 ...
##   .. .. .. ..$ : Factor w/ 3 levels &quot;o&quot;,&quot;p&quot;,&quot;r&quot;: NA NA NA NA NA NA NA NA NA NA ...
##   .. .. .. ..$ : Factor w/ 40 levels &quot;1&quot;,&quot;2&quot;,&quot;3&quot;,&quot;4&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...
##   .. .. .. ..$ : num [1:1151] 5.76 6.06 5.5 5.87 5.89 5.53 5.49 5.38 5.34 5.64 ...
##   .. .. .. ..$ : Factor w/ 6 levels &quot;underweight&quot;,..: 5 4 2 1 2 2 1 2 2 2 ...
##   .. .. .. ..$ : Factor w/ 1006 levels &quot;1&quot;,&quot;2&quot;,&quot;3&quot;,&quot;4&quot;,..: 1 2 3 4 5 6 7 8 9 10 ...
##   .. .. .. ..$ : num [1:1151] 0 0 0 0 0 0 0 0 0 0 ...
##   .. .. .. ..$ : chr [1:1151] &quot;Sample-1&quot; &quot;Sample-2&quot; &quot;Sample-3&quot; &quot;Sample-4&quot; ...
##   .. .. ..@ names    : chr [1:10] &quot;age&quot; &quot;sex&quot; &quot;nationality&quot; &quot;DNA_extraction_method&quot; ...
##   .. .. ..@ row.names: chr [1:1151] &quot;Sample-1&quot; &quot;Sample-2&quot; &quot;Sample-3&quot; &quot;Sample-4&quot; ...
##   .. .. ..@ .S3Class : chr &quot;data.frame&quot;
##   ..@ phy_tree : NULL
##   ..@ refseq   : NULL</code></pre>
<p>Pull out the data frame that contains information on each study subject in the <code>atlas1006</code> data by using the <code>get_variable</code> accessor function:</p>
<div class="sourceCode" id="cb802"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb802-1" title="1"><span class="kw">get_variable</span>(atlas1006) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>()</a></code></pre></div>
<pre><code>##          age    sex nationality DNA_extraction_method project diversity
## Sample-1  28   male          US                  &lt;NA&gt;       1      5.76
## Sample-2  24 female          US                  &lt;NA&gt;       1      6.06
## Sample-3  52   male          US                  &lt;NA&gt;       1      5.50
## Sample-4  22 female          US                  &lt;NA&gt;       1      5.87
## Sample-5  25 female          US                  &lt;NA&gt;       1      5.89
## Sample-6  42   male          US                  &lt;NA&gt;       1      5.53
##            bmi_group subject time   sample
## Sample-1 severeobese       1    0 Sample-1
## Sample-2       obese       2    0 Sample-2
## Sample-3        lean       3    0 Sample-3
## Sample-4 underweight       4    0 Sample-4
## Sample-5        lean       5    0 Sample-5
## Sample-6        lean       6    0 Sample-6</code></pre>
<p><strong>Note:</strong> Since the first argument to <code>get_variable</code> is the phyloseq object (here, the <code>atlas1006</code> data object), you can pipe into the function, like this:</p>
<div class="sourceCode" id="cb804"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb804-1" title="1">atlas1006 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb804-2" title="2"><span class="st">  </span><span class="kw">get_variable</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb804-3" title="3"><span class="st">  </span><span class="kw">head</span>()</a></code></pre></div>
<p>Find out the different nationalities included in the data:</p>
<div class="sourceCode" id="cb805"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb805-1" title="1">atlas1006 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb805-2" title="2"><span class="st">  </span><span class="kw">get_variable</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb805-3" title="3"><span class="st">  </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># Change output from a data.frame to a tibble</span></a>
<a class="sourceLine" id="cb805-4" title="4"><span class="st">  </span><span class="kw">group_by</span>(nationality) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb805-5" title="5"><span class="st">  </span><span class="kw">count</span>()</a></code></pre></div>
<pre><code>## Warning: Factor `nationality` contains implicit NA, consider using
## `forcats::fct_explicit_na`

## Warning: Factor `nationality` contains implicit NA, consider using
## `forcats::fct_explicit_na`

## Warning: Factor `nationality` contains implicit NA, consider using
## `forcats::fct_explicit_na`</code></pre>
<pre><code>## # A tibble: 7 x 2
## # Groups:   nationality [7]
##   nationality       n
##   &lt;fct&gt;         &lt;int&gt;
## 1 CentralEurope   650
## 2 EasternEurope    15
## 3 Scandinavia     271
## 4 SouthEurope      89
## 5 UKIE             50
## 6 US               44
## 7 &lt;NA&gt;             32</code></pre>
<p>It looks like most subjects were from Central Europe, with the next-largest group from
Scandinavia. <strong>Note:</strong> If you wanted to rearrange this summary to give the nationalities
in order of the number of subjects in each, you could add on a <code>forcats</code> function:</p>
<div class="sourceCode" id="cb808"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb808-1" title="1">atlas1006 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb808-2" title="2"><span class="st">  </span><span class="kw">get_variable</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb808-3" title="3"><span class="st">  </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># Change output from a data.frame to a tibble</span></a>
<a class="sourceLine" id="cb808-4" title="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">nationality =</span> <span class="kw">fct_infreq</span>(nationality)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb808-5" title="5"><span class="st">  </span><span class="kw">group_by</span>(nationality) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb808-6" title="6"><span class="st">  </span><span class="kw">count</span>() </a></code></pre></div>
<pre><code>## Warning: Factor `nationality` contains implicit NA, consider using
## `forcats::fct_explicit_na`

## Warning: Factor `nationality` contains implicit NA, consider using
## `forcats::fct_explicit_na`

## Warning: Factor `nationality` contains implicit NA, consider using
## `forcats::fct_explicit_na`</code></pre>
<pre><code>## # A tibble: 7 x 2
## # Groups:   nationality [7]
##   nationality       n
##   &lt;fct&gt;         &lt;int&gt;
## 1 CentralEurope   650
## 2 Scandinavia     271
## 3 SouthEurope      89
## 4 UKIE             50
## 5 US               44
## 6 EasternEurope    15
## 7 &lt;NA&gt;             32</code></pre>
<p>Find out the different BMI groups included in the data and if the study seemed to be balanced across those groups:</p>
<div class="sourceCode" id="cb811"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb811-1" title="1">atlas1006 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb811-2" title="2"><span class="st">  </span><span class="kw">get_variable</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb811-3" title="3"><span class="st">  </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># Change output from a data.frame to a tibble</span></a>
<a class="sourceLine" id="cb811-4" title="4"><span class="st">  </span><span class="kw">group_by</span>(bmi_group) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb811-5" title="5"><span class="st">  </span><span class="kw">count</span>()</a></code></pre></div>
<pre><code>## Warning: Factor `bmi_group` contains implicit NA, consider using
## `forcats::fct_explicit_na`

## Warning: Factor `bmi_group` contains implicit NA, consider using
## `forcats::fct_explicit_na`

## Warning: Factor `bmi_group` contains implicit NA, consider using
## `forcats::fct_explicit_na`</code></pre>
<pre><code>## # A tibble: 7 x 2
## # Groups:   bmi_group [7]
##   bmi_group       n
##   &lt;fct&gt;       &lt;int&gt;
## 1 underweight    21
## 2 lean          484
## 3 overweight    197
## 4 obese         222
## 5 severeobese    99
## 6 morbidobese    22
## 7 &lt;NA&gt;          106</code></pre>
<p>There were six different BMI groups. Over 100 study subjects had this information missing.
The samples were not evenly distributed across these BMI groups. Instead, the most common (lean) had
almost 500 subjects, while the smaller BMI-group samples were around 20 people.</p>
<p>See if it looks like diversity varies much between males and females:</p>
<div class="sourceCode" id="cb814"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb814-1" title="1">atlas1006 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb814-2" title="2"><span class="st">  </span><span class="kw">get_variable</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb814-3" title="3"><span class="st">  </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb814-4" title="4"><span class="st">  </span><span class="kw">group_by</span>(sex) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb814-5" title="5"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">mean_diversity =</span> <span class="kw">mean</span>(diversity))</a></code></pre></div>
<pre><code>## Warning: Factor `sex` contains implicit NA, consider using
## `forcats::fct_explicit_na`</code></pre>
<pre><code>## # A tibble: 3 x 2
##   sex    mean_diversity
##   &lt;fct&gt;           &lt;dbl&gt;
## 1 female           5.84
## 2 male             5.85
## 3 &lt;NA&gt;             5.76</code></pre>
<p>See if it looks like diversity varies much across BMI groups:</p>
<div class="sourceCode" id="cb817"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb817-1" title="1">atlas1006 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb817-2" title="2"><span class="st">  </span><span class="kw">get_variable</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb817-3" title="3"><span class="st">  </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb817-4" title="4"><span class="st">  </span><span class="kw">group_by</span>(bmi_group) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb817-5" title="5"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">mean_diversity =</span> <span class="kw">mean</span>(diversity))</a></code></pre></div>
<pre><code>## Warning: Factor `bmi_group` contains implicit NA, consider using
## `forcats::fct_explicit_na`</code></pre>
<pre><code>## # A tibble: 7 x 2
##   bmi_group   mean_diversity
##   &lt;fct&gt;                &lt;dbl&gt;
## 1 underweight           5.84
## 2 lean                  5.89
## 3 overweight            5.83
## 4 obese                 5.82
## 5 severeobese           5.74
## 6 morbidobese           5.67
## 7 &lt;NA&gt;                  5.81</code></pre>
<p>Here is the code for the plot:</p>
<div class="sourceCode" id="cb820"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb820-1" title="1"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb820-2" title="2"><span class="kw">library</span>(ggthemes)</a>
<a class="sourceLine" id="cb820-3" title="3"><span class="kw">library</span>(microbiome)</a>
<a class="sourceLine" id="cb820-4" title="4"></a>
<a class="sourceLine" id="cb820-5" title="5"><span class="kw">data</span>(atlas1006)</a>
<a class="sourceLine" id="cb820-6" title="6"></a>
<a class="sourceLine" id="cb820-7" title="7">atlas1006 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb820-8" title="8"><span class="st">  </span><span class="kw">get_variable</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb820-9" title="9"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> bmi_group, <span class="dt">y =</span> diversity, <span class="dt">color =</span> sex)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb820-10" title="10"><span class="st">  </span><span class="kw">geom_boxplot</span>(<span class="dt">alpha =</span> <span class="fl">0.2</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb820-11" title="11"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>nationality)</a></code></pre></div>
<p><img src="RProgrammingForResearch_files/figure-html/unnamed-chunk-462-1.png" width="672" /></p>
</div>
</div>
<div id="more-with-baby-names" class="section level3">
<h3><span class="header-section-number">7.8.2</span> More with baby names</h3>
<p>Let’s look at baby names that we started looking at last class, based on the letter they start with.</p>
<ul>
<li>For the full dataframe, what proportion of baby names start with each letter?
See if you can create a figure to help show this. Create the same plot
using the names of people from our class.</li>
<li>What proportion of names start with “C” or “S” across the full dataset?</li>
</ul>
<div id="example-r-code-14" class="section level4">
<h4><span class="header-section-number">7.8.2.1</span> Example R code</h4>
<p>For the full dataframe, what proportion of baby names start with “S”?</p>
<p>To start, create a column with the first letter of each name. You can use
functions in the <code>stringr</code> package to do this. The easiest might be to
use the position of the first letter to pull that information.</p>
<div class="sourceCode" id="cb821"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb821-1" title="1"><span class="kw">library</span>(babynames)</a>
<a class="sourceLine" id="cb821-2" title="2"><span class="kw">library</span>(stringr)</a>
<a class="sourceLine" id="cb821-3" title="3">top_letters &lt;-<span class="st"> </span>babynames <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb821-4" title="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">first_letter =</span> <span class="kw">str_sub</span>(name, <span class="dv">1</span>, <span class="dv">1</span>))</a>
<a class="sourceLine" id="cb821-5" title="5"></a>
<a class="sourceLine" id="cb821-6" title="6">top_letters <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb821-7" title="7"><span class="st">  </span><span class="kw">select</span>(name, first_letter) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb821-8" title="8"><span class="st">  </span><span class="kw">slice</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>)</a></code></pre></div>
<pre><code>## # A tibble: 5 x 2
##   name      first_letter
##   &lt;chr&gt;     &lt;chr&gt;       
## 1 Mary      M           
## 2 Anna      A           
## 3 Emma      E           
## 4 Elizabeth E           
## 5 Minnie    M</code></pre>
<p>Now we can group by letter and figure out these proportions. First, while the data is
grouped, count the number of names with each letter. Then, ungroup and use mutate
to divide this by the total number of names:</p>
<div class="sourceCode" id="cb823"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb823-1" title="1">top_letters &lt;-<span class="st"> </span>top_letters <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb823-2" title="2"><span class="st">  </span><span class="kw">group_by</span>(first_letter) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb823-3" title="3"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">n =</span> <span class="kw">sum</span>(n)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb823-4" title="4"><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb823-5" title="5"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">prop =</span> n <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(n)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb823-6" title="6"><span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(prop))</a>
<a class="sourceLine" id="cb823-7" title="7"></a>
<a class="sourceLine" id="cb823-8" title="8">top_letters</a></code></pre></div>
<pre><code>## # A tibble: 26 x 3
##    first_letter        n   prop
##    &lt;chr&gt;           &lt;int&gt;  &lt;dbl&gt;
##  1 J            44612175 0.128 
##  2 M            32864210 0.0944
##  3 A            28855232 0.0829
##  4 C            25533863 0.0733
##  5 D            24240271 0.0696
##  6 R            23702794 0.0681
##  7 S            21373830 0.0614
##  8 L            18942067 0.0544
##  9 E            17033760 0.0489
## 10 K            17006684 0.0489
## # … with 16 more rows</code></pre>
<p>Here’s one way to visualize this:</p>
<div class="sourceCode" id="cb825"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb825-1" title="1"><span class="kw">library</span>(scales)</a>
<a class="sourceLine" id="cb825-2" title="2">top_letters <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb825-3" title="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">first_letter =</span> <span class="kw">fct_reorder</span>(first_letter, prop)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb825-4" title="4"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> first_letter)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb825-5" title="5"><span class="st">  </span><span class="kw">geom_bar</span>(<span class="kw">aes</span>(<span class="dt">weight =</span> prop)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb825-6" title="6"><span class="st">  </span><span class="kw">coord_flip</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb825-7" title="7"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> percent) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb825-8" title="8"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Percent of names that start with ...&quot;</span>)</a></code></pre></div>
<p><img src="RProgrammingForResearch_files/figure-html/unnamed-chunk-465-1.png" width="384" /></p>
<p>Create the same plot using the names of people in our class. First, create a
vector with the names of people in our class:</p>
<div class="sourceCode" id="cb826"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb826-1" title="1">student_list &lt;-<span class="st"> </span><span class="kw">data_frame</span>(<span class="dt">name =</span> <span class="kw">c</span>(<span class="st">&quot;Burton&quot;</span>, <span class="st">&quot;Caroline&quot;</span>, <span class="st">&quot;Chaoyu&quot;</span>, <span class="st">&quot;Collin&quot;</span>,</a>
<a class="sourceLine" id="cb826-2" title="2">                                    <span class="st">&quot;Daniel&quot;</span>, <span class="st">&quot;Eric&quot;</span>, <span class="st">&quot;Erin&quot;</span>, <span class="st">&quot;Heather&quot;</span>,</a>
<a class="sourceLine" id="cb826-3" title="3">                                    <span class="st">&quot;Jacob&quot;</span>, <span class="st">&quot;Jessica&quot;</span>, <span class="st">&quot;Khum&quot;</span>, <span class="st">&quot;Kyle&quot;</span>,</a>
<a class="sourceLine" id="cb826-4" title="4">                                    <span class="st">&quot;Matthew&quot;</span>, <span class="st">&quot;Molly&quot;</span>, <span class="st">&quot;Nikki&quot;</span>, <span class="st">&quot;Rachel&quot;</span>,</a>
<a class="sourceLine" id="cb826-5" title="5">                                    <span class="st">&quot;Sere&quot;</span>,  <span class="st">&quot;Shayna&quot;</span>, <span class="st">&quot;Sherry&quot;</span>, <span class="st">&quot;Sunny&quot;</span>))</a>
<a class="sourceLine" id="cb826-6" title="6">student_list &lt;-<span class="st"> </span>student_list <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb826-7" title="7"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">first_letter =</span> <span class="kw">str_sub</span>(name, <span class="dv">1</span>, <span class="dv">1</span>))</a>
<a class="sourceLine" id="cb826-8" title="8">student_list</a></code></pre></div>
<pre><code>## # A tibble: 20 x 2
##    name     first_letter
##    &lt;chr&gt;    &lt;chr&gt;       
##  1 Burton   B           
##  2 Caroline C           
##  3 Chaoyu   C           
##  4 Collin   C           
##  5 Daniel   D           
##  6 Eric     E           
##  7 Erin     E           
##  8 Heather  H           
##  9 Jacob    J           
## 10 Jessica  J           
## 11 Khum     K           
## 12 Kyle     K           
## 13 Matthew  M           
## 14 Molly    M           
## 15 Nikki    N           
## 16 Rachel   R           
## 17 Sere     S           
## 18 Shayna   S           
## 19 Sherry   S           
## 20 Sunny    S</code></pre>
<div class="sourceCode" id="cb828"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb828-1" title="1"><span class="kw">library</span>(scales)</a>
<a class="sourceLine" id="cb828-2" title="2">student_list <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb828-3" title="3"><span class="st">  </span><span class="kw">group_by</span>(first_letter) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb828-4" title="4"><span class="st">  </span><span class="kw">count</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb828-5" title="5"><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb828-6" title="6"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">prop =</span> n <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(n)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb828-7" title="7"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">first_letter =</span> <span class="kw">fct_reorder</span>(first_letter, prop)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb828-8" title="8"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> first_letter)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb828-9" title="9"><span class="st">  </span><span class="kw">geom_bar</span>(<span class="kw">aes</span>(<span class="dt">weight =</span> prop)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb828-10" title="10"><span class="st">  </span><span class="kw">coord_flip</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb828-11" title="11"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> percent) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb828-12" title="12"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Percent of students with</span><span class="ch">\n</span><span class="st">a name that starts with ...&quot;</span>)</a></code></pre></div>
<p><img src="RProgrammingForResearch_files/figure-html/unnamed-chunk-466-1.png" width="288" /></p>
<p>What proportion of names start with “C” or “S” across the full dataset? You can
create a dataframe that (1) pulls out the first letter of each name (just like
we did for the last part of the question) and (2) tests whether that first letter
is an “A” or a “K” (using a logical statement):</p>
<div class="sourceCode" id="cb829"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb829-1" title="1">c_or_s &lt;-<span class="st"> </span>babynames <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb829-2" title="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">first_letter =</span> <span class="kw">str_sub</span>(name, <span class="dv">1</span>, <span class="dv">1</span>),</a>
<a class="sourceLine" id="cb829-3" title="3">         <span class="dt">c_or_s =</span> first_letter <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;C&quot;</span>, <span class="st">&quot;S&quot;</span>))</a>
<a class="sourceLine" id="cb829-4" title="4"></a>
<a class="sourceLine" id="cb829-5" title="5">c_or_s <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb829-6" title="6"><span class="st">  </span><span class="kw">select</span>(name, first_letter, c_or_s) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb829-7" title="7"><span class="st">  </span><span class="kw">slice</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>)</a></code></pre></div>
<pre><code>## # A tibble: 5 x 3
##   name      first_letter c_or_s
##   &lt;chr&gt;     &lt;chr&gt;        &lt;lgl&gt; 
## 1 Mary      M            FALSE 
## 2 Anna      A            FALSE 
## 3 Emma      E            FALSE 
## 4 Elizabeth E            FALSE 
## 5 Minnie    M            FALSE</code></pre>
<p>Next, group by this logical column (<code>c_or_s</code>) and figure out the number of
baby names for each group. Then, to get the proportion of the total, ungroup
and mutate to divide by the total number across the data:</p>
<div class="sourceCode" id="cb831"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb831-1" title="1">c_or_s <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb831-2" title="2"><span class="st">  </span><span class="kw">group_by</span>(c_or_s) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb831-3" title="3"><span class="st">  </span><span class="kw">count</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb831-4" title="4"><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb831-5" title="5"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">prop =</span> n <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(n))</a></code></pre></div>
<pre><code>## # A tibble: 2 x 3
##   c_or_s       n  prop
##   &lt;lgl&gt;    &lt;int&gt; &lt;dbl&gt;
## 1 FALSE  1655755 0.860
## 2 TRUE    268910 0.140</code></pre>
</div>
</div>
<div id="running-a-simple-statistical-test" class="section level3">
<h3><span class="header-section-number">7.8.3</span> Running a simple statistical test</h3>
<p>In the last part of the in-course exercise, we found out that about 14% of babies born in the
United States between 1980 and 1995 had names that started with an “C” or “S” (268,910
babies out of 1,924,665).</p>
<ul>
<li>What is the proportion of people with names that start with an “C” or “S” in our class?</li>
<li>Use a simple statistical test to test the hypothesis that the class comes from a
binomial distribution with the same distribution as babies born in the US over the time tracked by this data, in terms of chance of having a name that starts with “C” or “S”. (Hint: You will be comparing two proportions. Try googling for a statistical test in R that does that.)</li>
<li>See if you can figure out a way to make a single “tidy” pipeline for the whole analysis (and output the result as a tidy dataframe). Does the <code>tidy</code> function from <code>broom</code> give different information from this test than the output we got for the Shapiro-Wilk test?</li>
<li>You may get the warning “Chi-squared approximation may be incorrect”. See if you can
figure out this warning if you get it with the test you used.</li>
</ul>
<hr />
<div id="example-r-code-15" class="section level4">
<h4><span class="header-section-number">7.8.3.1</span> Example R code</h4>
<p>Here is a vector with names in our class:</p>
<div class="sourceCode" id="cb833"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb833-1" title="1"><span class="kw">library</span>(stringr)</a>
<a class="sourceLine" id="cb833-2" title="2">student_list &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">name =</span> <span class="kw">c</span>(<span class="st">&quot;Burton&quot;</span>, <span class="st">&quot;Caroline&quot;</span>, <span class="st">&quot;Chaoyu&quot;</span>, <span class="st">&quot;Collin&quot;</span>,</a>
<a class="sourceLine" id="cb833-3" title="3">                                    <span class="st">&quot;Daniel&quot;</span>, <span class="st">&quot;Eric&quot;</span>, <span class="st">&quot;Erin&quot;</span>, <span class="st">&quot;Heather&quot;</span>,</a>
<a class="sourceLine" id="cb833-4" title="4">                                    <span class="st">&quot;Jacob&quot;</span>, <span class="st">&quot;Jessica&quot;</span>, <span class="st">&quot;Khum&quot;</span>, <span class="st">&quot;Kyle&quot;</span>,</a>
<a class="sourceLine" id="cb833-5" title="5">                                    <span class="st">&quot;Matthew&quot;</span>, <span class="st">&quot;Molly&quot;</span>, <span class="st">&quot;Nikki&quot;</span>, <span class="st">&quot;Rachel&quot;</span>,</a>
<a class="sourceLine" id="cb833-6" title="6">                                    <span class="st">&quot;Sere&quot;</span>,  <span class="st">&quot;Shayna&quot;</span>, <span class="st">&quot;Sherry&quot;</span>, <span class="st">&quot;Sunny&quot;</span>))</a>
<a class="sourceLine" id="cb833-7" title="7">student_list &lt;-<span class="st"> </span>student_list <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb833-8" title="8"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">first_letter =</span> <span class="kw">str_sub</span>(name, <span class="dv">1</span>, <span class="dv">1</span>))</a>
<a class="sourceLine" id="cb833-9" title="9">student_list <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb833-10" title="10"><span class="st">  </span><span class="kw">slice</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>)</a></code></pre></div>
<pre><code>## # A tibble: 3 x 2
##   name     first_letter
##   &lt;chr&gt;    &lt;chr&gt;       
## 1 Burton   B           
## 2 Caroline C           
## 3 Chaoyu   C</code></pre>
<p>Let’s get the total number of students, and then the total number with a name that
starts with “C” or “S”:</p>
<div class="sourceCode" id="cb835"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb835-1" title="1">tot_students &lt;-<span class="st"> </span>student_list <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb835-2" title="2"><span class="st">  </span><span class="kw">count</span>()</a>
<a class="sourceLine" id="cb835-3" title="3">tot_students</a></code></pre></div>
<pre><code>## # A tibble: 1 x 1
##       n
##   &lt;int&gt;
## 1    20</code></pre>
<div class="sourceCode" id="cb837"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb837-1" title="1">c_or_s_students &lt;-<span class="st"> </span>student_list <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb837-2" title="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">c_or_s =</span> first_letter <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;C&quot;</span>, <span class="st">&quot;S&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb837-3" title="3"><span class="st">  </span><span class="kw">group_by</span>(c_or_s) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb837-4" title="4"><span class="st">  </span><span class="kw">count</span>()</a>
<a class="sourceLine" id="cb837-5" title="5">c_or_s_students</a></code></pre></div>
<pre><code>## # A tibble: 2 x 2
## # Groups:   c_or_s [2]
##   c_or_s     n
##   &lt;lgl&gt;  &lt;int&gt;
## 1 FALSE     13
## 2 TRUE       7</code></pre>
<p>The proportion of students with names starting with “A” or “K” are 7 /
20 = 0.35.</p>
<p>You could run a statistical test comparing these two proportions (check the help file for the
function to figure out where to include each piece):</p>
<div class="sourceCode" id="cb839"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb839-1" title="1"><span class="kw">prop.test</span>(<span class="dt">x =</span> <span class="kw">c</span>(<span class="dv">268910</span>, <span class="dv">7</span>), <span class="dt">n =</span> <span class="kw">c</span>(<span class="dv">1924665</span>, <span class="dv">20</span>))</a></code></pre></div>
<pre><code>## Warning in prop.test(x = c(268910, 7), n = c(1924665, 20)): Chi-squared
## approximation may be incorrect</code></pre>
<pre><code>## 
##  2-sample test for equality of proportions with continuity
##  correction
## 
## data:  c(268910, 7) out of c(1924665, 20)
## X-squared = 5.7121, df = 1, p-value = 0.01685
## alternative hypothesis: two.sided
## 95 percent confidence interval:
##  -0.44432032  0.02375596
## sample estimates:
##    prop 1    prop 2 
## 0.1397178 0.3500000</code></pre>
<p>There are a few different ways you could run this test.
For example, you could also test whether the proportion in our class is consistent with the null
hypothesis that you were drawn from a binomial distribution with a proportion of 0.14
(in-line with the national values):</p>
<div class="sourceCode" id="cb842"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb842-1" title="1"><span class="kw">prop.test</span>(<span class="dt">x =</span> <span class="dv">7</span>, <span class="dt">n =</span> <span class="dv">20</span>, <span class="dt">p =</span> <span class="fl">0.14</span>)</a></code></pre></div>
<pre><code>## Warning in prop.test(x = 7, n = 20, p = 0.14): Chi-squared approximation
## may be incorrect</code></pre>
<pre><code>## 
##  1-sample proportions test with continuity correction
## 
## data:  7 out of 20, null probability 0.14
## X-squared = 5.6852, df = 1, p-value = 0.01711
## alternative hypothesis: true p is not equal to 0.14
## 95 percent confidence interval:
##  0.1630867 0.5905104
## sample estimates:
##    p 
## 0.35</code></pre>
<p>You can also see if we can pipe into <code>prop.test</code> by summing up the number of successes (“1”: the person’s name starts with “C” or “S”). Because this is using an unsummarized
form of the data, it lets us use some of the tidyverse tools more easily:</p>
<div class="sourceCode" id="cb845"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb845-1" title="1"><span class="kw">library</span>(purrr)</a>
<a class="sourceLine" id="cb845-2" title="2"><span class="kw">library</span>(broom)</a>
<a class="sourceLine" id="cb845-3" title="3">student_list <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb845-4" title="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">c_or_s =</span> first_letter <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;C&quot;</span>, <span class="st">&quot;S&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb845-5" title="5"><span class="st">  </span><span class="kw">pluck</span>(<span class="st">&quot;c_or_s&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb845-6" title="6"><span class="st">  </span><span class="kw">sum</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb845-7" title="7"><span class="st">  </span><span class="kw">prop.test</span>(<span class="dt">n =</span> <span class="dv">20</span>, <span class="dt">p =</span> <span class="fl">0.14</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb845-8" title="8"><span class="st">  </span><span class="kw">tidy</span>()</a></code></pre></div>
<pre><code>## Warning in prop.test(., n = 20, p = 0.14): Chi-squared approximation may be
## incorrect</code></pre>
<pre><code>## # A tibble: 1 x 8
##   estimate statistic p.value parameter conf.low conf.high method
##      &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;     &lt;int&gt;    &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt; 
## 1     0.35      5.69  0.0171         1    0.163     0.591 1-sam…
## # … with 1 more variable: alternative &lt;chr&gt;</code></pre>
<p>Finally, when we run this test, we get the warning that “Chi-squared approximation may be incorrect”. Based on googling ‘r prop.test “Chi-squared approximation may be incorrect”’,
it sounds like we might be getting this error because we have a pretty low number of
people in the class. One recommendation is to use <code>binom.test</code>, which will run as an exact binomial test:</p>
<div class="sourceCode" id="cb848"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb848-1" title="1"><span class="kw">binom.test</span>(<span class="dt">x =</span> <span class="dv">7</span>, <span class="dt">n =</span> <span class="dv">20</span>, <span class="dt">p =</span> <span class="fl">0.14</span>)</a></code></pre></div>
<pre><code>## 
##  Exact binomial test
## 
## data:  7 and 20
## number of successes = 7, number of trials = 20, p-value = 0.01534
## alternative hypothesis: true probability of success is not equal to 0.14
## 95 percent confidence interval:
##  0.1539092 0.5921885
## sample estimates:
## probability of success 
##                   0.35</code></pre>
</div>
</div>
<div id="using-regression-models-to-explore-data-1" class="section level3">
<h3><span class="header-section-number">7.8.4</span> Using regression models to explore data #1</h3>
<p>For this exercise, you will need the following packages. If do not have them already, you will need to install them.</p>
<div class="sourceCode" id="cb850"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb850-1" title="1"><span class="kw">library</span>(ggplot2)</a>
<a class="sourceLine" id="cb850-2" title="2"><span class="kw">library</span>(broom)</a>
<a class="sourceLine" id="cb850-3" title="3"><span class="kw">library</span>(ggfortify)</a></code></pre></div>
<p>For this part of the exercise, you’ll use a dataset on weather, air pollution, and mortality counts in Chicago, IL. This dataset is called <code>chicagoNMMAPS</code> and is part of the <code>dlnm</code> package. Change the name of the data frame to <code>chic</code> (this object name is shorter and will be easier to work with). Check out the data a bit to see what variables you have, and then perform the following tasks:</p>
<ul>
<li>Write out (on paper, not in R) the regression equation for regressing dewpoint temperature on temperature.</li>
<li>Try fitting a linear regression of dew point temperature (<code>dptp</code>) regressed on temperature (<code>temp</code>). Save this model as the object <code>mod_1</code> (i.e., is the dependent variable of
dewpoint temperature linearly associated with the independent variable of temperature).</li>
<li>Based on this regression, does there seem to be a relationship between temperature and dewpoint temperature in Chicago? (Hint: Try using <code>glance</code> and <code>tidy</code> from the <code>broom</code> package on the model object to get more information about the model you fit.) What is the coefficient for temperature (in other words, for every 1 degree increase in temperature, how much do we expect the dewpoint temperature to change?)? What is the p-value for the coefficient for temperature?</li>
<li>Plot temperature (x-axis) versus dewpoint temperature (y-axis) for Chicago. Add in the regression line from the model you fit by using the results from <code>augment</code>.</li>
<li>Use <code>autoplot</code> on the model object to generate some model diagnostic plots (make sure you have the <code>ggfortify</code> package loaded and installed).</li>
</ul>
<hr />
<div id="example-r-code-16" class="section level4">
<h4><span class="header-section-number">7.8.4.1</span> Example R code:</h4>
<p>The regression equation for the model you want to fit, regressing dewpoint temperature on temperature, is:</p>
<p><span class="math display">\[
Y_t \sim \beta_0 + \beta_1 X_t
\]</span></p>
<p>where <span class="math inline">\(Y_t\)</span> is the dewpoint temperature on day <span class="math inline">\(t\)</span>, <span class="math inline">\(X_t\)</span> is the temperature on day <span class="math inline">\(t\)</span>, and <span class="math inline">\(\beta_0\)</span> and <span class="math inline">\(\beta_1\)</span> are model coefficients.</p>
<p>Install and load the <code>dlnm</code> package and then load the <code>chicagoNMMAPS</code> data. Change the name of the data frame to <code>chic</code>, so it will be shorter to call for the rest of your work.</p>
<div class="sourceCode" id="cb851"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb851-1" title="1"><span class="co"># install.packages(&quot;dlnm&quot;)</span></a>
<a class="sourceLine" id="cb851-2" title="2"><span class="kw">library</span>(dlnm)</a>
<a class="sourceLine" id="cb851-3" title="3"><span class="kw">data</span>(<span class="st">&quot;chicagoNMMAPS&quot;</span>)</a>
<a class="sourceLine" id="cb851-4" title="4">chic &lt;-<span class="st"> </span>chicagoNMMAPS</a></code></pre></div>
<p>Fit a linear regression of <code>dptp</code> on <code>temp</code> and save as the object <code>mod_1</code>:</p>
<div class="sourceCode" id="cb852"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb852-1" title="1">mod_<span class="dv">1</span> &lt;-<span class="st"> </span><span class="kw">lm</span>(dptp <span class="op">~</span><span class="st"> </span>temp, <span class="dt">data =</span> chic)</a>
<a class="sourceLine" id="cb852-2" title="2">mod_<span class="dv">1</span></a></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = dptp ~ temp, data = chic)
## 
## Coefficients:
## (Intercept)         temp  
##      24.025        1.621</code></pre>
<p>Use functions from the <code>broom</code> package to pull the same information about the model in a “tidy” format. To find out if the evidence for a linear association between temperature and dewpoint temperature, use the <code>tidy</code> function to get model coefficients in a tidy format:</p>
<div class="sourceCode" id="cb854"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb854-1" title="1"><span class="kw">tidy</span>(mod_<span class="dv">1</span>)</a></code></pre></div>
<pre><code>## # A tibble: 2 x 5
##   term        estimate std.error statistic p.value
##   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;
## 1 (Intercept)    24.0    0.113        213.       0
## 2 temp            1.62   0.00763      212.       0</code></pre>
<p>There does seem to be an association between temperature and dewpoint temperature: a unit increase in temperature is associated with a 1.6 unit increase in dewpoint temperature. The p-value for the temperature coefficient is &lt;2e-16. This is far below 0.05, which suggests we would be very unlikely to see such a strong association by chance if the null hypothesis, that the two variables are not associated, were true.</p>
<p>You can also check overall model summaries using the <code>glance</code> function:</p>
<div class="sourceCode" id="cb856"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb856-1" title="1"><span class="kw">glance</span>(mod_<span class="dv">1</span>)</a></code></pre></div>
<pre><code>## # A tibble: 1 x 11
##   r.squared adj.r.squared sigma statistic p.value    df  logLik    AIC
##       &lt;dbl&gt;         &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt;  &lt;dbl&gt;
## 1     0.898         0.898  5.90    45108.       0     2 -16332. 32670.
## # … with 3 more variables: BIC &lt;dbl&gt;, deviance &lt;dbl&gt;, df.residual &lt;int&gt;</code></pre>
<p>To create plots of the observations and the fit model, use the <code>augment</code> function to add model output (e.g., predictions, residuals) to the original data frame of observed temperatures and dew point temperatures:</p>
<div class="sourceCode" id="cb858"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb858-1" title="1"><span class="kw">augment</span>(mod_<span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb858-2" title="2"><span class="st">  </span><span class="kw">slice</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>)</a></code></pre></div>
<pre><code>## # A tibble: 3 x 9
##    dptp   temp .fitted .se.fit .resid     .hat .sigma   .cooksd .std.resid
##   &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;
## 1  31.5 -0.278    23.6   0.114   7.93 0.000376   5.90 0.000340       1.34 
## 2  29.9  0.556    24.9   0.110   4.95 0.000348   5.90 0.000123       0.839
## 3  27.4  0.556    24.9   0.110   2.45 0.000348   5.90 0.0000300      0.415</code></pre>
<p>Plot these two variables and add in the fitted line from the model (note: I’ve used the <code>color</code> option to make the color of the points gray). Use the output from <code>augment</code> to create a plot of the original data, with the predicted values used to plot a fitted line.</p>
<div class="sourceCode" id="cb860"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb860-1" title="1"><span class="kw">augment</span>(mod_<span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb860-2" title="2"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> temp, <span class="dt">y =</span> dptp)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb860-3" title="3"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="fl">0.8</span>, <span class="dt">alpha =</span> <span class="fl">0.5</span>, <span class="dt">col =</span> <span class="st">&quot;gray&quot;</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb860-4" title="4"><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x =</span> temp, <span class="dt">y =</span> .fitted), <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">size =</span> <span class="dv">2</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb860-5" title="5"><span class="st">  </span><span class="kw">theme_classic</span>()</a></code></pre></div>
<p><img src="RProgrammingForResearch_files/figure-html/unnamed-chunk-481-1.png" width="480" /></p>
<p>Plot some plots to check model assumptions for the model you fit using the <code>autoplot</code> function on your model object:</p>
<div class="sourceCode" id="cb861"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb861-1" title="1"><span class="kw">autoplot</span>(mod_<span class="dv">1</span>)</a></code></pre></div>
<p><img src="RProgrammingForResearch_files/figure-html/unnamed-chunk-482-1.png" width="576" /></p>
<hr />
</div>
</div>
<div id="using-regression-models-to-explore-data-2" class="section level3">
<h3><span class="header-section-number">7.8.5</span> Using regression models to explore data #2</h3>
<ul>
<li>Try fitting the regression from the last part of the in-course exercise as a GLM, using <code>glm()</code> (but still assuming the outcome variable is normally distributed). Are your coefficients different?</li>
<li>Does <span class="math inline">\(PM_{10}\)</span> vary by day of the week? (Hint: The <code>dow</code> variable is a factor that gives day of the week. You can do an ANOVA analysis by fitting a linear model using this variable as the independent variable. Some of the overall model summaries will compare this model to an intercept-only model.) What day of the week is <span class="math inline">\(PM_{10}\)</span> generally highest? (Check the model coefficients to figure this out.) Try to write out (on paper) the regression equation for the model you’re fitting.</li>
<li>Try using <code>glm()</code> to run a Poisson regression of respiratory deaths (<code>resp</code>) on temperature during summer days. Start by creating a subset with just summer days called <code>summer</code>. (Hint: Use the <code>month</code> function with the argument <code>label = TRUE</code> from <code>lubridate</code> to do this—just pull out the subset where the month June, July, or August.) Try to write out the regression equation for the model you’re fitting.</li>
<li>The coefficient for the temperature variable in this model is our best estimate (based on this model) of the <strong>log relative risk</strong> for a one degree Celcius increase in temperature. What is the <strong>relative risk</strong> associated with a one degree Celsius increase?</li>
</ul>
<hr />
<div id="example-r-code-17" class="section level4">
<h4><span class="header-section-number">7.8.5.1</span> Example R code:</h4>
<p>Try fitting the model from the last part of the in-course exercise using <code>glm()</code>. Call it <code>mod_1a</code>. Compare the coefficients for the two models. You can use the <code>tidy</code> function on an <code>lm</code> or <code>glm</code> object to pull out just the model coefficients and associated model results. Here, I’ve used a pipeline of code to create a tidy data frame that merges these “tidy” coefficient outputs (from the two models) into a single data frame):</p>
<div class="sourceCode" id="cb862"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb862-1" title="1">mod_1a &lt;-<span class="st"> </span><span class="kw">glm</span>(dptp <span class="op">~</span><span class="st"> </span>temp, <span class="dt">data =</span> chic)</a>
<a class="sourceLine" id="cb862-2" title="2"></a>
<a class="sourceLine" id="cb862-3" title="3"><span class="kw">tidy</span>(mod_<span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb862-4" title="4"><span class="st">  </span><span class="kw">select</span>(term, estimate) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb862-5" title="5"><span class="st">  </span><span class="kw">inner_join</span>(mod_1a <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">tidy</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(term, estimate), <span class="dt">by =</span> <span class="st">&quot;term&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb862-6" title="6"><span class="st">  </span><span class="kw">rename</span>(<span class="dt">estimate_lm_mod =</span> estimate.x,</a>
<a class="sourceLine" id="cb862-7" title="7">         <span class="dt">estimate_glm_mod =</span> estimate.y)</a></code></pre></div>
<pre><code>## # A tibble: 2 x 3
##   term        estimate_lm_mod estimate_glm_mod
##   &lt;chr&gt;                 &lt;dbl&gt;            &lt;dbl&gt;
## 1 (Intercept)           24.0             24.0 
## 2 temp                   1.62             1.62</code></pre>
<p>The results from the two models are identical.</p>
<p>As a note, you could have also just run <code>tidy</code> on each model object, without merging them together into a single data frame:</p>
<div class="sourceCode" id="cb864"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb864-1" title="1"><span class="kw">tidy</span>(mod_<span class="dv">1</span>)</a></code></pre></div>
<pre><code>## # A tibble: 2 x 5
##   term        estimate std.error statistic p.value
##   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;
## 1 (Intercept)    24.0    0.113        213.       0
## 2 temp            1.62   0.00763      212.       0</code></pre>
<div class="sourceCode" id="cb866"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb866-1" title="1"><span class="kw">tidy</span>(mod_1a)</a></code></pre></div>
<pre><code>## # A tibble: 2 x 5
##   term        estimate std.error statistic p.value
##   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;
## 1 (Intercept)    24.0    0.113        213.       0
## 2 temp            1.62   0.00763      212.       0</code></pre>
<p>Fit a model of <span class="math inline">\(PM_{10}\)</span> regressed on day of week, where day of week is a factor.</p>
<div class="sourceCode" id="cb868"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb868-1" title="1">mod_<span class="dv">2</span> &lt;-<span class="st"> </span><span class="kw">lm</span>(pm10 <span class="op">~</span><span class="st"> </span>dow, <span class="dt">data =</span> chic)</a>
<a class="sourceLine" id="cb868-2" title="2"><span class="kw">tidy</span>(mod_<span class="dv">2</span>)</a></code></pre></div>
<pre><code>## # A tibble: 7 x 5
##   term         estimate std.error statistic   p.value
##   &lt;chr&gt;           &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
## 1 (Intercept)     27.5      0.730     37.7  7.47e-273
## 2 dowMonday        6.13     1.03       5.93 3.22e-  9
## 3 dowTuesday       6.80     1.03       6.62 4.05e- 11
## 4 dowWednesday     8.48     1.03       8.26 1.85e- 16
## 5 dowThursday      8.80     1.02       8.60 1.08e- 17
## 6 dowFriday        9.48     1.03       9.24 3.61e- 20
## 7 dowSaturday      3.66     1.03       3.56 3.68e-  4</code></pre>
<p>Use <code>glance</code> to check some of the overall summaries of this model. The <code>statistic</code> column here is the F statistic from test comparing this model to an intercept-only model.</p>
<div class="sourceCode" id="cb870"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb870-1" title="1"><span class="kw">glance</span>(mod_<span class="dv">2</span>)</a></code></pre></div>
<pre><code>## # A tibble: 1 x 11
##   r.squared adj.r.squared sigma statistic  p.value    df  logLik    AIC
##       &lt;dbl&gt;         &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt;  &lt;dbl&gt;
## 1    0.0259        0.0247  19.1      21.5 4.61e-25     7 -21234. 42484.
## # … with 3 more variables: BIC &lt;dbl&gt;, deviance &lt;dbl&gt;, df.residual &lt;int&gt;</code></pre>
<p>As a note, you may have heard in previous statistics classes that you can use the <code>anova()</code> command to compare this model to a model with only an intercept (i.e., one that only fits a global mean and uses that as the expected value for all of the observations). Note that, in this case, the F value from <code>anova</code> for this model comparison is the same as the <code>statistic</code> you got in the overall summary statistics you get with <code>glance</code> in the previous code.</p>
<div class="sourceCode" id="cb872"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb872-1" title="1"><span class="kw">anova</span>(mod_<span class="dv">2</span>)</a></code></pre></div>
<pre><code>## Analysis of Variance Table
## 
## Response: pm10
##             Df  Sum Sq Mean Sq F value    Pr(&gt;F)    
## dow          6   46924  7820.6    21.5 &lt; 2.2e-16 ***
## Residuals 4856 1766407   363.8                      
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>The overall p-value from <code>anova</code> for with day-of-week coefficients versus the model that just has an intercept is &lt; 2.2e-16. This is well below 0.05, which suggests that day-of-week is associated with PM10 concentration, as a model that includes day-of-week does a much better job of explaining variation in PM10 than a model without it does.</p>
<p>Use a boxplot to visually compare PM10 by day of week.</p>
<div class="sourceCode" id="cb874"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb874-1" title="1"><span class="kw">ggplot</span>(chic, <span class="kw">aes</span>(<span class="dt">x =</span> dow, <span class="dt">y =</span> pm10)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb874-2" title="2"><span class="st">  </span><span class="kw">geom_boxplot</span>()</a></code></pre></div>
<p><img src="RProgrammingForResearch_files/figure-html/unnamed-chunk-488-1.png" width="576" /></p>
<p>Now try the same plot, but try using the <code>ylim =</code> option to change the limits on the y-axis for the graph, so you can get a better idea of the pattern by day of week (some of the extreme values are very high, which makes it hard to compare by eye when the y-axis extends to include them all).</p>
<div class="sourceCode" id="cb875"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb875-1" title="1"><span class="kw">ggplot</span>(chic, <span class="kw">aes</span>(<span class="dt">x =</span> dow, <span class="dt">y =</span> pm10)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb875-2" title="2"><span class="st">  </span><span class="kw">geom_boxplot</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb875-3" title="3"><span class="st">  </span><span class="kw">ylim</span>(<span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">100</span>))</a></code></pre></div>
<pre><code>## Warning: Removed 292 rows containing non-finite values (stat_boxplot).</code></pre>
<p><img src="RProgrammingForResearch_files/figure-html/unnamed-chunk-489-1.png" width="576" /></p>
<p>Create a subset called <code>summer</code> with just the summer days:</p>
<div class="sourceCode" id="cb877"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb877-1" title="1"><span class="kw">library</span>(lubridate)</a>
<a class="sourceLine" id="cb877-2" title="2">summer &lt;-<span class="st"> </span>chic <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb877-3" title="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">month =</span> <span class="kw">month</span>(date, <span class="dt">label =</span> <span class="ot">TRUE</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb877-4" title="4"><span class="st">  </span><span class="kw">filter</span>(month <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Jun&quot;</span>, <span class="st">&quot;Jul&quot;</span>, <span class="st">&quot;Aug&quot;</span>))</a>
<a class="sourceLine" id="cb877-5" title="5">summer <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb877-6" title="6"><span class="st">  </span><span class="kw">slice</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>)</a></code></pre></div>
<pre><code>##         date time year month doy       dow death cvd resp     temp  dptp
## 1 1987-06-01  152 1987   Jun 152    Monday   112  60    5 23.61111 68.50
## 2 1987-06-02  153 1987   Jun 153   Tuesday   111  57    7 22.22222 64.75
## 3 1987-06-03  154 1987   Jun 154 Wednesday   120  59    9 20.55556 47.25
##     rhum     pm10       o3
## 1 71.875 22.95607 34.94623
## 2 95.250 31.31339 18.96620
## 3 47.125 34.95607 23.59270</code></pre>
<p>Use <code>glm()</code> to fit a Poisson model of respiratory deaths regressed on temperature. Since you want to fit a Poisson model, use the option <code>family = poisson(link = "log")</code>.</p>
<div class="sourceCode" id="cb879"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb879-1" title="1">mod_<span class="dv">3</span> &lt;-<span class="st"> </span><span class="kw">glm</span>(resp <span class="op">~</span><span class="st"> </span>temp, <span class="dt">data =</span> summer,</a>
<a class="sourceLine" id="cb879-2" title="2">             <span class="dt">family =</span> <span class="kw">poisson</span>(<span class="dt">link =</span> <span class="st">&quot;log&quot;</span>))</a>
<a class="sourceLine" id="cb879-3" title="3"><span class="kw">glance</span>(mod_<span class="dv">3</span>)</a></code></pre></div>
<pre><code>## # A tibble: 1 x 7
##   null.deviance df.null logLik   AIC   BIC deviance df.residual
##           &lt;dbl&gt;   &lt;int&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;       &lt;int&gt;
## 1         1499.    1287 -3211. 6425. 6436.    1494.        1286</code></pre>
<div class="sourceCode" id="cb881"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb881-1" title="1"><span class="kw">tidy</span>(mod_<span class="dv">3</span>)</a></code></pre></div>
<pre><code>## # A tibble: 2 x 5
##   term        estimate std.error statistic   p.value
##   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
## 1 (Intercept)  1.91      0.0584      32.7  6.60e-235
## 2 temp         0.00614   0.00258      2.38 1.74e-  2</code></pre>
<p>Use the fitted model coefficient to determine the relative risk for a one degree Celsius increase in temperature. First, remember that you can use the <code>tidy()</code> function to read out the model coefficients. The second of these is the value for the temperature coefficient. That means that you can use indexing (<code>[2]</code>) to get just that value. That’s the log relative risk; take the exponent to get the relative risk.</p>
<div class="sourceCode" id="cb883"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb883-1" title="1"><span class="kw">tidy</span>(mod_<span class="dv">3</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb883-2" title="2"><span class="st">  </span><span class="kw">filter</span>(term <span class="op">==</span><span class="st"> &quot;temp&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb883-3" title="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">log_rr =</span> <span class="kw">exp</span>(estimate))</a></code></pre></div>
<pre><code>## # A tibble: 1 x 6
##   term  estimate std.error statistic p.value log_rr
##   &lt;chr&gt;    &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;
## 1 temp   0.00614   0.00258      2.38  0.0174   1.01</code></pre>
<p>As a note, you can use the <code>conf.int</code> parameter in <code>tidy</code> to also pull confidence intervals:</p>
<div class="sourceCode" id="cb885"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb885-1" title="1"><span class="kw">tidy</span>(mod_<span class="dv">3</span>, <span class="dt">conf.int =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<pre><code>## # A tibble: 2 x 7
##   term        estimate std.error statistic   p.value conf.low conf.high
##   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
## 1 (Intercept)  1.91      0.0584      32.7  6.60e-235  1.80       2.02  
## 2 temp         0.00614   0.00258      2.38 1.74e-  2  0.00108    0.0112</code></pre>
<p>You could use this to get the confidence interval for relative risk (check out the <code>mutate_at</code> function if you haven’t seen it before):</p>
<div class="sourceCode" id="cb887"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb887-1" title="1"><span class="kw">tidy</span>(mod_<span class="dv">3</span>, <span class="dt">conf.int =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb887-2" title="2"><span class="st">  </span><span class="kw">select</span>(term, estimate, conf.low, conf.high) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb887-3" title="3"><span class="st">  </span><span class="kw">filter</span>(term <span class="op">==</span><span class="st"> &quot;temp&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb887-4" title="4"><span class="st">  </span><span class="kw">mutate_at</span>(<span class="kw">vars</span>(estimate<span class="op">:</span>conf.high), <span class="kw">funs</span>(<span class="kw">exp</span>(.)))</a></code></pre></div>
<pre><code>## Warning: funs() is soft deprecated as of dplyr 0.8.0
## Please use a list of either functions or lambdas: 
## 
##   # Simple named list: 
##   list(mean = mean, median = median)
## 
##   # Auto named with `tibble::lst()`: 
##   tibble::lst(mean, median)
## 
##   # Using lambdas
##   list(~ mean(., trim = .2), ~ median(., na.rm = TRUE))
## This warning is displayed once per session.</code></pre>
<pre><code>## # A tibble: 1 x 4
##   term  estimate conf.low conf.high
##   &lt;chr&gt;    &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
## 1 temp      1.01     1.00      1.01</code></pre>
</div>
</div>
<div id="trying-out-nesting-and-mapping" class="section level3">
<h3><span class="header-section-number">7.8.6</span> Trying out nesting and mapping</h3>
<ul>
<li>We’ll be using data that’s in an R package called “nycflights13”. This data package can be installed from CRAN. Install the package and then load the package and its “flights” dataset.
So that this data will be easier to work with, remove all columns except for those for
the departure delay (<code>dep_delay</code>), the carrier (<code>carrier</code>), the hour the flight was
supposed to leave (<code>hour</code>), and the airport the flight left from (<code>origin</code>). Also,
limit the dataset to only flights that left from LaGuardia Airport (“LGA”).</li>
<li>We want to figure out if the probability of a flight leaving 15 minutes late or more
increases over the day for flights leaving LaGuardia. Filter out all the rows where the
departure delay is missing and then create a new column called
<code>late_dep</code> that is true if the flight left 15 minutes or more late and false otherwise.
What proportion of all flights leaving from LaGuardia leave 15 minutes late or later?</li>
<li>Next, determine what proportion of all flights are delayed base on the hour that the
flight was scheduled to depart (<code>hour</code>). Create a plot showing how the probability of
leaving 15 minutes or more late changes by hour.</li>
<li>Fit a generalized linear model for the association between the binary variable of whether
the flight was 15 minutes or more late (<code>late_dep</code>) and the hour the flight was
scheduled to leave (<code>hour</code>). Use a binomial model (add <code>family = binomial(link = "logit")</code>
in the <code>glm</code> call). The estimate from the model for <code>hour</code> will be an estimate
of the log odds ratio for a one-hour increase in scheduled departure time. Take the
exponent of this estimate with <code>exp</code> to get an estimated odds ratio for a one-hour
increase in scheduled departure time. Is this estimate larger than 1.0?</li>
<li>Next, we want to see if this association is similar across airlines. First, create a
dataframe called <code>nested_flights</code> where the <code>flights</code>
data is grouped by airline (<code>carrier</code>) and then nest the data, so that there is a “data” list-column
where each item is a dataframe of flight delay data for a specific carrier.</li>
<li>Use the <code>map</code> function from <code>purrr</code> inside a <code>mutate</code> statement to apply the <code>glm</code> code you used earlier for the
whole dataset, but in this case for the data for each airline character. Then use the <code>map</code>
function inside a <code>mutate</code> statement again to “tidy” the data.</li>
<li>Clean the data up a bit. Remove the columns for <code>data</code> and
<code>glm_result</code> and then <code>unnest</code> the dataframe list-column with the tidy version of the model
results. Filter to get only the estimates for the “hour” term. Then calculate an odds ratio
(<code>or</code>) by taking the exponent (check out the <code>exp</code> function) of the original estimate.</li>
<li>The package has a dataframe with the full name of each carrier (<code>airlines</code>). Join this data
into the data you’ve been working with, so you have the full names of airlines.</li>
<li>Finally, create the following plot with each airline’s odds ratio for the change in the chance of a delay per one-hour increase in the scheduled hour of departure:</li>
</ul>
<p><img src="RProgrammingForResearch_files/figure-html/unnamed-chunk-495-1.png" width="672" /></p>
<hr />
<div id="example-r-code-18" class="section level4">
<h4><span class="header-section-number">7.8.6.1</span> Example R code:</h4>
<p>Install the “nycflights13” package from CRAN. Load the package and its “flights” dataset.</p>
<div class="sourceCode" id="cb890"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb890-1" title="1"><span class="kw">library</span>(ggplot2)</a>
<a class="sourceLine" id="cb890-2" title="2"><span class="kw">library</span>(nycflights13)</a>
<a class="sourceLine" id="cb890-3" title="3"><span class="kw">data</span>(flights)</a></code></pre></div>
<p>So that this data will be easier to work with, remove all columns except for those for
the departure dealy (<code>dep_delay</code>), the carrier (<code>carrier</code>), the hour the flight was
supposed to leave (<code>hour</code>), and the airport the flight left from (<code>origin</code>).</p>
<div class="sourceCode" id="cb891"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb891-1" title="1">flights &lt;-<span class="st"> </span>flights <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb891-2" title="2"><span class="st">  </span><span class="kw">select</span>(dep_delay, carrier, hour, origin) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb891-3" title="3"><span class="st">  </span><span class="kw">filter</span>(origin <span class="op">==</span><span class="st"> &quot;LGA&quot;</span>)</a>
<a class="sourceLine" id="cb891-4" title="4"></a>
<a class="sourceLine" id="cb891-5" title="5">flights</a></code></pre></div>
<pre><code>## # A tibble: 104,662 x 4
##    dep_delay carrier  hour origin
##        &lt;dbl&gt; &lt;chr&gt;   &lt;dbl&gt; &lt;chr&gt; 
##  1         4 UA          5 LGA   
##  2        -6 DL          6 LGA   
##  3        -3 EV          6 LGA   
##  4        -2 AA          6 LGA   
##  5        -1 AA          6 LGA   
##  6         0 B6          6 LGA   
##  7         0 MQ          6 LGA   
##  8        -8 DL          6 LGA   
##  9        -3 MQ          6 LGA   
## 10        13 AA          6 LGA   
## # … with 104,652 more rows</code></pre>
<p>Filter out all the rows where the
departure delay is missing and then create a new column called
<code>late_dep</code> that is true if the flight left 15 minutes or more late and false otherwise.</p>
<div class="sourceCode" id="cb893"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb893-1" title="1">flights &lt;-<span class="st"> </span>flights <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb893-2" title="2"><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(dep_delay)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb893-3" title="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">late_dep =</span> dep_delay <span class="op">&gt;</span><span class="st"> </span><span class="dv">15</span>)</a>
<a class="sourceLine" id="cb893-4" title="4"></a>
<a class="sourceLine" id="cb893-5" title="5">flights</a></code></pre></div>
<pre><code>## # A tibble: 101,509 x 5
##    dep_delay carrier  hour origin late_dep
##        &lt;dbl&gt; &lt;chr&gt;   &lt;dbl&gt; &lt;chr&gt;  &lt;lgl&gt;   
##  1         4 UA          5 LGA    FALSE   
##  2        -6 DL          6 LGA    FALSE   
##  3        -3 EV          6 LGA    FALSE   
##  4        -2 AA          6 LGA    FALSE   
##  5        -1 AA          6 LGA    FALSE   
##  6         0 B6          6 LGA    FALSE   
##  7         0 MQ          6 LGA    FALSE   
##  8        -8 DL          6 LGA    FALSE   
##  9        -3 MQ          6 LGA    FALSE   
## 10        13 AA          6 LGA    FALSE   
## # … with 101,499 more rows</code></pre>
<p>What proportion of all flights leaving from LaGuardia leave 15 minutes late or later? To
check this, remember that <code>TRUE</code> is saved as a “1” and <code>FALSE</code> is saved as a “0”. That means that
we can take the mean of a logical vector to get the proportion of trials that are true.</p>
<div class="sourceCode" id="cb895"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb895-1" title="1">flights <span class="op">%&gt;%</span><span class="st"> </span>purrr<span class="op">::</span><span class="kw">pluck</span>(<span class="st">&quot;late_dep&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mean</span>()</a></code></pre></div>
<pre><code>## [1] 0.1889685</code></pre>
<p>Determine what proportion of all flights are delayed base on the hour that the
flight was scheduled to depart (<code>hour</code>). Create a plot showing how the probability of
leaving 15 minutes or more late changes by hour.</p>
<div class="sourceCode" id="cb897"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb897-1" title="1">flights_late &lt;-<span class="st"> </span>flights <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb897-2" title="2"><span class="st">  </span><span class="kw">group_by</span>(hour) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb897-3" title="3"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">prob_late =</span> <span class="kw">mean</span>(late_dep))</a>
<a class="sourceLine" id="cb897-4" title="4"></a>
<a class="sourceLine" id="cb897-5" title="5">flights_late</a></code></pre></div>
<pre><code>## # A tibble: 18 x 2
##     hour prob_late
##    &lt;dbl&gt;     &lt;dbl&gt;
##  1     5    0.0588
##  2     6    0.0519
##  3     7    0.0570
##  4     8    0.0967
##  5     9    0.105 
##  6    10    0.128 
##  7    11    0.159 
##  8    12    0.163 
##  9    13    0.200 
## 10    14    0.207 
## 11    15    0.236 
## 12    16    0.273 
## 13    17    0.292 
## 14    18    0.298 
## 15    19    0.314 
## 16    20    0.331 
## 17    21    0.309 
## 18    22    0.391</code></pre>
<div class="sourceCode" id="cb899"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb899-1" title="1">flights_late <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb899-2" title="2"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> hour, <span class="dt">y =</span> prob_late)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb899-3" title="3"><span class="st">  </span><span class="kw">geom_line</span>()</a></code></pre></div>
<p><img src="RProgrammingForResearch_files/figure-html/unnamed-chunk-500-1.png" width="672" /></p>
<p>Fit a generalized linear model for the association between the binary variable of whether
the flight was 15 minutes or more late (<code>late_dep</code>) and the hour the flight was
scheduled to leave (<code>hour</code>). Use a binomial model (add <code>family = binomial(link = "logit")</code>
in the <code>glm</code> call). The estimate from the model for <code>hour</code> will be an estimate
of the log odds ratio for a one-hour increase in scheduled departure time. Take the
exponent of this estimate with <code>exp</code> to get an estimated odds ratio for a one-hour
increase in scheduled departure time. Is this estimate larger than 1.0?</p>
<div class="sourceCode" id="cb900"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb900-1" title="1"><span class="kw">glm</span>(late_dep <span class="op">~</span><span class="st"> </span>hour, <span class="dt">data =</span> flights, <span class="dt">family =</span> <span class="kw">binomial</span>(<span class="dt">link =</span> <span class="st">&quot;logit&quot;</span>)) </a></code></pre></div>
<pre><code>## 
## Call:  glm(formula = late_dep ~ hour, family = binomial(link = &quot;logit&quot;), 
##     data = flights)
## 
## Coefficients:
## (Intercept)         hour  
##     -3.3643       0.1399  
## 
## Degrees of Freedom: 101508 Total (i.e. Null);  101507 Residual
## Null Deviance:       98410 
## Residual Deviance: 92810     AIC: 92810</code></pre>
<div class="sourceCode" id="cb902"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb902-1" title="1"><span class="kw">library</span>(broom)</a>
<a class="sourceLine" id="cb902-2" title="2"><span class="kw">glm</span>(late_dep <span class="op">~</span><span class="st"> </span>hour, <span class="dt">data =</span> flights, <span class="dt">family =</span> <span class="kw">binomial</span>(<span class="dt">link =</span> <span class="st">&quot;logit&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb902-3" title="3"><span class="st">  </span><span class="kw">tidy</span>() <span class="op">%&gt;%</span><span class="st">                 </span><span class="co"># Tidy the model results</span></a>
<a class="sourceLine" id="cb902-4" title="4"><span class="st">  </span><span class="kw">filter</span>(term <span class="op">==</span><span class="st"> &quot;hour&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># Only look at the estimate for `hour`</span></a>
<a class="sourceLine" id="cb902-5" title="5"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">or =</span> <span class="kw">exp</span>(estimate)) <span class="co"># Estimate is log odds ratio. Take exponent for odds ratio</span></a></code></pre></div>
<pre><code>## # A tibble: 1 x 6
##   term  estimate std.error statistic p.value    or
##   &lt;chr&gt;    &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;
## 1 hour     0.140   0.00195      71.7       0  1.15</code></pre>
<p>Next, we want to see if this association is similar across airlines. First, create a
dataframe called <code>nested_flights</code> where the <code>flights</code>
data is grouped by airline (<code>carrier</code>) and then nest the data, so that there is a “data” list-column
where each item is a dataframe of flight delay data for a specific carrier:</p>
<div class="sourceCode" id="cb904"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb904-1" title="1">nested_flights &lt;-<span class="st"> </span>flights <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb904-2" title="2"><span class="st">  </span><span class="kw">group_by</span>(carrier) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb904-3" title="3"><span class="st">  </span><span class="kw">nest</span>()</a>
<a class="sourceLine" id="cb904-4" title="4"></a>
<a class="sourceLine" id="cb904-5" title="5">nested_flights</a></code></pre></div>
<pre><code>## # A tibble: 13 x 2
## # Groups:   carrier [13]
##    carrier           data
##    &lt;chr&gt;   &lt;list&lt;df[,4]&gt;&gt;
##  1 UA         [7,837 × 4]
##  2 DL        [22,857 × 4]
##  3 EV         [8,255 × 4]
##  4 AA        [15,063 × 4]
##  5 B6         [5,925 × 4]
##  6 MQ        [16,189 × 4]
##  7 WN         [6,000 × 4]
##  8 FL         [3,187 × 4]
##  9 US        [12,574 × 4]
## 10 F9           [682 × 4]
## 11 9E         [2,372 × 4]
## 12 YV           [545 × 4]
## 13 OO            [23 × 4]</code></pre>
<p>To check the contents of the list-column, try:</p>
<div class="sourceCode" id="cb906"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb906-1" title="1">nested_flights<span class="op">$</span>data[[<span class="dv">1</span>]] <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># Get the first element of the &quot;data&quot; column</span></a>
<a class="sourceLine" id="cb906-2" title="2"><span class="st">  </span><span class="kw">head</span>()</a></code></pre></div>
<pre><code>## # A tibble: 6 x 4
##   dep_delay  hour origin late_dep
##       &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;  &lt;lgl&gt;   
## 1         4     5 LGA    FALSE   
## 2        -4     6 LGA    FALSE   
## 3         1     6 LGA    FALSE   
## 4         9     7 LGA    FALSE   
## 5        -4     7 LGA    FALSE   
## 6         2     7 LGA    FALSE</code></pre>
<p>Use the <code>map</code> function from <code>purrr</code> inside a <code>mutate</code> statement to apply the <code>glm</code> code you used earlier for the
whole dataset, but in this case for the data for each airline character:</p>
<div class="sourceCode" id="cb908"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb908-1" title="1"><span class="kw">library</span>(purrr)</a>
<a class="sourceLine" id="cb908-2" title="2"><span class="kw">library</span>(tidyr)</a>
<a class="sourceLine" id="cb908-3" title="3"></a>
<a class="sourceLine" id="cb908-4" title="4">prob_late &lt;-<span class="st"> </span>nested_flights <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb908-5" title="5"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">glm_result =</span> purrr<span class="op">::</span><span class="kw">map</span>(data, <span class="op">~</span><span class="st"> </span><span class="kw">glm</span>(late_dep <span class="op">~</span><span class="st"> </span>hour, </a>
<a class="sourceLine" id="cb908-6" title="6">                                      <span class="dt">data =</span> .x, <span class="dt">family =</span> <span class="kw">binomial</span>(<span class="dt">link =</span> <span class="st">&quot;logit&quot;</span>)))) </a>
<a class="sourceLine" id="cb908-7" title="7"></a>
<a class="sourceLine" id="cb908-8" title="8"><span class="co"># Check the results for the first element of the &quot;glm_result&quot; column: </span></a>
<a class="sourceLine" id="cb908-9" title="9">prob_late<span class="op">$</span>glm_result[[<span class="dv">1</span>]]</a></code></pre></div>
<pre><code>## 
## Call:  glm(formula = late_dep ~ hour, family = binomial(link = &quot;logit&quot;), 
##     data = .x)
## 
## Coefficients:
## (Intercept)         hour  
##     -3.4305       0.1551  
## 
## Degrees of Freedom: 7836 Total (i.e. Null);  7835 Residual
## Null Deviance:       7601 
## Residual Deviance: 7064  AIC: 7068</code></pre>
<p>Then use the <code>map</code>
function inside a <code>mutate</code> statement again to “tidy” the data.</p>
<div class="sourceCode" id="cb910"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb910-1" title="1">prob_late &lt;-<span class="st"> </span>prob_late <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb910-2" title="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">glm_tidy =</span> purrr<span class="op">::</span><span class="kw">map</span>(glm_result, <span class="op">~</span><span class="st"> </span><span class="kw">tidy</span>(.x)))</a></code></pre></div>
<p>Remove the columns for <code>data</code> and
<code>glm_result</code>:</p>
<div class="sourceCode" id="cb911"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb911-1" title="1">prob_late &lt;-<span class="st"> </span>prob_late <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb911-2" title="2"><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>data, <span class="op">-</span>glm_result)</a></code></pre></div>
<p>Then `<code>unnest</code> the dataframe list-column with the tidy version of the model
results:</p>
<div class="sourceCode" id="cb912"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb912-1" title="1">prob_late &lt;-<span class="st"> </span>prob_late <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb912-2" title="2"><span class="st">  </span><span class="kw">unnest</span>(glm_tidy)</a></code></pre></div>
<p>Filter to get only the estimates for the “hour” term:</p>
<div class="sourceCode" id="cb913"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb913-1" title="1">prob_late &lt;-<span class="st"> </span>prob_late <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb913-2" title="2"><span class="st">  </span><span class="kw">filter</span>(term <span class="op">==</span><span class="st"> &quot;hour&quot;</span>)</a></code></pre></div>
<p>Then calculate an odds ratio
(<code>or</code>) by taking the exponent (check the <code>exp</code> function) of the original estimate.</p>
<div class="sourceCode" id="cb914"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb914-1" title="1">prob_late &lt;-<span class="st"> </span>prob_late <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb914-2" title="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">or =</span> <span class="kw">exp</span>(estimate))</a>
<a class="sourceLine" id="cb914-3" title="3"><span class="kw">head</span>(prob_late)</a></code></pre></div>
<pre><code>## # A tibble: 6 x 7
## # Groups:   carrier [6]
##   carrier term  estimate std.error statistic   p.value    or
##   &lt;chr&gt;   &lt;chr&gt;    &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt;
## 1 UA      hour    0.155    0.00705      22.0 2.88e-107  1.17
## 2 DL      hour    0.148    0.00454      32.6 1.80e-232  1.16
## 3 EV      hour    0.0952   0.00572      16.7 2.79e- 62  1.10
## 4 AA      hour    0.146    0.00580      25.2 1.05e-139  1.16
## 5 B6      hour    0.168    0.00702      23.9 7.13e-126  1.18
## 6 MQ      hour    0.110    0.00468      23.5 2.23e-122  1.12</code></pre>
<p>The package has a dataframe with the full name of each carrier (<code>airlines</code>). Join this data
into the data you’ve been working with, so you have the full names of airlines:</p>
<div class="sourceCode" id="cb916"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb916-1" title="1">prob_late &lt;-<span class="st"> </span><span class="kw">left_join</span>(prob_late, airlines, <span class="dt">by =</span> <span class="st">&quot;carrier&quot;</span>)</a></code></pre></div>
<p>Finally, create the following plot with each airline’s association between hour in the
day and the chance of a delay:</p>
<div class="sourceCode" id="cb917"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb917-1" title="1"><span class="kw">library</span>(forcats)</a>
<a class="sourceLine" id="cb917-2" title="2"><span class="kw">data</span>(airlines)</a>
<a class="sourceLine" id="cb917-3" title="3">prob_late <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb917-4" title="4"><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb917-5" title="5"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">estimate =</span> <span class="kw">exp</span>(estimate)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb917-6" title="6"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">name =</span> <span class="kw">fct_reorder</span>(name, estimate)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb917-7" title="7"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> estimate, <span class="dt">y =</span> name)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb917-8" title="8"><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb917-9" title="9"><span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> <span class="dv">1</span>, <span class="dt">linetype =</span> <span class="dv">3</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb917-10" title="10"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Odds ratio for one-hour increase in scheduled deparature time&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;&quot;</span>)</a></code></pre></div>
<p><img src="RProgrammingForResearch_files/figure-html/unnamed-chunk-511-1.png" width="672" /></p>
</div>
</div>
<div id="writing-functions" class="section level3">
<h3><span class="header-section-number">7.8.7</span> Writing functions</h3>
<ul>
<li>Say that you have a four-letter character string (e.g., “ling”) and that you want
to move the last letter to the front of the string to create a new four-letter
character string (e.g., “glin”). Write some R code to do this.</li>
<li>Next, write a function named <code>move_letter</code> that does the same thing—takes a four-letter character string
(e.g., “ling”) and creates a new four-letter character string where the last
letter in the original string has been moved to the front of the string (e.g.,
“glin”). It should input one parameter (<code>word</code>, the original four-letter character
string or a vector of four-letter character strings).</li>
<li>Read the word list at <a href="https://raw.githubusercontent.com/dwyl/english-words/master/words.txt" class="uri">https://raw.githubusercontent.com/dwyl/english-words/master/words.txt</a>
into an R dataframe called <code>word_list</code>. It will only have one column; name this column
<code>word</code>.</li>
<li>Write code that can take a vector of character strings (e.g., <code>c('ling', 'scat', 'soil')</code>)
and return a logical vector that says whether that character string is a word in the
<code>word_list</code> dataframe you created in the last step (e.g., <code>c('FALSE', 'TRUE', 'TRUE')</code> for
a vector where the first value isn’t a word but the second and third are). You may find
the <code>pluck</code> function in the <code>purrr</code> package useful in writing this code (to pull the
<code>word</code> column out of the <code>word_list</code> dataframe).</li>
<li>Write a function called <code>is_word</code> that inputs (1) a vector of character strings
and (2) a dataframe with a column called “word” that lists real words. The
function should return a logical vector saying whether each character string is
a real word. The function should have two arguments: <code>words_to_check</code>, which is
a vector of character strings (e.g., <code>c('ling', 'scat', 'soil')</code>), and <code>real_word_list</code>, which is a dataframe with a
column called <code>words</code> of real English words (e.g., the <code>word_list</code> dataframe you created from the word list on GitHub). Set the <code>real_word_list</code> argument
to have the default value of <code>words</code>, the dataframe you created earlier in this
exercise by reading in the dataframe of English words from GitHub.</li>
<li>Try using the function with a different word list. As an example, you could read in
and use the word list of Google’s top 10,000 English words from <a href="https://raw.githubusercontent.com/first20hours/google-10000-english/master/google-10000-english-no-swears.txt" class="uri">https://raw.githubusercontent.com/first20hours/google-10000-english/master/google-10000-english-no-swears.txt</a>.</li>
<li>Try using these functions to solve the word puzzle problem in the last homework.</li>
</ul>
<hr />
<div id="example-r-code-19" class="section level4">
<h4><span class="header-section-number">7.8.7.1</span> Example R code</h4>
<p>Say that you have a four-letter character string (e.g., “ling”) and that you want
to move the last letter to the front of the string to create a new four-letter
character string (e.g., “glin”). You can use functions from the
<code>stringr</code> package to help with this.</p>
<div class="sourceCode" id="cb918"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb918-1" title="1"><span class="kw">library</span>(stringr)</a>
<a class="sourceLine" id="cb918-2" title="2"></a>
<a class="sourceLine" id="cb918-3" title="3"><span class="co"># Start with an example word. You can use the example word from </span></a>
<a class="sourceLine" id="cb918-4" title="4"><span class="co"># the problem statement (&#39;ling&#39;).</span></a>
<a class="sourceLine" id="cb918-5" title="5">word &lt;-<span class="st"> &quot;ling&quot;</span></a>
<a class="sourceLine" id="cb918-6" title="6"></a>
<a class="sourceLine" id="cb918-7" title="7"><span class="co"># Break the word into two parts</span></a>
<a class="sourceLine" id="cb918-8" title="8">first_three_letters &lt;-<span class="st"> </span><span class="kw">str_sub</span>(word, <span class="dv">1</span>, <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb918-9" title="9">last_letter &lt;-<span class="st"> </span><span class="kw">str_sub</span>(word, <span class="dv">4</span>, <span class="dv">4</span>)</a>
<a class="sourceLine" id="cb918-10" title="10"></a>
<a class="sourceLine" id="cb918-11" title="11">first_three_letters</a></code></pre></div>
<pre><code>## [1] &quot;lin&quot;</code></pre>
<div class="sourceCode" id="cb920"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb920-1" title="1">last_letter</a></code></pre></div>
<pre><code>## [1] &quot;g&quot;</code></pre>
<div class="sourceCode" id="cb922"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb922-1" title="1"><span class="co"># Put the parts back together in the right order</span></a>
<a class="sourceLine" id="cb922-2" title="2">new_word &lt;-<span class="st"> </span><span class="kw">str_c</span>(last_letter, first_three_letters) <span class="co"># You could also use `paste` or `paste0` here</span></a>
<a class="sourceLine" id="cb922-3" title="3">new_word</a></code></pre></div>
<pre><code>## [1] &quot;glin&quot;</code></pre>
<p>Write a function named <code>move_letter</code> that takes a four-letter character string
(e.g., “ling”) and creates a new four-letter character string where the last
letter in the original string has been moved to the front of the string (e.g.,
“glin”). It should input one parameter (<code>word</code>, the original four-letter character
string or a vector of four-letter character strings).</p>
<p>To do this, take the code that you just wrote and put it inside a function named
<code>move_letter</code>:</p>
<div class="sourceCode" id="cb924"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb924-1" title="1">move_letter &lt;-<span class="st"> </span><span class="cf">function</span>(word){</a>
<a class="sourceLine" id="cb924-2" title="2">  <span class="co"># Break the word into two parts</span></a>
<a class="sourceLine" id="cb924-3" title="3">  first_three_letters &lt;-<span class="st"> </span><span class="kw">str_sub</span>(word, <span class="dv">1</span>, <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb924-4" title="4">  last_letter &lt;-<span class="st"> </span><span class="kw">str_sub</span>(word, <span class="dv">4</span>, <span class="dv">4</span>)</a>
<a class="sourceLine" id="cb924-5" title="5">  </a>
<a class="sourceLine" id="cb924-6" title="6">  <span class="co"># Put the parts back together in the right order</span></a>
<a class="sourceLine" id="cb924-7" title="7">  <span class="kw">str_c</span>(last_letter, first_three_letters)</a>
<a class="sourceLine" id="cb924-8" title="8">}</a>
<a class="sourceLine" id="cb924-9" title="9"></a>
<a class="sourceLine" id="cb924-10" title="10"><span class="co"># Check the function</span></a>
<a class="sourceLine" id="cb924-11" title="11"><span class="kw">move_letter</span>(<span class="dt">word =</span> <span class="st">&quot;ling&quot;</span>)</a></code></pre></div>
<pre><code>## [1] &quot;glin&quot;</code></pre>
<div class="sourceCode" id="cb926"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb926-1" title="1"><span class="co"># Try with some other four-letter strings</span></a>
<a class="sourceLine" id="cb926-2" title="2"><span class="kw">move_letter</span>(<span class="dt">word =</span> <span class="st">&quot;cats&quot;</span>)</a></code></pre></div>
<pre><code>## [1] &quot;scat&quot;</code></pre>
<div class="sourceCode" id="cb928"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb928-1" title="1"><span class="kw">move_letter</span>(<span class="dt">word =</span> <span class="st">&quot;oils&quot;</span>)</a></code></pre></div>
<pre><code>## [1] &quot;soil&quot;</code></pre>
<div class="sourceCode" id="cb930"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb930-1" title="1"><span class="co"># Check using with a vector of four-letter character strings</span></a>
<a class="sourceLine" id="cb930-2" title="2"><span class="kw">move_letter</span>(<span class="kw">c</span>(<span class="st">&quot;cats&quot;</span>, <span class="st">&quot;oils&quot;</span>))</a></code></pre></div>
<pre><code>## [1] &quot;scat&quot; &quot;soil&quot;</code></pre>
<p>Notice that now <code>word</code> is being used as an argument in the function. It’s as if you
assigned the string or vector of strings that you want to convert to the object
name <code>word</code>, and then you run all the code. The output of the function is the
last expression in the function code (<code>str_c(last_letter, first_three_letters)</code>).
Also, note that you can add comments inside the function with <code>#</code>, just like you can
with other R code.</p>
<p>Read the word list at <a href="https://raw.githubusercontent.com/dwyl/english-words/master/words.txt" class="uri">https://raw.githubusercontent.com/dwyl/english-words/master/words.txt</a>
into an R dataframe called <code>words</code>. It will only have one column; name this column
<code>word_list</code>.</p>
<div class="sourceCode" id="cb932"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb932-1" title="1"><span class="kw">library</span>(readr)</a>
<a class="sourceLine" id="cb932-2" title="2"></a>
<a class="sourceLine" id="cb932-3" title="3">word_list &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;https://raw.githubusercontent.com/dwyl/english-words/master/words.txt&quot;</span>,</a>
<a class="sourceLine" id="cb932-4" title="4">                  <span class="dt">col_names =</span> <span class="st">&quot;word&quot;</span>)</a></code></pre></div>
<pre><code>## Parsed with column specification:
## cols(
##   word = col_character()
## )</code></pre>
<pre><code>## Warning: 2 parsing failures.
## row col  expected    actual                                                                    file
##  11  -- 1 columns 3 columns &#39;https://raw.githubusercontent.com/dwyl/english-words/master/words.txt&#39;
##  12  -- 1 columns 2 columns &#39;https://raw.githubusercontent.com/dwyl/english-words/master/words.txt&#39;</code></pre>
<p>Write code that can take a vector of character strings (e.g., <code>c('ling', 'scat', 'soil')</code>)
and return a logical vector that says whether that character string is a word in the
<code>word_list</code> dataframe you created in the last step (e.g., <code>c('TRUE', 'FALSE', 'TRUE')</code> for
a vector where the second value isn’t a word but the first and third are).</p>
<div class="sourceCode" id="cb935"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb935-1" title="1"><span class="kw">library</span>(purrr)</a>
<a class="sourceLine" id="cb935-2" title="2"></a>
<a class="sourceLine" id="cb935-3" title="3">words_to_check &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;ling&quot;</span>, <span class="st">&quot;scat&quot;</span>, <span class="st">&quot;soil&quot;</span>)</a>
<a class="sourceLine" id="cb935-4" title="4">words_to_check <span class="op">%in%</span><span class="st"> </span><span class="kw">pluck</span>(word_list, <span class="st">&quot;word&quot;</span>)</a></code></pre></div>
<pre><code>## [1]  TRUE FALSE  TRUE</code></pre>
<p>This code works because you can use <code>pluck</code> to extract a column (as a vector) from
a dataframe, and then you can use the <code>%in%</code> operator to see if each value in one vector
(the <code>words_to_check</code> vector in this example) is one of the values in the second
vector (the <code>word</code> column from the <code>words</code> dataframe in this example).</p>
<p>Write a function called <code>is_word</code> that inputs (1) a vector of character strings
and (2) a dataframe with a column called “word” that lists real words. The
function should return a logical vector saying whether each character string is
a real word. The function should have two arguments: <code>words_to_check</code>, which is
a vector of character strings and <code>real_word_list</code> which is a dataframe with a
column called <code>words</code> of real English words. Set the <code>real_word_list</code> argument
to have the default value of <code>words</code>, the dataframe you created earlier in this
exercise by reading in the dataframe of English words from GitHub.</p>
<div class="sourceCode" id="cb937"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb937-1" title="1"><span class="co"># Put the code you wrote inside a function</span></a>
<a class="sourceLine" id="cb937-2" title="2">is_word &lt;-<span class="st"> </span><span class="cf">function</span>(words_to_check, <span class="dt">real_word_list =</span> word_list){</a>
<a class="sourceLine" id="cb937-3" title="3">  words_to_check <span class="op">%in%</span><span class="st"> </span><span class="kw">pluck</span>(real_word_list, <span class="st">&quot;word&quot;</span>)</a>
<a class="sourceLine" id="cb937-4" title="4">}</a>
<a class="sourceLine" id="cb937-5" title="5"></a>
<a class="sourceLine" id="cb937-6" title="6"><span class="co"># Check the function</span></a>
<a class="sourceLine" id="cb937-7" title="7"><span class="kw">is_word</span>(<span class="dt">words_to_check =</span> <span class="kw">c</span>(<span class="st">&quot;ling&quot;</span>, <span class="st">&quot;scat&quot;</span>, <span class="st">&quot;soil&quot;</span>))</a></code></pre></div>
<pre><code>## [1]  TRUE FALSE  TRUE</code></pre>
<p>Note that, if you want to use the <code>word_list</code> dataframe for your real word list, you
don’t have to specify that when you call the <code>is_word</code> function, since you
set that as your default value.</p>
<p>If you wanted to use a different word list, you can specify a different value for
the <code>real_word_list</code> argument when you run the function. For example, to use Google’s
top 10,000 English word list from GitHub instead, use:</p>
<div class="sourceCode" id="cb939"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb939-1" title="1">google_words &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;https://raw.githubusercontent.com/first20hours/google-10000-english/master/google-10000-english-no-swears.txt&quot;</span>, </a>
<a class="sourceLine" id="cb939-2" title="2">                         <span class="dt">col_names =</span> <span class="st">&quot;word&quot;</span>)</a></code></pre></div>
<pre><code>## Parsed with column specification:
## cols(
##   word = col_character()
## )</code></pre>
<div class="sourceCode" id="cb941"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb941-1" title="1"><span class="kw">is_word</span>(<span class="dt">words_to_check =</span> <span class="kw">c</span>(<span class="st">&quot;ling&quot;</span>, <span class="st">&quot;scat&quot;</span>, <span class="st">&quot;soil&quot;</span>), <span class="dt">real_word_list =</span> google_words)</a></code></pre></div>
<pre><code>## [1] FALSE FALSE  TRUE</code></pre>
<p>In this case, there was a rarer word (“ling”) that counted as a word when the original
word list was used, but not when the Google top-10,000 words list was used.</p>
<p>Try using these functions to solve the word puzzle problem in the last homework.</p>
<div class="sourceCode" id="cb943"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb943-1" title="1">word_list <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb943-2" title="2"><span class="st">  </span><span class="kw">filter</span>(<span class="kw">str_detect</span>(word, <span class="st">&quot;^m.{7}$&quot;</span>)) <span class="op">%&gt;%</span><span class="st">                        </span><span class="co"># This is using regular expressions</span></a>
<a class="sourceLine" id="cb943-3" title="3"><span class="st">  </span><span class="kw">separate</span>(word, <span class="dt">into =</span> <span class="kw">c</span>(<span class="st">&quot;first_word&quot;</span>, <span class="st">&quot;second_word&quot;</span>),          <span class="co"># Note that you can use `separate` with a number to use position</span></a>
<a class="sourceLine" id="cb943-4" title="4">           <span class="dt">sep =</span> <span class="dv">4</span>, <span class="dt">remove =</span> <span class="ot">FALSE</span>) <span class="op">%&gt;%</span><span class="st">                          </span></a>
<a class="sourceLine" id="cb943-5" title="5"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">second_word =</span> <span class="kw">move_letter</span>(second_word)) <span class="op">%&gt;%</span><span class="st">             </span><span class="co"># Use the first function here</span></a>
<a class="sourceLine" id="cb943-6" title="6"><span class="st">  </span><span class="kw">filter</span>(<span class="kw">is_word</span>(first_word) <span class="op">&amp;</span><span class="st"> </span><span class="kw">is_word</span>(second_word)) <span class="op">%&gt;%</span><span class="st">         </span><span class="co"># Use the second function here</span></a>
<a class="sourceLine" id="cb943-7" title="7"><span class="st">  </span><span class="kw">unite</span>(<span class="st">&quot;new_word&quot;</span>, <span class="kw">c</span>(<span class="st">&quot;first_word&quot;</span>, <span class="st">&quot;second_word&quot;</span>), <span class="dt">sep =</span> <span class="st">&quot; &quot;</span>)   <span class="co"># You can use `unite` to put the two new words in a phrase in one column.</span></a></code></pre></div>
<pre><code>## # A tibble: 103 x 2
##    word     new_word 
##    &lt;chr&gt;    &lt;chr&gt;    
##  1 mailings mail sing
##  2 maillots mail slot
##  3 majorate majo erat
##  4 majoring majo grin
##  5 malmiest malm ties
##  6 maltiest malt ties
##  7 mandalas mand sala
##  8 mandated mand date
##  9 mandates mand sate
## 10 mangiest mang ties
## # … with 93 more rows</code></pre>
<p>You can get the choices down to even fewer options if you match the new words against
the Google top-10,000 words list, by using the <code>real_word_list</code> option in the <code>is_word</code>
function you wrote. (However, “maillots” is not a common enough word that you can
also start from that shorter word list!)</p>
<div class="sourceCode" id="cb945"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb945-1" title="1">word_list <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb945-2" title="2"><span class="st">  </span><span class="kw">filter</span>(<span class="kw">str_detect</span>(word, <span class="st">&quot;^m.{7}$&quot;</span>)) <span class="op">%&gt;%</span><span class="st">                        </span></a>
<a class="sourceLine" id="cb945-3" title="3"><span class="st">  </span><span class="kw">separate</span>(word, <span class="dt">into =</span> <span class="kw">c</span>(<span class="st">&quot;first_word&quot;</span>, <span class="st">&quot;second_word&quot;</span>),          </a>
<a class="sourceLine" id="cb945-4" title="4">           <span class="dt">sep =</span> <span class="dv">4</span>, <span class="dt">remove =</span> <span class="ot">FALSE</span>) <span class="op">%&gt;%</span><span class="st">                          </span></a>
<a class="sourceLine" id="cb945-5" title="5"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">second_word =</span> <span class="kw">move_letter</span>(second_word)) <span class="op">%&gt;%</span><span class="st">             </span></a>
<a class="sourceLine" id="cb945-6" title="6"><span class="st">  </span><span class="kw">filter</span>(<span class="kw">is_word</span>(first_word, <span class="dt">real_word_list =</span> google_words) <span class="op">&amp;</span><span class="st"> </span></a>
<a class="sourceLine" id="cb945-7" title="7"><span class="st">           </span><span class="kw">is_word</span>(second_word, <span class="dt">real_word_list =</span> google_words)) <span class="op">%&gt;%</span><span class="st">         </span></a>
<a class="sourceLine" id="cb945-8" title="8"><span class="st">  </span><span class="kw">unite</span>(<span class="st">&quot;new_word&quot;</span>, <span class="kw">c</span>(<span class="st">&quot;first_word&quot;</span>, <span class="st">&quot;second_word&quot;</span>), <span class="dt">sep =</span> <span class="st">&quot; &quot;</span>)  </a></code></pre></div>
<pre><code>## # A tibble: 43 x 2
##    word     new_word 
##    &lt;chr&gt;    &lt;chr&gt;    
##  1 mailings mail sing
##  2 maillots mail slot
##  3 maintops main stop
##  4 markings mark sing
##  5 maskings mask sing
##  6 massager mass rage
##  7 massages mass sage
##  8 massiest mass ties
##  9 mattings matt sing
## 10 mealiest meal ties
## # … with 33 more rows</code></pre>
<!-- ### Using a function and `purrr` to create state-specific plots -->
<!-- Next, you will write a function to create state-specific plots from this data, then use it to create plots for the states of Colorado, Texas, California, and New York.  -->
<!-- - The FARS data includes a column called `STATE`, but it gives state as a one- or two-digit code, rather than by name. These codes are the state Federal Information Processing Standard (FIPS) codes. A dataset with state names and FIPS codes is available at http://www2.census.gov/geo/docs/reference/state.txt. Read that data into an R object called `state_fips` and clean it so the first few lines look like this (hint: to change the `state` column to an integer class, you can use the function `as.integer`): -->
<!-- ```{r check11, echo = FALSE, warning = FALSE, message = FALSE} -->
<!-- state_fips <- read_delim("http://www2.census.gov/geo/docs/reference/state.txt", -->
<!--                          delim = "|") %>% -->
<!--   rename(state = STATE, -->
<!--          state_name = STATE_NAME) %>% -->
<!--   select(state, state_name) %>% -->
<!--   mutate(state = as.integer(state)) -->
<!-- state_fips %>% slice(1:5) -->
<!-- ``` -->
<!-- - Read the 2015 FARS data into an R object named `accident`. Use all the date and time information to create a column named `date` with the date and time of the accident. Include information on whether the accident was related to drunk driving (FALSE if there were 0 drunk drivers, TRUE if there were one or more), and create columns that gives whether the accident was during the day (7 AM to 7 PM) or not as well as the month of the accident (for this last column, you can either retain it from the original data or recalculate it based on the new `date` variable). Filter out any values where the date-time does not render (i.e., `date` is a missing value). The first few rows of the cleaned data frame should look like this: -->
<!-- ```{r check10, warning = FALSE, message = FALSE, echo = FALSE} -->
<!-- accident <- read_csv("data/accident.csv") %>% -->
<!--   select(STATE, DAY:MINUTE, DRUNK_DR) %>% -->
<!--   rename(state = STATE,  -->
<!--          drunk_dr = DRUNK_DR) %>% -->
<!--   select(-DAY_WEEK) %>% -->
<!--   unite(date, DAY:MINUTE, sep = "-") %>% -->
<!--   mutate(date = dmy_hm(date),  -->
<!--          drunk_dr = drunk_dr >= 1, -->
<!--          daytime = hour(date) %in% c(7:19), -->
<!--          month = month(date)) %>% -->
<!--   filter(!is.na(date)) -->
<!-- accident %>% slice(1:5) -->
<!-- ``` -->
<!-- - Join the information from `state_fips` into the `accident` data frame. There may be a few locations in the `state_fips` data frame that are not included in the `accident` data frame (e.g., Virgin Islands), so when you join keep all observations in `accident` but only the observations in `state_fips` that match at least one row of `accident`. The first few rows of the joined dataset should look like this: -->
<!-- ```{r echo = FALSE} -->
<!-- accident <- accident %>% -->
<!--   left_join(state_fips, by = "state") -->
<!-- accident %>% slice(1:5) -->
<!-- ``` -->
<!-- - Summarize the data to get the total number of accidents in Colorado in each month, separated by (1) daytime and nighttime and (2) related or unrelated to drunk driving  (in other words, in January, how many daytime accidents were there that were unrelated to drunk driving? How many nighttime accidents that were unrelated to drunk driving? etc.). The summarized data should look like this: -->
<!-- ```{r echo = FALSE} -->
<!-- accident %>% -->
<!--   filter(state_name == "Colorado") %>% -->
<!--   group_by(daytime, month, drunk_dr) %>% -->
<!--   summarize(accidents = n()) -->
<!-- ``` -->
<!-- - Write a function that inputs a data frame (`df`) and outputs this type of summary data frame (like the one just created for Colorado) for whatever data is in the input data frame. Below are some examples of how this function should work: -->
<!-- ```{r echo = FALSE} -->
<!-- summarize_fars <- function(df){ -->
<!--   df %>% -->
<!--     group_by(daytime, month, drunk_dr) %>% -->
<!--     summarize(accidents = n()) -->
<!-- } -->
<!-- ``` -->
<!-- ```{r} -->
<!-- colorado_data <- accident %>%  -->
<!--   filter(state_name == "Colorado") -->
<!-- colorado_summary <- summarize_fars(df = colorado_data) -->
<!-- head(colorado_summary) -->
<!-- # Note also that you can pipe with the new function: -->
<!-- accident %>%  -->
<!--   filter(state_name == "Texas") %>%  -->
<!--   summarize_fars() %>%  -->
<!--   tbl_df() %>%  -->
<!--   slice(1:3) -->
<!-- ``` -->
<!-- - Once you've written the function, see if you can figure out what the following code does. How does the new function fit in? (Note: We could have achieved the same thing with basic `dplyr` code, but this framework will allow you to ultimately do a lot more than you can with `dplyr`.) -->
<!-- ```{r eval = FALSE} -->
<!-- library(purrr) -->
<!-- accident %>%  -->
<!--   filter(state_name %in% c("Colorado", "Texas", "California", "New York")) %>%  -->
<!--   group_by(state_name) %>% -->
<!--   nest() %>%  -->
<!--   mutate(summary = map(data, summarize_fars)) %>%  -->
<!--   select(-data) %>%  -->
<!--   unnest()  -->
<!-- ``` -->
<!-- - Write code to create boxplots for Colorado of the distribution of total accidents within each month. Create separate boxplots for daytime and nighttime accidents, and facet by whether the accident was related to drunk driving. The plot should look like the plot below.  -->
<!-- ```{r check9, echo = FALSE, fig.width = 6, fig.height = 3, fig.align = "center"} -->
<!-- accident %>% -->
<!--   filter(state_name == "Colorado") %>% -->
<!--   mutate(drunk_dr = factor(drunk_dr, labels = c("Unrelated to\ndrunk driving", -->
<!--                                                 "Related to\ndrunk driving")), -->
<!--          daytime = factor(daytime, labels = c("Nighttime", "Daytime"))) %>% -->
<!--   group_by(daytime, month, drunk_dr) %>% -->
<!--   summarize(accidents = n()) %>% -->
<!--   ggplot(aes(x = daytime, y = accidents, group = daytime)) +  -->
<!--   geom_boxplot() +  -->
<!--   facet_wrap(~ drunk_dr, ncol = 2) + -->
<!--   xlab("Time of day") + ylab("# of monthly accidents") +  -->
<!--   ggtitle(paste("Fatal accidents in", "Colorado", "in 2015")) -->
<!-- ``` -->
<!-- - Now write a function called `plot_fars` to create a plot like the one you just made for Colorado for any data frame with the format of `accident` (i.e., same number, types, and names of columns). Test it on subsets of the data for several states (Colorado, Texas, California, and New York). (*Hint*: To get a function to print out a plot created with ggplot, you will need to explicitly print the output from your function. See the examples of using the function below.)  -->
<!-- ```{r check8, echo = FALSE, fig.width = 6, fig.height = 3, fig.align = "center"} -->
<!-- plot_fars <- function(df){ -->
<!--   fars_plot <- df %>% -->
<!--     mutate(drunk_dr = factor(drunk_dr, labels = c("Unrelated to\ndrunk driving", -->
<!--                                                   "Related to\ndrunk driving")), -->
<!--            daytime = factor(daytime, labels = c("Nighttime", "Daytime"))) %>% -->
<!--     group_by(daytime, month, drunk_dr) %>% -->
<!--     summarize(accidents = n()) %>% -->
<!--     ggplot(aes(x = daytime, y = accidents, group = daytime)) + -->
<!--     geom_boxplot() + -->
<!--     facet_wrap(~ drunk_dr, ncol = 2) + -->
<!--     xlab("Time of day") + ylab("# of monthly accidents")  -->
<!-- } -->
<!-- ``` -->
<!-- Here are some examples of what should happen when you run this function: -->
<!-- ```{r, fig.width = 6, fig.height = 3, fig.align = "center"} -->
<!-- co_plot <- plot_fars(df = filter(accident, state_name == "Colorado")) -->
<!-- print(co_plot) -->
<!-- accident %>%  -->
<!--   filter(state_name == "Texas") %>%  -->
<!--   plot_fars() %>%  -->
<!--   print() -->
<!-- ``` -->
<!-- - Once you have written this function, what happens when you run the following code? -->
<!-- ```{r eval = FALSE, fig.width = 6, fig.height = 3, fig.align = "center"} -->
<!-- library(purrr) -->
<!-- state_plots <- accident %>%  -->
<!--   filter(state_name %in% c("Colorado", "Texas", "California", "New York")) %>%  -->
<!--   group_by(state_name) %>% -->
<!--   nest() %>%  -->
<!--   mutate(plots = map(data, plot_fars))  -->
<!-- class(state_plots[["plots"]]) -->
<!-- class(state_plots[["plots"]][[1]]) -->
<!-- print(state_plots[["plots"]][[1]])$plot -->
<!-- ``` -->
<!-- - Install the `cowplot` package (this is a `ggplot2` extension) and then try running the following code. What happens when you run this code? -->
<!-- ```{r eval = FALSE} -->
<!-- plot_grid(plotlist = state_plots[["plots"]],  -->
<!--           ncol = 2, labels = "AUTO") -->
<!-- ``` -->
<!-- #### Example R code -->
<!-- Here is the code to read the dataset with state names and FIPS codes at http://www2.census.gov/geo/docs/reference/state.txt into an R object called `state_fips` and clean it so the first few lines: -->
<!-- ```{r check7, echo = FALSE, warning = FALSE, message = FALSE} -->
<!-- state_fips <- read_delim("http://www2.census.gov/geo/docs/reference/state.txt", -->
<!--                          delim = "|") %>% -->
<!--   rename(state = STATE, -->
<!--          state_name = STATE_NAME) %>% -->
<!--   select(state, state_name) %>% -->
<!--   mutate(state = as.integer(state)) -->
<!-- state_fips %>% slice(1:5) -->
<!-- ``` -->
<!-- Note that you can read this file directly from the website using `read_delim`.  -->
<!-- Read the 2015 FARS data into an R object named `accident`. Use all the date and time information to create a column named `date` with the date and time of the accident. Include information on whether the accident was related to drunk driving (FALSE if there were 0 drunk drivers, TRUE if there were one or more), and create columns that gives whether the accident was during the day (7 AM to 7 PM) or not as well as the month of the accident (for this last column, you can either retain it from the original data or recalculate it based on the new `date` variable). Filter out any values where the date-time does not render (i.e., `date` is a missing value). You can use the following code to do all this: -->
<!-- ```{r check6, warning = FALSE, message = FALSE, echo = FALSE} -->
<!-- accident <- read_csv("data/accident.csv") %>% -->
<!--   select(STATE, DAY:MINUTE, DRUNK_DR) %>% -->
<!--   rename(state = STATE,  -->
<!--          drunk_dr = DRUNK_DR) %>% -->
<!--   select(-DAY_WEEK) %>% -->
<!--   unite(date, DAY:MINUTE, sep = "-") %>% -->
<!--   mutate(date = dmy_hm(date),  -->
<!--          drunk_dr = drunk_dr >= 1, -->
<!--          daytime = hour(date) %in% c(7:19), -->
<!--          month = month(date)) %>% -->
<!--   filter(!is.na(date)) -->
<!-- accident %>% slice(1:5) -->
<!-- ``` -->
<!-- A few notes: -->
<!-- - Notice that `select` is using the `:` operator to pick several columns in a row. -->
<!-- - Some of the column names in all caps are changed to lower case to make them easier to work with.  -->
<!-- - The `DAY_WEEK` column is in the middle of other date columns, but if you remove it, you can use `unite` with `:` to join together all the date-time columns and then use `lubridate` to change this column into the right class.  -->
<!-- - A logical operator is used inside a `mutate` call to create a column of whether the accident involved drunk driving (one or more drunk drivers involved) -->
<!-- - The `hour` function from `lubridate` is used to check if the time of the accident falls in "daytime" or not -->
<!-- - Some of the accidents are missing some date information. A `filter` is used to filter that out.  -->
<!-- Join the information from `state_fips` into the `accident` data frame. There may be a few locations in the `state_fips` data frame that are not included in the `accident` data frame (e.g., Virgin Islands), so when you join keep all observations in `accident` but only the observations in `state_fips` that match at least one row of `accident`. You can use the following code for this: -->
<!-- ```{r echo = FALSE} -->
<!-- accident <- accident %>% -->
<!--   left_join(state_fips, by = "state") -->
<!-- accident %>% slice(1:5) -->
<!-- ``` -->
<!-- Summarize the data to get the total number of accidents, separated by (1) daytime and nighttime and (2) related or unrelated to drunk driving, in each month (in other words, in January, how many daytime accidents were there that were unrelated to drunk driving? How many nighttime accidents that were unrelated to drunk driving? etc.). You can do that with this code: -->
<!-- ```{r} -->
<!-- accident %>% -->
<!--   filter(state_name == "Colorado") %>% -->
<!--   group_by(daytime, month, drunk_dr) %>% -->
<!--   summarize(accidents = n()) -->
<!-- ``` -->
<!-- As a note, you may want to create a table (for example, for a report) from the data at this stage. You could use `unite` then `pivot_wider` to do this pretty easily: -->
<!-- ```{r check5} -->
<!-- accident %>% -->
<!--   filter(state_name == "Colorado") %>% -->
<!--   mutate(daytime = factor(daytime, labels = c("Nighttime", "Daytime")), -->
<!--          drunk_dr = factor(drunk_dr,  -->
<!--                            labels = c("Not drunk driving", "Drunk driving"))) %>%  -->
<!--   group_by(daytime, month, drunk_dr) %>% -->
<!--   summarize(accidents = n()) %>%  -->
<!--   ungroup() %>%  -->
<!--   unite(category, daytime, drunk_dr, sep = " / ") %>%  -->
<!--   pivot_wider(names_from = category, values_from = accidents) %>%  -->
<!--   knitr::kable() -->
<!-- ``` -->
<!-- Write a function that inputs a data frame (`df`) and outputs this type of summary data frame (like the one just created for Colorado). You can do that with the following code. Note that, because it inputs a data frame and outputs a data frame, you can include it in a pipeline.  -->
<!-- ```{r} -->
<!-- summarize_fars <- function(df){ -->
<!--   df %>% -->
<!--     group_by(daytime, month, drunk_dr) %>% -->
<!--     summarize(accidents = n()) -->
<!-- } -->
<!-- ``` -->
<!-- Once you've written the function, see if you can figure out what the following code does. This code limits the data to data from four states and then applies the `summarize_fars` function that you just wrote to the subset of data from each state. Finally, since we `nest` to do that, the pipeline includes some lines to `unnest` the data to get back to an unnested data frame: -->
<!-- ```{r check4, eval = FALSE} -->
<!-- library(purrr) -->
<!-- accident %>%  -->
<!--   filter(state_name %in% c("Colorado", "Texas", "California", "New York")) %>%  -->
<!--   group_by(state_name) %>% -->
<!--   nest() %>%  -->
<!--   mutate(summary = map(data, summarize_fars)) %>%  -->
<!--   select(-data) %>%  -->
<!--   unnest()  -->
<!-- ``` -->
<!-- Write code to create boxplots for Colorado of the distribution of total accidents within each month. Create separate boxplots for daytime and nighttime accidents, and facet by whether the accident was related to drunk driving. You can do that with this code: -->
<!-- ```{r check3, fig.width = 6, fig.height = 3, fig.align = "center"} -->
<!-- accident %>% -->
<!--   filter(state_name == "Colorado") %>% -->
<!--   mutate(drunk_dr = factor(drunk_dr, labels = c("Unrelated to\ndrunk driving", -->
<!--                                                 "Related to\ndrunk driving")), -->
<!--          daytime = factor(daytime, labels = c("Nighttime", "Daytime"))) %>% -->
<!--   group_by(daytime, month, drunk_dr) %>% -->
<!--   summarize(accidents = n()) %>% -->
<!--   ggplot(aes(x = daytime, y = accidents, group = daytime)) +  -->
<!--   geom_boxplot() +  -->
<!--   facet_wrap(~ drunk_dr, ncol = 2) + -->
<!--   xlab("Time of day") + ylab("# of monthly accidents") +  -->
<!--   ggtitle(paste("Fatal accidents in", "Colorado", "in 2015")) -->
<!-- ``` -->
<!-- Now write a function called `plot_fars` to create a plot like the one you just made for Colorado for any data frame with the format of `accident` (i.e., same number, types, and names of columns). Test it on subsets of the data for several states (Colorado, Texas, California, and New York). (*Hint*: To get a function to print out a plot created with ggplot, you must explicitly print the plot object. For example, you could assign the plot to `fars_plot`, and then you would run `print(fars_plot)` within your loop as the last step.) -->
<!-- ```{r check2, echo = FALSE, fig.width = 6, fig.height = 3, fig.align = "center"} -->
<!-- plot_fars <- function(df){ -->
<!--   fars_plot <- df %>% -->
<!--     mutate(drunk_dr = factor(drunk_dr, labels = c("Unrelated to\ndrunk driving", -->
<!--                                                   "Related to\ndrunk driving")), -->
<!--            daytime = factor(daytime, labels = c("Nighttime", "Daytime"))) %>% -->
<!--     group_by(daytime, month, drunk_dr) %>% -->
<!--     summarize(accidents = n()) %>% -->
<!--     ggplot(aes(x = daytime, y = accidents, group = daytime)) + -->
<!--     geom_boxplot() + -->
<!--     facet_wrap(~ drunk_dr, ncol = 2) + -->
<!--     xlab("Time of day") + ylab("# of monthly accidents")  -->
<!--   print(fars_plot) -->
<!-- } -->
<!-- ``` -->
<!-- Notice how similar this function is to the code you wrote in the previous step.  -->
<!-- Once you have written this function, what happens when you run the following code? The following code applies this function to the subset of data from each of four states. The output (`state_plots`) is a nested data frame, where the new `plots` column is a list of `ggplot` objects. If you run `print` on this list, it will print each of these plots out separately (use the arrow buttons in the "Plots" Pane in RStudio to browse through these plots). -->
<!-- ```{r check1, fig.width = 6, fig.height = 3, fig.align = "center", eval = FALSE} -->
<!-- library(purrr) -->
<!-- state_plots <- accident %>%  -->
<!--   filter(state_name %in% c("Colorado", "Texas", "California", "New York")) %>%  -->
<!--   group_by(state_name) %>% -->
<!--   nest() %>%  -->
<!--   mutate(plots = map(data, plot_fars))  -->
<!-- state_plots -->
<!-- class(state_plots) -->
<!-- class(state_plots[["plots"]]) -->
<!-- class(state_plots[["plots"]][[1]]) -->
<!-- state_plots[["plots"]][[1]]$plot -->
<!-- ``` -->
<!-- Install the `cowplot` package (this is a `ggplot2` extension) and then try running the following code. What happens? The `plot_grid` function, if you input a list with `ggplot` objects using the `plotlist` argument, will print all the plots out on the same page.  -->
<!-- ```{r fig.width = 12, fig.height = 8, fig.align = "center", eval = FALSE} -->
<!-- library(cowplot) -->
<!-- plot_grid(plotlist = state_plots[["plots"]],  -->
<!--           ncol = 2, labels = "AUTO") -->
<!-- ``` -->
<!-- --- -->

</div>
</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="entering-and-cleaning-data-2.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="reporting-results-2.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/07-exploringdata2.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"download": ["RProgrammingForResearch.pdf"],
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
